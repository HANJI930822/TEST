<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™‚äº‹äººç”Ÿçµ‚æ¥µç‰ˆ</title>
    <style>
      :root {
        --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --bg-dark: #0f0f23;
        --card: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
        --accent: #bb86fc;
        --accent-glow: rgba(187, 134, 252, 0.3);
        --text: #ffffff;
        --text-dim: #b0b0b0;
        --green: #03dac6;
        --red: #cf6679;
        --gold: #ffd700;
        --blue: #2196f3;
        --orange: #ff9800;
        --purple: #9c27b0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "å¾®è»Ÿæ­£é»‘é«”", "Noto Sans TC", sans-serif;
        background: var(--bg-dark);
        color: var(--text);
        max-width: 100%;
        width: 100%;
        margin: 0 auto;
        padding: 0;
        padding-bottom: 80px;
        overflow-x: hidden;
        position: relative;
        min-height: 100vh;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 300px;
        background: var(--bg-primary);
        z-index: -1;
        opacity: 0.3;
        pointer-events: none; /* ç¢ºä¿ä¸æ“‹ä½é»æ“Š */
      }

      /* ===== HEADER ===== */
      .header {
        background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
        padding: 15px;
        position: sticky;
        top: 0;
        z-index: 100; /* æé«˜å±¤ç´š */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        border-bottom: 2px solid var(--accent);
      }

      .player-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
      }

      .player-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--bg-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        box-shadow: 0 0 15px var(--accent-glow);
      }

      .player-details {
        flex: 1;
      }

      .player-name-line {
        font-size: 1.2em;
        font-weight: bold;
        color: var(--gold);
      }

      .player-subtitle {
        font-size: 0.8em;
        color: var(--text-dim);
      }

      .big-stat {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--gold);
        text-align: center;
        margin: 10px 0;
        text-shadow: 0 0 10px var(--gold);
      }

      .stat-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        font-size: 0.85em;
        text-align: center;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-value {
        font-size: 1.2em;
        font-weight: bold;
        display: block;
        color: var(--text);
      }

      .status-alerts {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .status-alert {
        padding: 8px;
        border-radius: 8px;
        font-size: 0.8em;
        font-weight: bold;
        text-align: center;
        animation: slideIn 0.3s;
      }

      .alert-red {
        background: linear-gradient(135deg, #b00020, #d32f2f);
        color: #fff;
      }
      .alert-orange {
        background: linear-gradient(135deg, #ff9800, #fb8c00);
        color: #fff;
      }
      .alert-blue {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: #fff;
      }

      /* ===== SKILLS ===== */
      .skills-container {
        margin-top: 10px;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 8px;
      }

      .skill-item {
        margin-bottom: 8px;
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        font-size: 0.8em;
        margin-bottom: 3px;
        color: var(--text);
      }

      .skill-bar-bg {
        background: #333;
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
      }

      .skill-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--blue), var(--green));
        transition: width 0.5s ease;
      }

      /* ===== STAMINA ===== */
      .stamina-container {
        margin-top: 10px;
      }

      .stamina-label {
        font-size: 0.85em;
        color: var(--blue);
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
      }

      .progress-bg {
        background: #444;
        height: 12px;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #2196f3, #03dac6);
        width: 100%;
        transform-origin: left;
        transform: scaleX(1);
        transition: transform 0.3s ease;
        box-shadow: 0 0 10px rgba(33, 150, 243, 0.6);
      }

      .progress-fill.low {
        background: linear-gradient(90deg, #cf6679, #f44336);
      }

      /* ===== CARDS ===== */
      .card {
        background: var(--card);
        border-radius: 15px;
        margin: 15px 10px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 0.4s;
        position: relative; /* ç¢ºä¿å±¤ç´šæ­£ç¢º */
        z-index: 1;
      }

      .card-header {
        padding: 15px;
        background: rgba(187, 134, 252, 0.15);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card-title {
        font-size: 1.1em;
        font-weight: bold;
        color: var(--accent);
      }

      .card-body {
        padding: 15px;
        position: relative;
        z-index: 2;
      }

      /* ===== BUTTONS ä¿®å¾©é»æ“Šå•é¡Œ ===== */
      .btn-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        position: relative;
        z-index: 10; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
      }

      button {
        background: linear-gradient(135deg, #444, #555);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.95em;
        font-weight: 500;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
        z-index: 10; /* ç¢ºä¿å¯é»æ“Š */
        pointer-events: auto; /* å¼·åˆ¶å•Ÿç”¨é»æ“Š */
      }

      /* ä¿®å¾© ::before å½å…ƒç´ æ“‹ä½é»æ“Šçš„å•é¡Œ */
      button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
        pointer-events: none; /* é—œéµï¼šè®“å½å…ƒç´ ä¸æ“‹ä½é»æ“Š */
        z-index: -1; /* æ”¾åˆ°æŒ‰éˆ•æ–‡å­—ä¸‹æ–¹ */
      }

      button:hover::before {
        width: 300px;
        height: 300px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(187, 134, 252, 0.4);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(187, 134, 252, 0.3);
      }

      button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        filter: grayscale(1);
        pointer-events: none; /* disabled æ™‚æ‰ç¦ç”¨é»æ“Š */
      }

      .btn-main {
        background: linear-gradient(135deg, var(--accent), #9c27b0);
        color: white;
        font-weight: bold;
        width: 100%;
        margin-top: 10px;
        font-size: 1.1em;
        box-shadow: 0 4px 15px var(--accent-glow);
      }

      .btn-job {
        background: linear-gradient(135deg, #2196f3, #1976d2);
      }

      .btn-buy {
        background: linear-gradient(135deg, var(--green), #00897b);
        color: black;
        font-weight: bold;
      }

      .btn-risk {
        background: linear-gradient(135deg, var(--red), #c62828);
      }

      .cost-tag {
        font-size: 0.7em;
        color: #ddd;
        display: block;
        margin-top: 3px;
        pointer-events: none; /* ä¸æ“‹ä½æŒ‰éˆ•é»æ“Š */
      }

      /* ===== ORIGIN SELECTION ===== */
      #scene-creation {
        padding: 20px;
        text-align: center;
        position: relative;
        z-index: 10;
      }

      .creation-title {
        font-size: 2em;
        background: var(--bg-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .origin-card {
        background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
        cursor: pointer;
        text-align: left;
        transition: all 0.3s;
        position: relative;
        z-index: 10; /* ç¢ºä¿å¯é»æ“Š */
        pointer-events: auto;
      }

      .origin-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(187, 134, 252, 0.3);
        border-color: rgba(187, 134, 252, 0.5);
      }

      .origin-card.selected {
        border-color: var(--accent);
        background: linear-gradient(135deg, #3a3a5e, #4a4a6e);
        box-shadow: 0 0 25px var(--accent-glow);
      }

      .origin-card.selected::before {
        content: "âœ“";
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        background: var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2em;
        z-index: 20;
        pointer-events: none;
      }

      .origin-name {
        font-weight: bold;
        color: var(--gold);
        font-size: 1.2em;
        margin-bottom: 5px;
      }

      .origin-desc {
        font-size: 0.9em;
        color: var(--text-dim);
        margin: 5px 0;
        line-height: 1.4;
      }

      .origin-parents {
        font-size: 0.85em;
        color: #888;
        margin: 5px 0;
        font-style: italic;
      }

      .origin-stats {
        color: var(--green);
        font-size: 0.85em;
        margin-top: 8px;
        line-height: 1.5;
      }

      /* ===== INPUT GROUPS ===== */
      .input-group {
        margin-bottom: 15px;
        text-align: left;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        color: var(--text);
        font-weight: bold;
        font-size: 0.95em;
      }

      .input-group input,
      .input-group select {
        width: 100%;
        padding: 12px;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: var(--text);
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
        position: relative;
        z-index: 10;
        pointer-events: auto;
      }

      .input-group input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .input-group input:focus,
      .input-group select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 10px var(--accent-glow);
      }

      /* ===== MODAL ===== */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 300; /* æœ€é«˜å±¤ç´š */
        display: none;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.3s;
      }

      /* âœ… ä¿®æ­£ Modal æ¨£å¼ï¼Œé˜²æ­¢å…§å®¹æº¢å‡º */
      .modal-box {
        background: var(--card);
        width: 85%;
        max-width: 400px;
        max-height: 80vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
        display: flex; /* ä½¿ç”¨ Flex ä½ˆå±€ */
        flex-direction: column;
        padding: 15px;
        border-radius: 12px;
        border: 2px solid var(--accent);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        animation: slideUp 0.4s;
        position: relative;
        z-index: 310;
      }

      .modal-title {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--gold);
        margin-bottom: 15px;
      }

      .modal-desc {
        margin-bottom: 20px;
        line-height: 1.6;
        color: var(--text);
        white-space: pre-wrap;
        overflow-y: auto; /* âœ… å…è¨±æ–‡å­—å€åŸŸæ»¾å‹• */
        flex: 1; /* âœ… è‡ªå‹•ä½”ç”¨å‰©é¤˜ç©ºé–“ */
        min-height: 50px;
      }

      .modal-btn {
        width: 100%;
        margin-bottom: 10px;
        padding: 15px;
        position: relative;
        z-index: 320;
      }

      /* ===== NAV BAR ===== */
      .nav-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-width: 100%;
        background: linear-gradient(135deg, #1e1e2e, #000);
        display: flex;
        justify-content: space-around;
        padding: 8px 0;
        border-top: 2px solid var(--accent);
        z-index: 200; /* é«˜å±¤ç´šä½†ä½æ–¼ modal */
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
      }

      .nav-item {
        color: #888;
        cursor: pointer;
        text-align: center;
        font-size: 0.75em;
        padding: 5px;
        transition: all 0.3s;
        flex: 1;
        position: relative;
        z-index: 210;
        pointer-events: auto;
      }

      .nav-item:hover {
        color: var(--accent);
      }

      .nav-item:active {
        transform: scale(0.95);
      }

      .nav-item.active {
        color: var(--accent);
        font-weight: bold;
      }

      .nav-icon {
        display: block;
        font-size: 1.8em;
        margin-bottom: 2px;
      }

      .page {
        display: none;
        animation: fadeIn 0.3s;
        position: relative;
        z-index: 1;
      }

      .page.active {
        display: block;
      }

      /* ===== TALENT TAGS ===== */
      .talent-tag {
        display: inline-block;
        background: linear-gradient(135deg, var(--gold), #ffa000);
        color: black;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.75em;
        margin-right: 5px;
        margin-top: 3px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(255, 215, 0, 0.3);
        pointer-events: auto;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .talent-bad {
        background: linear-gradient(135deg, var(--red), #c62828);
        color: white;
      }
      /* ===== ç‰¹è³ªæ‡¸åœæ•ˆæœï¼ˆç°¡åŒ–ç‰ˆï¼‰===== */
      .trait-tooltip {
        position: relative;
        cursor: pointer;
        transition: all 0.2s;
        pointer-events: auto !important; /* âœ… å¼ºåˆ¶å…è®¸ç‚¹å‡» */
      }

      .trait-tooltip:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(187, 134, 252, 0.6);
        filter: brightness(1.2);
      }

      .trait-tooltip:active {
        transform: scale(0.95);
      }

      /* âœ… æ‰‹æ©Ÿç‰ˆé»æ“Šæç¤º */
      @media (max-width: 767px) {
        .modal-box {
          width: 90%;
          padding: 12px; /* âœ… æ‰‹æœºç‰ˆæ›´å° */
          max-height: 75vh; /* âœ… é™åˆ¶é«˜åº¦ */
        }

        .modal-title {
          font-size: 1.1em; /* âœ… ç¼©å°æ ‡é¢˜ */
        }

        .modal-btn {
          padding: 10px; /* âœ… ç¼©å°æŒ‰é’® */
          font-size: 0.9em;
        }
      }

      /* ===== LOG BOX ===== */
      .log-box {
        height: 150px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.4);
        padding: 10px;
        border-radius: 8px;
        font-size: 0.85em;
        color: #ddd;
        border: 1px solid rgba(255, 255, 255, 0.1);
        line-height: 1.6;
      }

      .log-box::-webkit-scrollbar {
        width: 6px;
      }

      .log-box::-webkit-scrollbar-track {
        background: #222;
      }

      .log-box::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 3px;
      }

      /* ===== JOB/ITEM CARD ===== */
      .job-card {
        background: rgba(255, 255, 255, 0.08);
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        z-index: 5;
        pointer-events: auto;
      }

      .job-card:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateX(5px);
      }

      .job-card:active {
        transform: translateX(3px);
      }

      .job-name {
        font-weight: bold;
        color: var(--blue);
        font-size: 1.1em;
      }

      .job-salary {
        color: var(--green);
        font-size: 0.9em;
      }

      .job-requirement {
        color: var(--text-dim);
        font-size: 0.8em;
        margin-top: 3px;
      }

      /* ===== ANIMATIONS ===== */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .section-title {
        font-size: 1.2em;
        color: var(--gold);
        margin: 20px 10px 10px;
        text-align: left;
        font-weight: bold;
      }

      /* éŠæˆ²å ´æ™¯é è¨­éš±è— */
      #scene-game {
        display: none !important; /* âœ… åŠ ä¸Š !important å¼·åˆ¶å„ªå…ˆ */
      }

      /* éŠæˆ²é–‹å§‹å¾Œæ‰é¡¯ç¤º */
      #scene-game.active {
        display: block !important;
      }

      /* ç¢ºä¿æ‰€æœ‰å¯äº’å‹•å…ƒç´ éƒ½åœ¨æ­£ç¢ºå±¤ç´š */
      input,
      select,
      button,
      .origin-card,
      .job-card,
      .nav-item {
        -webkit-tap-highlight-color: rgba(187, 134, 252, 0.3);
        touch-action: manipulation;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }
      @keyframes popIn {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.05);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: translate(-50%, -60%) scale(0.9);
        }
      }
      /* ===== ğŸ“± å“åº”å¼å¸ƒå±€ ===== */

      /* å®¹å™¨åŒ…è£… */
      #scene-creation,
      #scene-game {
        max-width: 100%;
        width: 100%;
        margin: 0 auto;
      }

      /* === æ¡Œé¢ç«¯ (å¤§äº 1024px) === */
      @media (min-width: 1025px) {
        body {
          max-width: 800px;
        }

        .header {
          padding: 20px;
        }

        .card {
          margin: 20px 15px;
        }

        .btn-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 15px;
        }

        .stat-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .origin-card {
          padding: 20px;
        }

        .modal-box {
          max-width: 600px;
        }
      }

      /* === å¹³æ¿ç«¯ (768px - 1024px) === */
      @media (min-width: 768px) and (max-width: 1024px) {
        body {
          max-width: 100%;
          padding: 0 20px 80px 20px;
        }

        .header {
          padding: 15px 20px;
        }

        .card {
          margin: 15px 0;
        }

        .btn-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 12px;
        }

        .stat-grid {
          grid-template-columns: repeat(3, 1fr);
        }

        button {
          font-size: 1em;
          padding: 14px;
        }

        .nav-bar {
          padding: 10px 0;
        }

        .nav-item {
          font-size: 0.8em;
        }

        .nav-icon {
          font-size: 2em;
        }
      }

      /* === æ‰‹æœºç«¯ (å°äº 768px) === */
      @media (max-width: 767px) {
        body {
          max-width: 100%;
          padding: 0 10px 80px 10px;
        }

        .header {
          padding: 12px 10px;
        }

        .player-avatar {
          width: 45px;
          height: 45px;
          font-size: 1.3em;
        }

        .player-name-line {
          font-size: 1em;
        }

        .player-subtitle {
          font-size: 0.75em;
        }

        .big-stat {
          font-size: 1.3em;
        }

        .stat-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 6px;
          font-size: 0.8em;
        }

        .stat-item {
          padding: 6px;
        }

        .card {
          margin: 12px 0;
          border-radius: 12px;
        }

        .card-header {
          padding: 12px;
        }

        .card-body {
          padding: 12px;
        }

        .card-title {
          font-size: 1em;
        }

        .btn-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }

        button {
          padding: 10px;
          font-size: 0.85em;
          border-radius: 8px;
        }

        .btn-main {
          font-size: 1em;
          padding: 12px;
        }

        .cost-tag {
          font-size: 0.65em;
        }

        .talent-tag {
          font-size: 0.7em;
          padding: 2px 6px;
          margin-right: 4px;
        }

        .log-box {
          height: 120px;
          font-size: 0.8em;
          padding: 8px;
        }

        .nav-bar {
          padding: 6px 0;
        }

        .nav-item {
          font-size: 0.7em;
          padding: 4px;
        }

        .nav-icon {
          font-size: 1.6em;
          margin-bottom: 1px;
        }

        /* æŠ€èƒ½æ¡ */
        .skills-container {
          padding: 8px;
        }

        .skill-header {
          font-size: 0.75em;
        }

        /* çŠ¶æ€è­¦å‘Š */
        .status-alert {
          padding: 6px;
          font-size: 0.75em;
        }

        /* åˆ›è§’ç”»é¢ */
        #scene-creation {
          padding: 15px 10px;
        }

        .creation-title {
          font-size: 1.6em;
          margin-bottom: 15px;
        }

        .origin-card {
          padding: 12px;
          margin-bottom: 10px;
        }

        .origin-name {
          font-size: 1em;
        }

        .origin-desc {
          font-size: 0.85em;
        }

        .origin-stats {
          font-size: 0.8em;
        }

        .input-group input,
        .input-group select {
          padding: 10px;
          font-size: 0.95em;
        }

        /* å¼¹çª— */
        .modal-box {
          width: 95%;
          padding: 20px;
        }

        .modal-title {
          font-size: 1.3em;
        }

        .modal-desc {
          font-size: 0.9em;
        }

        .modal-btn {
          padding: 12px;
          font-size: 0.9em;
        }

        /* èŒä¸šå¡ç‰‡ */
        .job-card {
          padding: 10px;
          margin-bottom: 8px;
        }

        .job-name {
          font-size: 1em;
        }

        .job-salary {
          font-size: 0.85em;
        }

        .job-requirement {
          font-size: 0.75em;
        }

        /* æ•°å€¼å˜åŒ–æç¤º */
        .change-popup {
          min-width: 200px;
          padding: 20px 25px;
        }
      }

      /* === æå°å±å¹• (å°äº 375px) === */
      @media (max-width: 374px) {
        .player-name-line {
          font-size: 0.9em;
        }

        .stat-grid {
          font-size: 0.75em;
        }

        .btn-grid {
          gap: 6px;
        }

        button {
          padding: 8px;
          font-size: 0.8em;
        }

        .nav-item {
          font-size: 0.65em;
        }

        .nav-icon {
          font-size: 1.4em;
        }

        .card {
          margin: 10px 0;
        }

        .talent-tag {
          font-size: 0.65em;
          padding: 2px 5px;
        }
      }

      /* === æ¨ªå±æ¨¡å¼ä¼˜åŒ– === */
      @media (max-height: 600px) and (orientation: landscape) {
        .header {
          position: sticky;
          top: 0;
          z-index: 100;
        }

        .log-box {
          height: 100px;
        }

        .modal-box {
          max-height: 90vh;
          overflow-y: auto;
        }

        .card {
          margin: 10px 0;
        }
      }

      /* === è§¦æ§ä¼˜åŒ– === */
      @media (hover: none) and (pointer: coarse) {
        button {
          min-height: 44px;
          min-width: 44px;
        }

        .nav-item {
          min-height: 48px;
        }

        .origin-card {
          min-height: 60px;
        }

        .job-card {
          min-height: 60px;
        }
      }

      /* === å¯¼èˆªæ å“åº”å¼ === */
      .nav-bar {
        left: 0;
        right: 0;
        margin: 0 auto;
      }

      @media (min-width: 768px) {
        .nav-bar {
          max-width: 100%;
        }
      }

      @media (min-width: 1025px) {
        .nav-bar {
          max-width: 800px;
        }
      }

      /* === å‡ºèº«é€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        /* å‡ºèº«é€‰æ‹©çš„å·¦å³ç®­å¤´ */
        button[onclick="prevOrigin()"],
        button[onclick="nextOrigin()"] {
          width: 45px !important;
          height: 45px !important;
          font-size: 1.5em !important;
          left: 5px !important;
        }

        button[onclick="nextOrigin()"] {
          right: 5px !important;
          left: auto !important;
        }

        /* å‡ºèº«å¡ç‰‡å†…è¾¹è· */
        div[style*="padding: 0 80px"] {
          padding: 0 55px !important;
        }
      }

      /* === ç‰¹è´¨é€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        #trait-options .origin-card {
          max-width: 100% !important;
          margin: 10px 0 !important;
        }
      }

      /* === èŒä¸šé€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        button[onclick="prevJob()"],
        button[onclick="nextJob()"] {
          width: 40px !important;
          height: 40px !important;
          font-size: 1.2em !important;
          left: -5px !important;
        }

        button[onclick="nextJob()"] {
          right: -5px !important;
          left: auto !important;
        }
      }

      /* === æ•°å€¼å˜åŒ–æç¤ºå“åº”å¼ === */
      @media (max-width: 767px) {
        div[style*="position: fixed"][style*="top: 20%"] {
          top: 15% !important;
          min-width: 220px !important;
          padding: 20px 25px !important;
        }
      }
      /* ===== ğŸ¨ ç‰¹è³ªé¸æ“‡ä»‹é¢ (æ¡Œé¢ + æ‰‹æ©Ÿ å®Œç¾ç‰ˆ) ===== */

      /* 1. å¤–å±¤å®¹å™¨ï¼šé™åˆ¶å¯¬åº¦ï¼Œè®“æ¡Œé¢ç‰ˆä¸è¦å¤ªå¯¬ */
      #trait-card-container {
        max-width: 500px; /* æ¡Œé¢ç‰ˆå¡ç‰‡å¯¬åº¦ä¸Šé™ */
        margin: 0 auto; /* å±…ä¸­ */
        position: relative;
      }

      /* 2. å·²é¸ç‰¹è³ªåˆ—è¡¨ */
      #selected-traits-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
      }

      /* 3. å¡ç‰‡åŒ…è£å±¤ */
      .trait-card-wrapper {
        position: relative;
        min-height: 420px; /* å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢åˆ‡æ›æ™‚å…§å®¹è·³å‹• */
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      /* 4. æ¡Œé¢ç‰ˆå°èˆªç®­é ­ (åœ“å½¢æŒ‰éˆ•) */
      .trait-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5em;
        background: rgba(60, 60, 80, 0.8); /* åŠé€æ˜èƒŒæ™¯ */
        z-index: 100;
        border: 2px solid var(--text-dim);
        color: var(--text);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        backdrop-filter: blur(5px);
      }

      /* æ¡Œé¢ç‰ˆç®­é ­ä½ç½®ï¼šæ¨åˆ°å¡ç‰‡å¤–é¢ */
      .trait-nav-prev {
        left: -70px;
      }
      .trait-nav-next {
        right: -70px;
      }

      .trait-nav-btn:hover {
        background: var(--accent);
        border-color: white;
        transform: translateY(-50%) scale(1.1); /* æ‡¸åœæ”¾å¤§ */
        box-shadow: 0 0 15px var(--accent-glow);
      }

      /* 5. å¡ç‰‡æœ¬é«” */
      .trait-card-body {
        padding: 30px;
        border-radius: 15px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        background: var(--card);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        cursor: pointer;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden; /* é˜²æ­¢å…‰æšˆæº¢å‡º */
      }

      .trait-card-body:hover {
        transform: translateY(-5px); /* æ‡¸åœä¸Šæµ® */
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        border-color: rgba(255, 255, 255, 0.3);
      }

      /* é¸ä¸­ç‹€æ…‹ */
      .trait-card-body.selected {
        border-color: var(--green);
        box-shadow: 0 0 25px rgba(3, 218, 198, 0.3);
        background: linear-gradient(145deg, #1e3a3a, #1a1a2e) !important;
      }

      /* æ¡Œé¢ç‰ˆéš±è—åº•éƒ¨æ‰‹æ©Ÿå°èˆª */
      .mobile-nav-container {
        display: none;
      }

      /* ===== ğŸ“± æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼èª¿æ•´ (å°æ–¼ 768px) ===== */
      @media (max-width: 768px) {
        /* éš±è—å…©å´å¤§ç®­é ­ï¼Œæ”¹ç”¨åº•éƒ¨æŒ‰éˆ• */
        .trait-nav-btn {
          display: none;
        }

        /* é¡¯ç¤ºåº•éƒ¨å°èˆª */
        .mobile-nav-container {
          display: flex;
          justify-content: space-between;
          gap: 15px;
          margin-top: 15px;
        }

        .mobile-nav-btn {
          flex: 1;
          padding: 12px;
          background: #333;
          border: 1px solid #555;
          border-radius: 8px;
          color: white;
          font-size: 1em;
          active: scale(0.95);
        }

        /* èª¿æ•´å¡ç‰‡å…§è·ï¼Œçˆ­å–ç©ºé–“ */
        .trait-card-body {
          padding: 20px 15px;
          min-height: 380px;
        }

        /* å­—é«”å¾®èª¿ */
        .trait-name-text {
          font-size: 1.6em !important;
        }
        .trait-desc-text {
          font-size: 1em !important;
        }
      }
      /* ===== ğŸ› ï¸ ä¿®å¾©æ’ç‰ˆå•é¡Œå°ˆç”¨ CSS (é›»è…¦+æ‰‹æ©Ÿå®Œç¾ç‰ˆ) ===== */

      /* 1. æ¨¡æ…‹è¦–çª—å®¹å™¨ - é›»è…¦ç‰ˆå„ªåŒ– */
      /* ç•¶ Modal é€²å…¥ã€Œç´”æ·¨æ¨¡å¼ã€æ™‚ï¼Œç§»é™¤é è¨­çš„å…§è·å’Œé‚Šæ¡†ï¼Œä¸¦è¨­å®šé›»è…¦ç‰ˆçš„æœ€å¤§å¯¬åº¦ */
      .modal-box.clean-modal {
        padding: 0 !important;
        background: transparent !important; /* èƒŒæ™¯é€æ˜ï¼Œè®“å…§éƒ¨çš„å¡ç‰‡è‡ªå·±æ±ºå®šé¡è‰² */
        border: none !important;
        box-shadow: none !important;
        max-height: 85vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
        width: 100%; /* å¯¬åº¦ä½”æ»¿ */
        max-width: 450px; /* é™åˆ¶é›»è…¦ç‰ˆæœ€å¤§å¯¬åº¦ï¼Œä½¿å…¶çœ‹èµ·ä¾†åƒä¸€å¼µç²¾ç·»çš„å¡ç‰‡ */
        overflow: hidden; /* éš±è—å®¹å™¨çš„æ»¾å‹•æ¢ */
        display: flex; /* ä½¿ç”¨ Flex è®“å…§éƒ¨å¡ç‰‡ç½®ä¸­ */
        justify-content: center;
        margin: auto; /* åœ¨è¢å¹•ä¸Šå±…ä¸­ */
      }

      /* 2. å¡ç‰‡å¤–è§€è¨­å®š (ç¢ºä¿å¡ç‰‡æœ¬èº«æœ‰èƒŒæ™¯å’Œåœ“è§’) */
      /* é€™æ˜¯åŒ…ä½æ¨™é¡Œã€å…§å®¹ã€æŒ‰éˆ•çš„æ•´å€‹å¡ç‰‡ */
      .trait-card-container {
        border-radius: 12px;
        overflow: hidden;
        background: #1e1e2e; /* çµ±ä¸€çš„æ·±è‰²èƒŒæ™¯ */
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        max-height: 80vh; /* é™åˆ¶å¡ç‰‡è‡ªèº«é«˜åº¦ */
        width: 100%; /* ä½”æ»¿å®¹å™¨å¯¬åº¦ */
      }

      /* 3. å…§å®¹æ»¾å‹•å€ (åªè®“ä¸­é–“çš„æ–‡å­—å€åŸŸæ»¾å‹•) */
      .trait-card-scroll {
        overflow-y: auto; /* å…§å®¹éå¤šæ™‚æ‰é¡¯ç¤ºæ»¾å‹•æ¢ */
        flex-grow: 1; /* ä½”æ“šå‰©é¤˜ç©ºé–“ */
        padding: 25px; /* å¢åŠ å…§è·ï¼Œè®“å…§å®¹ä¸æ“æ“  */

        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ (è®“å®ƒè®Šç´°ã€è®Šå¥½çœ‹) */
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
      }

      /* é‡å° Chrome/Safari çš„æ»¾å‹•æ¢æ¨£å¼ */
      .trait-card-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .trait-card-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .trait-card-scroll::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
      }

      /* 4. åº•éƒ¨æŒ‰éˆ•å€ (å›ºå®šåœ¨åº•éƒ¨) */
      .trait-card-footer {
        padding: 15px 20px; /* èª¿æ•´å…§è· */
        background: #1e1e2e; /* èˆ‡å¡ç‰‡èƒŒæ™¯ä¸€è‡´ */
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
      }

      /* ğŸ“± æ‰‹æ©Ÿç‰ˆç‰¹åˆ¥èª¿æ•´ (ç¢ºä¿åœ¨å°è¢å¹•ä¸Šä¹Ÿèƒ½æ»¿ç‰ˆé¡¯ç¤º) */
      @media (max-width: 768px) {
        .modal-box.clean-modal {
          width: 92%; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦ç¨å¾®çª„ä¸€é» */
          max-height: 90vh; /* é«˜åº¦å¯ä»¥æ›´é«˜ */
        }

        .trait-card-scroll {
          padding: 20px; /* æ‰‹æ©Ÿç‰ˆå…§è·ç¨å° */
        }
      }
      /* ===== âœ… ã€æ–°å¢ã€‘æŠ€èƒ½æ¨™ç±¤åŒ–æ¨£å¼ (ç°¡æ½”ç‰ˆ) ===== */
.skill-tag {
  display: inline-block;
  padding: 3px 8px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 5px;
  font-size: 0.75em;
  color: #ddd;
  transition: all 0.2s;
  cursor: default;
}

.skill-tag:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: var(--accent);
  color: white;
  transform: translateY(-1px);
}

.skill-val {
  color: var(--gold);
  font-weight: bold;
  margin-left: 3px;
}
/* ===== ğŸ–¥ï¸ å„€è¡¨æ¿å·¦å³ä½ˆå±€å„ªåŒ– ===== */

/* 1. å¤–å±¤å®¹å™¨ï¼šFlex æ©«å‘æ’åˆ— */
.dashboard-wrapper {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 20px;
  margin-bottom: 15px;
  width: 100%;
}

/* 2. å·¦å´ï¼šç©å®¶è³‡è¨Š */
.player-info-section {
  flex: 1; /* ä½”ç”¨å·¦å´ç©ºé–“ */
  min-width: 200px;
}

.player-base {
  display: flex;
  align-items: center;
  gap: 12px;
}

.player-text {
  display: flex;
  flex-direction: column;
}

/* 3. å³å´ï¼šæŠ€èƒ½å€å¡Š */
.skills-section {
  flex: 1.2; /* å³å´ç¨å¾®å¯¬ä¸€é» */
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* é å³å°é½Š */
}

/* æŠ€èƒ½ç¶²æ ¼ä½ˆå±€ */
.skills-grid-layout {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: flex-end; /* é å³æ’åˆ— */
}

/* 4. æŠ€èƒ½æ¨™ç±¤æ¨£å¼å¾®èª¿ */
.skill-tag {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 6px;
  font-size: 0.8em;
  color: #ccc;
  transition: all 0.2s;
}

.skill-tag:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: var(--accent);
  color: white;
  transform: translateY(-2px);
}

.skill-val {
  color: var(--gold);
  font-weight: bold;
  margin-left: 6px;
  font-size: 1.1em;
}

/* ===== ğŸ“± æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼ (è¢å¹•è®Šçª„æ™‚è‡ªå‹•è®Šå›ä¸Šä¸‹æ’åˆ—) ===== */
@media (max-width: 767px) {
  .dashboard-wrapper {
    flex-direction: column; /* æ”¹ç‚ºå‚ç›´æ’åˆ— */
    gap: 15px;
  }
  
  .skills-section {
    width: 100%;
    align-items: flex-start; /* æ‰‹æ©Ÿç‰ˆé å·¦å°é½Š */
  }
  
  .section-label {
    text-align: left !important;
  }
  
  .skills-grid-layout {
    justify-content: flex-start; /* æ‰‹æ©Ÿç‰ˆé å·¦æ’åˆ— */
  }
}
    </style>
  </head>
  <body>
    <!-- å‰µè§’ç•«é¢ -->
    <div id="scene-creation">
      <h1 class="creation-title">ğŸ§¬ æŠ•èƒæ¨¡æ“¬å™¨ V17.0</h1>

      <div class="card">
        <div class="card-body">
          <div class="input-group">
            <label>âœï¸ å§“å</label>
            <input
              type="text"
              id="inp-name"
              placeholder="è¼¸å…¥å§“å"
              maxlength="8"
              value="æ¸¬è©¦ç©å®¶"
            />
          </div>
          <div class="input-group">
            <label>ğŸš» æ€§åˆ¥</label>
            <select id="inp-gender">
              <option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option>
              <option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option>
              <option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option>
            </select>
          </div>
        </div>
      </div>

      <h3 class="section-title">ğŸ² é¸æ“‡å‡ºèº«èƒŒæ™¯ (é»æ“Šå¡ç‰‡é¸æ“‡)</h3>
      <div id="origin-list"></div>

      <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿå†’éšª</button>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="scene-game">
      <div class="header">
        <div class="dashboard-wrapper">
          
          <div class="player-info-section">
            <div class="player-base">
              <div class="player-avatar" id="player-avatar">ğŸ‘¶</div>
              <div class="player-text">
                <div class="player-name-line">
                  <span id="player-name">???</span>
                  <span style="font-size: 0.8em; color: var(--text-dim)">
                    <span id="age-display">0</span>æ­²</span>
                </div>
                <div class="player-subtitle">
                  <span id="player-origin"></span> | <span id="player-job"></span>
                </div>
              </div>
            </div>

            <div id="talent-display" style="margin-top: 8px"></div>
            <div id="trait-display" style="margin-top: 5px"></div>
          </div>

          <div class="skills-section">
             <div class="section-label" style="font-size: 0.8em; color: var(--accent); margin-bottom: 5px; text-align: right;">ğŸ“Š æŠ€èƒ½ç‹€æ…‹</div>
             <div id="skills-container" class="skills-grid-layout"></div>
          </div>

        </div>

        <div class="big-stat" id="money-display">$0</div>
        
        <div class="stat-grid">
           <div class="stat-item"><span>â¤ï¸ å¥åº·</span><span class="stat-value" id="health">100</span></div>
           <div class="stat-item"><span>ğŸ˜Š å¿«æ¨‚</span><span class="stat-value" id="happy">80</span></div>
           <div class="stat-item"><span>ğŸ§  æ™ºåŠ›</span><span class="stat-value" id="intel">50</span></div>
        </div>

        <div class="stamina-container">
           <div class="stamina-label"><span>âš¡ é«”åŠ›</span><span id="stamina-text">100/100</span></div>
           <div class="progress-bg"><div id="stamina-bar" class="progress-fill"></div></div>
        </div>

        <div class="status-alerts" id="status-alerts"></div>
      </div>

      <!-- é¦–é ï¼šç”Ÿæ´» -->
      <div id="page-home" class="page active">
        <div class="card">
          <div class="card-header">
            <span class="card-title"
              >ğŸ“… äººç”Ÿéšæ®µï¼š<span id="life-stage">å¬°å…’æœŸ</span></span
            >
          </div>
          <div class="card-body">
            <div class="btn-grid" id="action-buttons">
              <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“œ äººç”Ÿå‹•æ…‹</span>
          </div>
          <div class="card-body">
            <div id="game-log" class="log-box"></div>
            <button class="btn-main" onclick="nextYear()">
              ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)
            </button>
          </div>
        </div>
      </div>

      <!-- è·æ¥­é  -->
      <div id="page-career" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’¼ è·æ¥­é¸æ“‡</span>
          </div>
          <div class="card-body">
            <div
              style="
                color: var(--text-dim);
                margin-bottom: 15px;
                font-size: 0.9em;
              "
            >
              ğŸ’¡ é¸æ“‡è·æ¥­å¾Œæ¯å¹´è‡ªå‹•ç²å¾—è–ªæ°´ï¼Œä¸åŒè·æ¥­æœ‰ä¸åŒç‰¹æ®Šæ•ˆæœ
            </div>
            <div id="job-list"></div>
          </div>
        </div>
      </div>

      <!-- è³‡ç”¢é  -->
      <div id="page-assets" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸï¸ è»Šåº«</span>
          </div>
          <div class="card-body" id="car-shop"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ˜ï¸ æˆ¿ç”¢</span>
          </div>
          <div class="card-body" id="house-shop"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’ å¥¢ä¾ˆå“</span>
          </div>
          <div class="card-body" id="luxury-shop"></div>
        </div>
      </div>

      <!-- ç¤¾äº¤é  -->
      <div id="page-social" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’– äººéš›é—œä¿‚</span>
          </div>
          <div class="card-body">
            <div id="npc-list"></div>
            <div id="find-partner-area" style="margin-top: 15px; display: none">
              <button class="btn-main" onclick="findPartner()">
                ğŸ“± ä½¿ç”¨äº¤å‹è»Ÿé«” ($500)
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- æˆå°±é  -->
      <div id="page-profile" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ† æˆå°±ç³»çµ±</span>
          </div>
          <div class="card-body">
            <div id="achievement-list"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“Š äººç”Ÿçµ±è¨ˆ</span>
          </div>
          <div class="card-body" id="stats-panel">
            <!-- å‹•æ…‹ç”Ÿæˆ -->
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <button class="btn-main" onclick="restartGame()">
              ğŸ”„ é‡æ–°é–‹å§‹äººç”Ÿ
            </button>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å°èˆª -->
      <div class="nav-bar">
        <div class="nav-item active" onclick="nav('home', event)">
          <span class="nav-icon">ğŸ </span>
          ç”Ÿæ´»
        </div>
        <div class="nav-item" onclick="nav('career', event)">
          <span class="nav-icon">ğŸ’¼</span>
          è·æ¥­
        </div>
        <div class="nav-item" onclick="nav('assets', event)">
          <span class="nav-icon">ğŸï¸</span>
          è³‡ç”¢
        </div>
        <div class="nav-item" onclick="nav('social', event)">
          <span class="nav-icon">ğŸ’–</span>
          ç¤¾äº¤
        </div>
        <div class="nav-item" onclick="nav('profile', event)">
          <span class="nav-icon">ğŸ†</span>
          æˆå°±
        </div>
      </div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div
      id="event-modal"
      class="modal-overlay"
      onclick="if (event.target === this) closeModal();"
    >
      <div class="modal-box">
        <div class="modal-title" id="ev-title"></div>
        <div class="modal-desc" id="ev-desc"></div>
        <button class="modal-btn" id="btn-choice-a">A</button>
        <button class="modal-btn" id="btn-choice-b">B</button>
      </div>
      <div
        id="ending-overlay"
        class="modal-overlay"
        style="
          z-index: 400;
          display: none;
          align-items: center;
          justify-content: center;
        "
      >
        <div
          class="modal-box"
          style="
            text-align: center;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid var(--gold);
          "
        >
          <div style="font-size: 3em; margin-bottom: 10px" id="ending-icon">
            ğŸ’€
          </div>
          <h2 style="color: var(--gold); margin-bottom: 10px" id="ending-title">
            çµå±€æ¨™é¡Œ
          </h2>
          <p
            style="color: #ddd; line-height: 1.6; margin-bottom: 20px"
            id="ending-desc"
          >
            çµå±€æè¿°...
          </p>

          <div
            id="ending-stats"
            style="
              background: rgba(0, 0, 0, 0.3);
              padding: 15px;
              border-radius: 10px;
              margin-bottom: 20px;
              font-size: 0.9em;
            "
          ></div>

          <button class="btn-main" onclick="location.reload()">
            ğŸ”„ é‡æ–°é–‹å§‹äººç”Ÿ
          </button>
        </div>
      </div>
    </div>

    <script>
      // ==========================================
      // ğŸ”´ è³‡æ–™å®šç¾©
      // ==========================================

      const TALENTS = [
        {
          id: "t1",
          name: "éç›®ä¸å¿˜",
          desc: "å­¸ç¿’æ•ˆç‡+50%",
          type: "good",
          effect: (g) => {
            g.learnBonus = 1.5;
          },
        },
        {
          id: "t2",
          name: "å¤©ç”Ÿç¥åŠ›",
          desc: "å¥åº·è¡°é€€æ¸›åŠ",
          type: "good",
          effect: (g) => {
            g.healthDecay = 0.5;
          },
        },
        {
          id: "t3",
          name: "è¬äººè¿·",
          desc: "é­…åŠ›+20ï¼Œç¤¾äº¤æ•ˆæœ+30%",
          type: "good",
          effect: (g) => {
            g.skills.charm += 20;
            g.socialBonus = 1.3;
          },
        },
        {
          id: "t4",
          name: "æŠ•è³‡çœ¼å…‰",
          desc: "è¢«å‹•æ”¶å…¥+20%",
          type: "good",
          effect: (g) => {
            g.incomeBonus = 1.2;
          },
        },
        {
          id: "t5",
          name: "ç»ç’ƒå¿ƒ",
          desc: "å¿«æ¨‚å€¼ä¸‹é™åŠ å€",
          type: "bad",
          effect: (g) => {
            g.happyDecay = 2;
          },
        },
        {
          id: "t6",
          name: "é«”å¼±å¤šç—…",
          desc: "åˆå§‹å¥åº·-20",
          type: "bad",
          effect: (g) => {
            g.health -= 20;
          },
        },
        {
          id: "t7",
          name: "ç¤¾äº¤ææ‡¼",
          desc: "é­…åŠ›-15",
          type: "bad",
          effect: (g) => {
            g.skills.charm -= 15;
          },
        },
        {
          id: "t8",
          name: "å¯ŒäºŒä»£å¿ƒæ…‹",
          desc: "å·¥ä½œæ”¶å…¥-30%",
          type: "bad",
          effect: (g) => {
            g.workPenalty = 0.7;
          },
        },
        {
          id: "t9",
          name: "å¤©è³¦ç•°ç¨Ÿ",
          desc: "æ‰€æœ‰æŠ€èƒ½æˆé•·+20%",
          type: "good",
          effect: (g) => {
            g.skillBonus = 1.2;
          },
        },
        {
          id: "t10",
          name: "å¹¸é‹æ˜Ÿ",
          desc: "éš¨æ©Ÿäº‹ä»¶æ­£é¢çµæœ+10%",
          type: "good",
          effect: (g) => {
            g.luckBonus = 0.1;
          },
        },
      ];
      // ==========================================
      // ğŸ†• æ–°å¢ï¼šå­˜æª”ç³»çµ± (å·²ä¿®æ­£è®Šæ•¸åç¨±)
      // ==========================================
      const SAVE_KEY = "lifeSimV17_save";

     function saveGame() {
        const saveData = {
          version: "17.0",
          timestamp: Date.now(),
          player: Game.name, // ä¿®æ­£ï¼šgame -> Game
          age: Game.age,
          money: Game.money,
          health: Game.health,
          happy: Game.happy,
          intel: Game.intel,
          stamina: Game.stamina,
          skills: { ...Game.skills },
          job: Game.job,
          origin: Game.origin,
          traits: [...Game.traits],
          talents: [...Game.talents],
          items: [...Game.items],
          npcs: Game.npcs.map((n) => ({ ...n })),
          achievements: [...Game.achievements],
          stats: { ...Game.stats },
          lifeStage: Game.lifeStage,
          partner: Game.partner,
          gender: Game.gender,
        };

        try {
          localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
          showPopup("ğŸ’¾ å­˜æª”æˆåŠŸï¼", "green");
          return true;
        } catch (e) {
          showPopup("âŒ å­˜æª”å¤±æ•—", "red");
          return false;
        }
      }

      function loadGame() {
        try {
          const saved = localStorage.getItem(SAVE_KEY);
          if (!saved) {
            showPopup("âŒ æ²’æœ‰å­˜æª”è¨˜éŒ„", "red");
            return false;
          }

          const data = JSON.parse(saved);

          // ä¿®æ­£ï¼šgame -> Game
          Game.name = data.player;
          Game.age = data.age;
          Game.money = data.money;
          Game.health = data.health;
          Game.happy = data.happy;
          Game.intel = data.intel;
          Game.stamina = data.stamina;
          Game.skills = data.skills;
          Game.job = data.job;
          Game.origin = data.origin;
          Game.traits = data.traits;
          Game.talents = data.talents;
          Game.items = data.items;
          Game.npcs = data.npcs;
          Game.achievements = data.achievements;
          Game.stats = data.stats;
          Game.lifeStage = data.lifeStage;
          Game.partner = data.partner;
          Game.gender = data.gender;

          document.getElementById("scene-creation").style.display = "none";
          document.getElementById("scene-game").classList.add("active");
          document.getElementById("scene-game").style.display = "block";

          updateUI();
          // renderAll(); // é€™ä¸€è¡Œå¦‚æœå ±éŒ¯å¯ä»¥æ‹¿æ‰ï¼Œå› ç‚º updateUI å·²ç¶“åšäº†å¤§éƒ¨åˆ†å·¥ä½œ

          const date = new Date(data.timestamp);
          showPopup(`âœ… è®€å–æˆåŠŸï¼\n${date.toLocaleString("zh-TW")}`, "green");
          return true;
        } catch (e) {
          showPopup("âŒ è®€æª”å¤±æ•—", "red");
          return false;
        }
      }

      function deleteSave() {
        if (confirm("ç¢ºå®šè¦åˆªé™¤å­˜æª”å—ï¼Ÿ")) {
          localStorage.removeItem(SAVE_KEY);
          showPopup("ğŸ—‘ï¸ å­˜æª”å·²åˆªé™¤", "orange");
        }
      }

      // ===== å€‹äººç‰¹è³ªç³»çµ± =====
      const TRAITS = [
        // 38ä¸ªç‰¹è´¨
        // ===== 20ä¸ªæ€§æ ¼ç‰¹è´¨ =====
        {
          id: "optimistic",
          name: "ğŸŒŸ æ¨‚è§€ä¸»ç¾©è€…",
          desc: "ç¸½æ˜¯çœ‹åˆ°äº‹æƒ…å…‰æ˜çš„ä¸€é¢",
          detailedEffect: "å¿«æ¨‚è¡°æ¸› -30%\nåˆå§‹å¿«æ¨‚ +10",
          category: "personality",
          conflictWith: ["pessimistic"], // âœ… ä¸æ‚²è§‚å†²çª
          effect: (g) => {
            g.happyDecay *= 0.7;
            g.happy += 10;
          },
          unlock: "default",
        },

        {
          id: "pessimistic",
          name: "ğŸ˜” æ‚²è§€ä¸»ç¾©è€…",
          desc: "å®¹æ˜“é™·å…¥è² é¢æƒ…ç·’",
          detailedEffect: "å¿«æ¨‚è¡°æ¸› +30%\næ™ºåŠ› +5",
          category: "personality",
          isNegative: true, // âœ… æ ‡è®°ä¸ºè´Ÿé¢ç‰¹è´¨
          reward: { money: 50000, intel: 5 }, // âœ… è´Ÿé¢å¥–åŠ±
          conflictWith: ["optimistic"],
          effect: (g) => {
            g.happyDecay *= 1.3;
            g.intel += 5;
          },
          unlock: "default",
        },

        {
          id: "extrovert",
          name: "ğŸ‰ å¤–å‘",
          desc: "å–„æ–¼ç¤¾äº¤ï¼Œå®¹æ˜“äº¤æœ‹å‹",
          detailedEffect: "ç¤¾äº¤æ•ˆæœ +50%\né­…åŠ› +10\nåˆå§‹å¥½æ„Ÿ +5",
          category: "personality",
          conflictWith: ["introvert"],
          effect: (g) => {
            g.socialBonus *= 1.5;
            g.skills.charm += 10;
          },
          unlock: "default",
        },

        {
          id: "introvert",
          name: "ğŸ“š å…§å‘",
          desc: "å–œæ­¡ç¨è™•ï¼Œæ·±åº¦æ€è€ƒ",
          detailedEffect: "å­¸ç¿’æ•ˆç‡ +30%\næºé€š -5\né­…åŠ›æˆé•· -2\nåˆå§‹æ™ºåŠ› +20",
          category: "personality",
          isNegative: true,
          reward: { intel: 20, money: 30000 },
          conflictWith: ["extrovert"],
          effect: (g) => {
            g.learnBonus *= 1.3;
            g.skills.communication -= 5;
          },
          unlock: "default",
        },

        {
          id: "brave",
          name: "ğŸ’ª å‹‡æ•¢",
          desc: "ä¸ç•è‰±é›£ï¼Œå‹‡æ–¼æŒ‘æˆ°",
          detailedEffect:
            "å¥åº· +10\né­…åŠ› +5\næŠ•è³‡æˆåŠŸç‡ +30%\né¢¨éšªå·¥ä½œæ”¶å…¥ +5%",
          category: "personality",
          conflictWith: ["cautious"],
          effect: (g) => {
            g.health += 10;
            g.skills.charm += 5;
          },
          unlock: "default",
        },

        {
          id: "cautious",
          name: "ğŸ›¡ï¸ è¬¹æ…",
          desc: "å°å¿ƒè¬¹æ…ï¼Œè¦é¿é¢¨éšª",
          detailedEffect: "å¥åº·è¡°æ¸› -20%\nå¿«æ¨‚ -5\næŠ•è³‡å¤±æ•—æå¤± -50%",
          category: "personality",
          isNegative: true,
          reward: { money: 40000, health: 15 },
          conflictWith: ["brave", "impulsive"],
          effect: (g) => {
            g.healthDecay *= 0.8;
            g.happy -= 5;
          },
          unlock: "default",
        },

        {
          id: "ambitious",
          name: "ğŸ”¥ é‡å¿ƒå‹ƒå‹ƒ",
          desc: "è¿½æ±‚æˆåŠŸèˆ‡è²¡å¯Œ",
          detailedEffect: "æ”¶å…¥åŠ æˆ +20%\nå¿«æ¨‚ -10\nå·¥ä½œæ”¶å…¥ +30%",
          category: "personality",
          conflictWith: ["content", "laidback"],
          effect: (g) => {
            g.incomeBonus *= 1.2;
            g.happy -= 10;
          },
          unlock: "default",
        },

        {
          id: "content",
          name: "ğŸ˜Œ çŸ¥è¶³å¸¸æ¨‚",
          desc: "å®¹æ˜“æ„Ÿåˆ°æ»¿è¶³",
          detailedEffect: "å¿«æ¨‚ +15\næ”¶å…¥æ¸›å°‘ -10%\nå¿«æ¨‚è¡°æ¸› -40%",
          category: "personality",
          conflictWith: ["ambitious", "competitive"],
          effect: (g) => {
            g.happy += 15;
            g.incomeBonus *= 0.9;
            g.happyDecay *= 0.6;
          },
          unlock: "default",
        },

        {
          id: "stubborn",
          name: "ğŸ˜¤ å›ºåŸ·",
          desc: "å …æŒå·±è¦‹ï¼Œä¸æ˜“æ”¹è®Š",
          detailedEffect: "æ™ºåŠ› +5\nç¤¾äº¤æ•ˆæœ -20%\né­…åŠ› -5",
          category: "personality",
          isNegative: true,
          reward: { intel: 10, money: 35000 },
          conflictWith: ["flexible"],
          effect: (g) => {
            g.intel += 5;
            g.socialBonus *= 0.8;
            g.skills.charm -= 5;
          },
          unlock: "default",
        },

        {
          id: "flexible",
          name: "ğŸŒŠ éˆæ´»",
          desc: "é©æ‡‰åŠ›å¼·ï¼Œéš¨æ©Ÿæ‡‰è®Š",
          detailedEffect: "æºé€š +10\né­…åŠ› +10\nç¤¾äº¤æ•ˆæœ +20%",
          category: "personality",
          conflictWith: ["stubborn"],
          effect: (g) => {
            g.skills.communication += 10;
            g.skills.charm += 10;
            g.socialBonus *= 1.2;
          },
          unlock: "default",
        },

        {
          id: "competitive",
          name: "ğŸ† å¥½å‹",
          desc: "ä¸ç”˜è½å¾Œï¼ŒåŠ›çˆ­ä¸Šæ¸¸",
          detailedEffect: "æŠ€èƒ½æˆé•· +20%\nå¿«æ¨‚ -5",
          category: "personality",
          conflictWith: ["laidback", "content"],
          effect: (g) => {
            g.skillBonus *= 1.2;
            g.happy -= 5;
          },
          unlock: "default",
        },

        {
          id: "laidback",
          name: "ğŸ˜ éš¨æ€§",
          desc: "ä¸æ€¥ä¸å¾ï¼Œéš¨é‡è€Œå®‰",
          detailedEffect: "å¿«æ¨‚ +10\næŠ€èƒ½æˆé•· -10%\nå¥åº·è¡°æ¸› -20%",
          category: "personality",
          isNegative: true,
          reward: { happy: 15, money: 25000 },
          conflictWith: ["competitive", "ambitious"],
          effect: (g) => {
            g.happy += 10;
            g.skillBonus *= 0.9;
            g.healthDecay *= 0.8;
          },
          unlock: "default",
        },

        {
          id: "honest",
          name: "ğŸ¤ èª å¯¦",
          desc: "å¦èª å¾…äººï¼Œå€¼å¾—ä¿¡è³´",
          detailedEffect: "NPCå¥½æ„Ÿæˆé•· +5\næ”¶å…¥ -10%\nç¤¾äº¤ +15%",
          category: "personality",
          conflictWith: ["cunning"],
          effect: (g) => {
            g.socialBonus *= 1.15;
            g.incomeBonus *= 0.9;
          },
          unlock: "default",
        },

        {
          id: "cunning",
          name: "ğŸ¦Š ç‹¡çŒ¾",
          desc: "å–„æ–¼ç®—è¨ˆï¼Œæ‡‚å¾—å–å·§",
          detailedEffect: "æ”¶å…¥åŠ æˆ +30%\nå¿«æ¨‚ -5\nNPCå¥½æ„Ÿ -3",
          category: "personality",
          conflictWith: ["honest"],
          effect: (g) => {
            g.incomeBonus *= 1.3;
            g.happy -= 5;
          },
          unlock: "default",
        },

        {
          id: "impulsive",
          name: "âš¡ è¡å‹•",
          desc: "è¡å‹•è¡Œäº‹ï¼Œä¸è¨ˆå¾Œæœ",
          detailedEffect: "å¿«æ¨‚ +5\néš¨æ©Ÿäº‹ä»¶æ©Ÿç‡ +50%\næŠ•è³‡æ³¢å‹• +30%",
          category: "personality",
          isNegative: true,
          reward: { money: 45000, charm: 10 },
          conflictWith: ["thoughtful", "cautious"],
          effect: (g) => {
            g.happy += 5;
            g.luckBonus += 0.1;
          },
          unlock: "default",
        },

        {
          id: "thoughtful",
          name: "ğŸ¤” æ·±æ€ç†Ÿæ…®",
          desc: "ä¸‰æ€è€Œå¾Œè¡Œ",
          detailedEffect: "æ™ºåŠ› +8\nå¿«æ¨‚ -3\nå­¸ç¿’æ•ˆç‡ +20%",
          category: "personality",
          conflictWith: ["impulsive"],
          effect: (g) => {
            g.intel += 8;
            g.happy -= 3;
          },
          unlock: "default",
        },

        {
          id: "romantic",
          name: "ğŸ’• æµªæ¼«ä¸»ç¾©",
          desc: "è¿½æ±‚æµªæ¼«èˆ‡æƒ…æ„Ÿ",
          detailedEffect: "é­…åŠ› +12\nå¿«æ¨‚ +8\næˆ€æ„›æˆåŠŸç‡ +40%",
          category: "personality",
          conflictWith: ["realistic"],
          effect: (g) => {
            g.skills.charm += 12;
            g.happy += 8;
          },
          unlock: "default",
        },

        {
          id: "realistic",
          name: "ğŸ’¼ ç¾å¯¦ä¸»ç¾©",
          desc: "æ³¨é‡å¯¦éš›åˆ©ç›Š",
          detailedEffect: "æ™ºåŠ› +5\né‡‘è +10\nå¿«æ¨‚ -5",
          category: "personality",
          conflictWith: ["romantic"],
          effect: (g) => {
            g.intel += 5;
            g.skills.finance += 10;
            g.happy -= 5;
          },
          unlock: "default",
        },

        {
          id: "humorous",
          name: "ğŸ˜„ å¹½é»˜é¢¨è¶£",
          desc: "å–„æ–¼è£½é€ æ­¡æ¨‚æ°£æ°›",
          detailedEffect: "é­…åŠ› +15\nå¿«æ¨‚ +10\nç¤¾äº¤æ•ˆæœ +25%",
          category: "personality",
          conflictWith: ["serious"],
          effect: (g) => {
            g.skills.charm += 15;
            g.happy += 10;
            g.socialBonus *= 1.25;
          },
          unlock: "default",
        },

        {
          id: "serious",
          name: "ğŸ˜ åš´è‚…",
          desc: "åšäº‹èªçœŸï¼Œä¸è‹Ÿè¨€ç¬‘",
          detailedEffect: "æ™ºåŠ› +10\né­…åŠ› -8\nå·¥ä½œæ•ˆç‡ +20%",
          category: "personality",
          isNegative: true,
          reward: { intel: 15, money: 40000 },
          conflictWith: ["humorous"],
          effect: (g) => {
            g.intel += 10;
            g.skills.charm -= 8;
          },
          unlock: "default",
        },

        // ===== 12ä¸ªèƒ½åŠ›ç‰¹è´¨ =====
        {
          id: "quicklearner",
          name: "ğŸ§  å¿«é€Ÿå­¸ç¿’",
          desc: "å­¸ç¿’èƒ½åŠ›è¶…ç¾¤",
          detailedEffect: "å­¸ç¿’æ•ˆç‡ +40%\næŠ€èƒ½æˆé•· +50%",
          category: "ability",
          effect: (g) => {
            g.learnBonus *= 1.4;
          },
          unlock: "default",
        },

        {
          id: "athletic",
          name: "ğŸƒ é‹å‹•å¥å°‡",
          desc: "é«”èƒ½å„ªç•°",
          detailedEffect: "å¥åº· +15\né«”åŠ›ä¸Šé™ +20\nåˆå§‹é«”åŠ› +50%",
          category: "ability",
          effect: (g) => {
            g.health += 15;
            g.maxStamina += 20;
            g.stamina += 20;
          },
          unlock: "default",
        },

        {
          id: "artistic",
          name: "ğŸ¨ è—è¡“å¤©è³¦",
          desc: "è—è¡“æ„ŸçŸ¥åŠ›å¼·",
          detailedEffect: "è—è¡“ +20\né­…åŠ› +15\nè—è¡“é¡è·æ¥­æ”¶å…¥ +50%",
          category: "ability",
          effect: (g) => {
            g.skills.art += 20;
            g.skills.charm += 15;
          },
          unlock: "default",
        },

        {
          id: "charismatic",
          name: "âœ¨ é­…åŠ›éå‡¡",
          desc: "å¤©ç”Ÿçš„é ˜è¢–æ°£è³ª",
          detailedEffect: "é­…åŠ› +15\nç¤¾äº¤æ•ˆæœ +30%\nåˆå§‹å¥½æ„Ÿ +3",
          category: "ability",
          effect: (g) => {
            g.skills.charm += 15;
            g.socialBonus *= 1.3;
          },
          unlock: "default",
        },

        {
          id: "businessmind",
          name: "ğŸ’° å•†æ¥­é ­è…¦",
          desc: "å¤©ç”Ÿçš„å•†æ¥­å—…è¦º",
          detailedEffect: "æ”¶å…¥åŠ æˆ +30%\né‡‘è +15\nå‰µæ¥­æˆåŠŸç‡ +50%",
          category: "ability",
          effect: (g) => {
            g.incomeBonus *= 1.3;
            g.skills.finance += 15;
          },
          unlock: "default",
        },

        {
          id: "techsavvy",
          name: "ğŸ’» ç§‘æŠ€é”äºº",
          desc: "ç²¾é€šç§‘æŠ€",
          detailedEffect: "ç¨‹å¼ +20\næ™ºåŠ› +5\nç§‘æŠ€é¡è·æ¥­æ”¶å…¥ +30%",
          category: "ability",
          effect: (g) => {
            g.skills.programming += 20;
            g.intel += 5;
          },
          unlock: "default",
        },

        {
          id: "medicaltalent",
          name: "âš•ï¸ é†«å­¸å¤©è³¦",
          desc: "é†«å­¸æ½›åŠ›é©šäºº",
          detailedEffect: "é†«ç™‚ +25\næ™ºåŠ› +8\nå¥åº·è¡°æ¸› -15%",
          category: "ability",
          effect: (g) => {
            g.skills.medical += 25;
            g.intel += 8;
            g.healthDecay *= 0.85;
          },
          unlock: "default",
        },

        {
          id: "culinarygenius",
          name: "ğŸ‘¨â€ğŸ³ å»šè—å¤©æ‰",
          desc: "æ–™ç†å¤©è³¦ç•°ç¨Ÿ",
          detailedEffect: "å»šè— +30\nè—è¡“ +10\nå¿«æ¨‚ +5",
          category: "ability",
          effect: (g) => {
            g.skills.cooking += 30;
            g.skills.art += 10;
            g.happy += 5;
          },
          unlock: "default",
        },

        {
          id: "polyglot",
          name: "ğŸŒ èªè¨€å¤©æ‰",
          desc: "ç²¾é€šå¤šåœ‹èªè¨€",
          detailedEffect: "æºé€š +20\né­…åŠ› +10\næ”¶å…¥åŠ æˆ +15%",
          category: "ability",
          effect: (g) => {
            g.skills.communication += 20;
            g.skills.charm += 10;
            g.incomeBonus *= 1.15;
          },
          unlock: "default",
        },

        {
          id: "photographicmemory",
          name: "ğŸ“· éç›®ä¸å¿˜",
          desc: "è¶…å¼·è¨˜æ†¶åŠ›",
          detailedEffect: "æ™ºåŠ› +15\nå­¸ç¿’æ•ˆç‡ +30%\næŠ€èƒ½æˆé•· +20%",
          category: "ability",
          effect: (g) => {
            g.intel += 15;
            g.learnBonus *= 1.3;
            g.skillBonus *= 1.2;
          },
          unlock: "default",
        },

        {
          id: "creative",
          name: "ğŸ’¡ å‰µæ„ç„¡é™",
          desc: "å‰µæ„æ€ç¶­å‡ºçœ¾",
          detailedEffect: "è—è¡“ +15\nç¨‹å¼ +10\nå‰µæ¥­æ”¶å…¥ +25%",
          category: "ability",
          effect: (g) => {
            g.skills.art += 15;
            g.skills.programming += 10;
          },
          unlock: "default",
        },

        {
          id: "persuasive",
          name: "ğŸ—£ï¸ èªªæœåŠ›å¼·",
          desc: "å£æ‰çµ•ä½³",
          detailedEffect: "æºé€š +18\né­…åŠ› +12\nç¤¾äº¤æ•ˆæœ +20%",
          category: "ability",
          effect: (g) => {
            g.skills.communication += 18;
            g.skills.charm += 12;
            g.socialBonus *= 1.2;
          },
          unlock: "default",
        },

        // ===== 6ä¸ªç‰¹æ®Šç‰¹è´¨ =====
        {
          id: "lucky",
          name: "ğŸ€ å¹¸é‹å…’",
          desc: "é‹æ°£æ¥µä½³",
          detailedEffect: "å¹¸é‹åŠ æˆ +20%\néš¨æ©Ÿå¥½äº‹æ©Ÿç‡ +50%",
          category: "special",
          effect: (g) => {
            g.luckBonus += 0.2;
          },
          unlock: "event",
        },

        {
          id: "workaholic",
          name: "ğŸ’¼ å·¥ä½œç‹‚",
          desc: "æ²‰è¿·å·¥ä½œ",
          detailedEffect: "æ”¶å…¥åŠ æˆ +40%\nå¥åº·è¡°æ¸› +30%",
          category: "special",
          effect: (g) => {
            g.incomeBonus *= 1.4;
            g.healthDecay *= 1.3;
          },
          unlock: "achievement",
        },

        {
          id: "immortal",
          name: "â³ é•·å£½åŸºå› ",
          desc: "è¶…é•·å£½å‘½",
          detailedEffect: "å¥åº·è¡°æ¸› -50%",
          category: "special",
          effect: (g) => {
            g.healthDecay *= 0.5;
          },
          unlock: "age",
        },

        {
          id: "geniusmind",
          name: "ğŸ“ å¤©æ‰å¿ƒæ™º",
          desc: "æ™ºåŠ›è¶…ç¾¤",
          detailedEffect: "æ™ºåŠ› +30\nå­¸ç¿’æ•ˆç‡ +50%",
          category: "special",
          effect: (g) => {
            g.intel += 30;
            g.learnBonus *= 1.5;
          },
          unlock: "achievement",
        },

        {
          id: "socialmaster",
          name: "ğŸŒŸ ç¤¾äº¤å¤§å¸«",
          desc: "ç¤¾äº¤èƒ½åŠ›é ‚å°–",
          detailedEffect: "æºé€š +30\né­…åŠ› +20\nç¤¾äº¤æ•ˆæœ x2",
          category: "special",
          effect: (g) => {
            g.skills.communication += 30;
            g.skills.charm += 20;
            g.socialBonus *= 2;
          },
          unlock: "achievement",
        },

        {
          id: "wealthy",
          name: "ğŸ’ å¯Œå¯æ•µåœ‹",
          desc: "è²¡å¯Œé©šäºº",
          detailedEffect: "æ”¶å…¥åŠ æˆ x2\nå¿«æ¨‚ +20",
          category: "special",
          effect: (g) => {
            g.incomeBonus *= 2;
            g.happy += 20;
          },
          unlock: "achievement",
        },
      ];

      const ORIGINS = [
        // ===== åŸºç¡€å‡ºèº« =====
        {
          id: "common",
          name: "å¹³å‡¡",
          desc: "æ™®é€šçš„å°åº·å®¶åº­",
          parents: "å…¬å‹™å“¡ & è€å¸«",
          money: 30000, // âœ… åŸ 50000 â†’ 30000 (-40%)
          intel: 50,
          happy: 80,
          yearlyMoney: 500, // âœ… åŸ 1000 â†’ 500 (-50%)
          buff: "ç„¡ç‰¹æ®ŠåŠ æˆ",
        },

        {
          id: "rich",
          name: "å¯ŒäºŒä»£",
          desc: "çˆ¶æ¯æ˜¯æˆåŠŸçš„ä¼æ¥­å®¶",
          parents: "CEO & è‘£äº‹",
          money: 3000000, // âœ… åŸ 5000000 â†’ 3000000 (-40%)
          intel: 40,
          happy: 90,
          yearlyMoney: 60000, // âœ… åŸ 100000 â†’ 60000 (-40%)
          buff: "æ¯å¹´è¢«å‹•æ”¶å…¥ 6è¬ï¼Œé­…åŠ› +10",
        },

        {
          id: "genius",
          name: "å¤©æ‰",
          desc: "æ™ºå•†é è¶…å¸¸äºº",
          parents: "ç ”ç©¶å“¡ & æ•™æˆ",
          money: -50000, // â­ ä¿æŒè´Ÿå€ºä¸å˜
          intel: 120,
          happy: 60,
          yearlyMoney: 0, // â­ æœ¬æ¥å°±æ˜¯ 0
          buff: "æ™ºå•† +120ï¼Œåˆå§‹è² å‚µ 5è¬",
        },

        {
          id: "star",
          name: "æ˜ŸäºŒä»£",
          desc: "çˆ¶æ¯æ˜¯çŸ¥åè—äºº",
          parents: "å½±å¸ & æ­Œå",
          money: 600000, // âœ… åŸ 1000000 â†’ 600000 (-40%)
          intel: 50,
          happy: 70,
          yearlyMoney: 30000, // âœ… åŸ 50000 â†’ 30000 (-40%)
          buff: "é­…åŠ›è‡ªç„¶é«˜",
        },

        {
          id: "scholar",
          name: "æ›¸é¦™ä¸–å®¶",
          desc: "çŸ¥è­˜åˆ†å­å®¶åº­",
          parents: "å¤§å­¸æ•™æˆ & åœ–æ›¸é¤¨é•·",
          money: 120000, // âœ… åŸ 200000 â†’ 120000 (-40%)
          intel: 80,
          happy: 75,
          yearlyMoney: 3000, // âœ… åŸ 5000 â†’ 3000 (-40%)
          buff: "æ™ºå•†é«˜ï¼Œæ„›è®€æ›¸",
        },

        {
          id: "military",
          name: "è»äººä¸–å®¶",
          desc: "è»äººå®¶åº­èƒŒæ™¯",
          parents: "å°‡è» & è»é†«",
          money: 90000, // âœ… åŸ 150000 â†’ 90000 (-40%)
          intel: 60,
          happy: 70,
          yearlyMoney: 1800, // âœ… åŸ 3000 â†’ 1800 (-40%)
          buff: "å¥åº· +20",
        },

        {
          id: "doctor",
          name: "é†«ç”Ÿä¸–å®¶",
          desc: "é†«ç™‚èƒŒæ™¯å®¶åº­",
          parents: "ä¸»ä»»é†«å¸« & è­·ç†å¸«",
          money: 480000, // âœ… åŸ 800000 â†’ 480000 (-40%)
          intel: 85,
          happy: 75,
          yearlyMoney: 6000, // âœ… åŸ 10000 â†’ 6000 (-40%)
          buff: "é†«å­¸æŠ€èƒ½ +30",
        },

        // ===== å›°éš¾å‡ºèº« =====
        {
          id: "farmer",
          name: "è¾²å®¶",
          desc: "å‹™è¾²å®¶åº­",
          parents: "æœè¾² & èœè¾²",
          money: 12000, // âœ… åŸ 20000 â†’ 12000 (-40%)
          intel: 40,
          happy: 85,
          yearlyMoney: 300, // âœ… åŸ 500 â†’ 300 (-40%)
          buff: "å¥åº· +15ï¼Œå¿«æ¨‚ +5",
        },

        {
          id: "fisher",
          name: "æ¼æ°‘",
          desc: "æ¼æ‘å®¶åº­",
          parents: "æ¼æ°‘ & æ¼æ°‘",
          money: 18000, // âœ… åŸ 30000 â†’ 18000 (-40%)
          intel: 45,
          happy: 80,
          yearlyMoney: 600, // âœ… åŸ 1000 â†’ 600 (-40%)
          buff: "å¥åº· +10",
        },

        {
          id: "aboriginal",
          name: "åŸä½æ°‘",
          desc: "åŸä½æ°‘éƒ¨è½",
          parents: "é ­ç›® & ç¹”å¸ƒå¸«",
          money: 6000, // âœ… åŸ 10000 â†’ 6000 (-40%)
          intel: 45,
          happy: 90,
          yearlyMoney: 300, // âœ… åŸ 500 â†’ 300 (-40%)
          buff: "é­…åŠ› +15ï¼Œè—è¡“ +20ï¼Œå¿«æ¨‚ +10",
        },

        {
          id: "immigrant",
          name: "ç§»æ°‘",
          desc: "æ–°ç§»æ°‘å®¶åº­",
          parents: "ç§»å·¥ & ç§»å·¥",
          money: 18000, // âœ… åŸ 30000 â†’ 18000 (-40%)
          intel: 55,
          happy: 75,
          yearlyMoney: 480, // âœ… åŸ 800 â†’ 480 (-40%)
          buff: "æºé€š +20",
        },

        {
          id: "singleparent",
          name: "å–®è¦ªå®¶åº­",
          desc: "å–®è¦ªæ’«é¤Š",
          parents: "å–®è¦ªåª½åª½",
          money: -12000, // âœ… åŸ -20000 â†’ -12000 (å€ºåŠ¡å‡å°‘40%)
          intel: 55,
          happy: 65,
          yearlyMoney: 0, // â­ ä¿æŒ 0
          buff: "å …å¼·ç¨ç«‹",
        },

        // ===== ç‰¹æ®Šå‡ºèº« =====
        {
          id: "tech",
          name: "ç§‘æŠ€æ–°è²´",
          desc: "ç§‘æŠ€æ¥­çˆ¶æ¯",
          parents: "PM & å·¥ç¨‹å¸«",
          money: 300000, // âœ… åŸ 500000 â†’ 300000 (-40%)
          intel: 75,
          happy: 70,
          yearlyMoney: 9000, // âœ… åŸ 15000 â†’ 9000 (-40%)
          buff: "ç¨‹å¼ +30",
        },

        {
          id: "artist",
          name: "è—è¡“å®¶åº­",
          desc: "è—è¡“ä¸–å®¶",
          parents: "ç•«å®¶ & éŸ³æ¨‚å®¶",
          money: 48000, // âœ… åŸ 80000 â†’ 48000 (-40%)
          intel: 65,
          happy: 85,
          yearlyMoney: 1200, // âœ… åŸ 2000 â†’ 1200 (-40%)
          buff: "è—è¡“ +40ï¼Œé­…åŠ› +10",
        },

        {
          id: "politician",
          name: "æ”¿æ²»ä¸–å®¶",
          desc: "æ”¿æ²»äººç‰©å®¶åº­",
          parents: "ç«‹å§” & å¸‚é•·",
          money: 1200000, // âœ… åŸ 2000000 â†’ 1200000 (-40%)
          intel: 70,
          happy: 75,
          yearlyMoney: 18000, // âœ… åŸ 30000 â†’ 18000 (-40%)
          buff: "æºé€š +25",
        },

        {
          id: "orphan",
          name: "å­¤å…’",
          desc: "å¾å°åœ¨è‚²å¹¼é™¢é•·å¤§",
          parents: "ç„¡",
          money: 0, // â­ ä¿æŒ 0
          intel: 50,
          happy: 50,
          yearlyMoney: 0, // â­ ä¿æŒ 0
          buff: "å …éŸŒä¸æ‹” +30",
        },

        {
          id: "temple",
          name: "å®®å»Ÿä¸–å®¶",
          desc: "å®®å»Ÿç®¡ç†å®¶åº­",
          parents: "å»Ÿç¥ & ä¹©ç«¥",
          money: 180000, // âœ… åŸ 300000 â†’ 180000 (-40%)
          intel: 50,
          happy: 80,
          yearlyMoney: 3000, // âœ… åŸ 5000 â†’ 3000 (-40%)
          buff: "æºé€š +15ï¼Œå¿«æ¨‚ +5",
        },

        {
          id: "mafia",
          name: "é»‘é“ä¸–å®¶",
          desc: "é»‘é“èƒŒæ™¯",
          parents: "å ‚ä¸» & å ‚å£å¤§å§",
          money: 300000, // âœ… åŸ 500000 â†’ 300000 (-40%)
          intel: 45,
          happy: 60,
          yearlyMoney: 12000, // âœ… åŸ 20000 â†’ 12000 (-40%)
          buff: "é­…åŠ› +20ï¼Œå¥åº· +15",
        },

        // ===== é ‚ç´šç‰¹æ®Šå‡ºèº« =====
        {
          id: "royal",
          name: "çš‡æ—",
          desc: "é¡¯èµ«çš„çš‡å®¤è¡€çµ±",
          parents: "åœ‹ç‹ & ç‹å",
          money: 6000000, // âœ… åŸ 10000000 â†’ 6000000 (-40%)
          intel: 70,
          happy: 60,
          yearlyMoney: 120000, // âœ… åŸ 200000 â†’ 120000 (-40%)
          buff: "æ¯å¹´ 12è¬è¢«å‹•æ”¶å…¥ï¼Œé­…åŠ› +100",
          special: "royal",
        },

        {
          id: "hacker",
          name: "é§­å®¢ä¸–å®¶",
          desc: "é ‚å°–é§­å®¢å®¶åº­",
          parents: "ç™½å¸½é§­å®¢ & è³‡å®‰å°ˆå®¶",
          money: 180000, // âœ… åŸ 300000 â†’ 180000 (-40%)
          intel: 100,
          happy: 65,
          yearlyMoney: 4800, // âœ… åŸ 8000 â†’ 4800 (-40%)
          buff: "ç¨‹å¼èƒ½åŠ› +50",
          special: "hacker",
        },

        {
          id: "detective",
          name: "åµæ¢ä¸–å®¶",
          desc: "ååµæ¢å®¶æ—",
          parents: "åä¾¦æ¢ & çŠ¯ç½ªå¿ƒç†å­¸å®¶",
          money: 108000, // âœ… åŸ 180000 â†’ 108000 (-40%)
          intel: 90,
          happy: 70,
          yearlyMoney: 2400, // âœ… åŸ 4000 â†’ 2400 (-40%)
          buff: "æ™ºå•† +40",
          special: "detective",
        },

        {
          id: "cheffamily",
          name: "åå»šä¸–å®¶",
          desc: "ç±³å…¶æ—å®¶æ—",
          parents: "ç±³å…¶æ—ä¸»å»š & ç”œé»å¸«",
          money: 300000, // âœ… åŸ 500000 â†’ 300000 (-40%)
          intel: 60,
          happy: 85,
          yearlyMoney: 7200, // âœ… åŸ 12000 â†’ 7200 (-40%)
          buff: "å»šè— +60ï¼Œè—è¡“ +20",
          special: "chef",
        },

        {
          id: "monk",
          name: "ä¿®è¡Œä¸–å®¶",
          desc: "ä½›é–€ä¸–å®¶",
          parents: "ä½æŒ & æ³•å¸«",
          money: 3000, // âœ… åŸ 5000 â†’ 3000 (-40%)
          intel: 75,
          happy: 90,
          yearlyMoney: 0, // â­ ä¿æŒ 0
          buff: "å¥åº· +25ï¼Œå¿«æ¨‚ +10",
          special: "monk",
        },

        {
          id: "circus",
          name: "é¦¬æˆ²åœ˜ä¸–å®¶",
          desc: "é¦¬æˆ²åœ˜å®¶æ—",
          parents: "åœ˜é•· & ç©ºä¸­é£›äºº",
          money: 30000, // âœ… åŸ 50000 â†’ 30000 (-40%)
          intel: 50,
          happy: 80,
          yearlyMoney: 1200, // âœ… åŸ 2000 â†’ 1200 (-40%)
          buff: "é­…åŠ› +25ï¼Œå¥åº· +10",
          special: "circus",
        },

        {
          id: "diplomat",
          name: "å¤–äº¤ä¸–å®¶",
          desc: "å¤–äº¤å®˜å®¶æ—",
          parents: "å¤§ä½¿ & å¤–äº¤å®˜",
          money: 720000, // âœ… åŸ 1200000 â†’ 720000 (-40%)
          intel: 85,
          happy: 75,
          yearlyMoney: 15000, // âœ… åŸ 25000 â†’ 15000 (-40%)
          buff: "æºé€š +35",
          special: "diplomat",
        },

        {
          id: "esports",
          name: "é›»ç«¶ä¸–å®¶",
          desc: "é›»ç«¶å† è»å®¶åº­",
          parents: "é›»ç«¶æ•™ç·´ & è·æ¥­é¸æ‰‹",
          money: 360000, // âœ… åŸ 600000 â†’ 360000 (-40%)
          intel: 65,
          happy: 85,
          yearlyMoney: 9000, // âœ… åŸ 15000 â†’ 9000 (-40%)
          buff: "åæ‡‰åŠ›è¶…ç¾¤",
          special: "esports",
        },

        {
          id: "spy",
          name: "é–“è«œä¸–å®¶",
          desc: "æƒ…å ±ä¸–å®¶",
          parents: "ç‰¹å‹™ & æƒ…å ±å“¡",
          money: 480000, // âœ… åŸ 800000 â†’ 480000 (-40%)
          intel: 95,
          happy: 60,
          yearlyMoney: 12000, // âœ… åŸ 20000 â†’ 12000 (-40%)
          buff: "æ™ºå•† +45",
          special: "spy",
        },

        {
          id: "archaeologist",
          name: "è€ƒå¤ä¸–å®¶",
          desc: "è€ƒå¤å­¸å®¶å®¶æ—",
          parents: "è€ƒå¤å­¸å®¶ & åšç‰©é¤¨é•·",
          money: 150000, // âœ… åŸ 250000 â†’ 150000 (-40%)
          intel: 88,
          happy: 78,
          yearlyMoney: 3600, // âœ… åŸ 6000 â†’ 3600 (-40%)
          buff: "æ™ºå•† +38",
          special: "archaeologist",
        },

        {
          id: "fashion",
          name: "æ™‚å°šä¸–å®¶",
          desc: "æ™‚å°šè¨­è¨ˆå¸«å®¶æ—",
          parents: "æ™‚è£è¨­è¨ˆå¸« & è¶…æ¨¡",
          money: 1800000, // âœ… åŸ 3000000 â†’ 1800000 (-40%)
          intel: 60,
          happy: 80,
          yearlyMoney: 30000, // âœ… åŸ 50000 â†’ 30000 (-40%)
          buff: "é­…åŠ› +35ï¼Œè—è¡“ +25",
          special: "fashion",
        },

        {
          id: "scientistfamily",
          name: "ç§‘å­¸å®¶æ—",
          desc: "è«¾è²çˆ¾å®¶æ—",
          parents: "è«¾è²çˆ¾çå¾—ä¸» & ç ”ç©¶å“¡",
          money: 900000, // âœ… åŸ 1500000 â†’ 900000 (-40%)
          intel: 130,
          happy: 70,
          yearlyMoney: 18000, // âœ… åŸ 30000 â†’ 18000 (-40%)
          buff: "æ™ºå•† +80",
          special: "scientist",
        },
      ];
      // ===== ğŸ“– å‡ºèº«é–‹å ´åŠ‡æƒ… =====
      // ===== ğŸ“– å‡ºèº«é–‹å ´åŠ‡æƒ… (è«‹è²¼åœ¨ const ORIGINS çµæŸå¾Œ) =====
      const ORIGIN_STORY = {
        common:
          "ä½ å‡ºç”Ÿåœ¨ä¸€å€‹å¹³å‡¡çš„å®¶åº­ï¼Œçˆ¶æ¯çœ‹è‘—ä½ çš„çœ¼ç¥å……æ»¿æ…ˆæ„›ï¼Œé›–ç„¶å®¶è£¡ä¸å¯Œè£•ï¼Œä½†ä¹Ÿä¸æ„åƒç©¿ã€‚ç‰†ä¸Šçš„æ—¥æ›†é¡¯ç¤ºè‘—ä»Šå¤©æ˜¯ç™¼è–ªæ—¥ï¼Œçˆ¸çˆ¸è²·äº†ä¸€å€‹å°è›‹ç³•æ…¶ç¥ä½ çš„èª•ç”Ÿã€‚",
        rich: "ä½ å‡ºç”Ÿåœ¨é ‚ç´šç§ç«‹é†«é™¢çš„è±ªè¯ç”¢æˆ¿ï¼Œçª—å¤–åœè‘—çˆ¸çˆ¸çš„å¸æ©Ÿå’Œä¿é‘£ã€‚ä½ çš„æ–ç±ƒæ˜¯ç¾©å¤§åˆ©é€²å£çš„ï¼Œæ—é‚Šå †æ»¿äº†é‚„æ²’æ‹†å°çš„åç‰Œå¬°å…’ç”¨å“ã€‚",
        genius:
          "ä½ å‡ºç”Ÿçš„é‚£ä¸€åˆ»æ²’æœ‰å“­ï¼Œè€Œæ˜¯çœå¤§çœ¼ç›è§€å¯Ÿè‘—å‘¨åœã€‚çˆ¶æ¯æ˜¯é ‚å°–ç ”ç©¶å“¡ï¼Œä»–å€‘çœ‹è‘—ä½ çš„çœ¼ç¥åƒæ˜¯åœ¨çœ‹ä¸€å€‹å‰å¤§çš„å¯¦é©—æ•¸æ“šï¼ŒåºŠé‚Šæ”¾è‘—å¾®ç©åˆ†èª²æœ¬ç•¶ä½œèƒæ•™éŸ³æ¨‚ã€‚",
        star: "é–ƒå…‰ç‡ˆé–ƒå€‹ä¸åœï¼Œä½ å‰›å‡ºç”Ÿå°±ç™»ä¸Šäº†å¨›æ¨‚ç‰ˆé ­æ¢ã€‚é›–ç„¶ä½ é‚„çœ‹ä¸æ¸…æ¥šï¼Œä½†å‘¨åœå……æ»¿äº†ç²‰çµ²çš„å°–å«è²å’Œç¶“ç´€äººçš„è¬›é›»è©±è²ã€‚",
        scholar:
          "å®¶è£¡å……æ»¿äº†èˆŠæ›¸çš„å‘³é“ï¼Œçˆ¶æ¯æ­£åœ¨è¼•è²è¨è«–è¦è®“ä½ å…ˆå­¸è«–èªé‚„æ˜¯èå£«æ¯”äºã€‚ä½ çš„å¬°å…’åºŠé‚Šä¸æ˜¯ç©å…·ï¼Œè€Œæ˜¯ä¸€åº§å°å°çš„æ›¸å±±ã€‚",
        military:
          "çˆ¶è¦ªç©¿è‘—è»è£æŠ±èµ·ä½ ï¼Œç²—ç³™çš„æ‰‹æŒé›–ç„¶æº«æš–ä½†å……æ»¿åšç¹­ã€‚ä»–çœ‹è‘—ä½ ï¼Œå½·å½¿å·²ç¶“çœ‹åˆ°äº†ä½ æœªä¾†ç©¿ä¸Šè»æœã€ä¿å®¶è¡›åœ‹çš„æ¨¡æ¨£ã€‚",
        doctor:
          "ä½ å‡ºç”Ÿåœ¨çˆ¶æ¯å·¥ä½œçš„é†«é™¢ï¼Œè­·ç†å¸«é˜¿å§¨å€‘è¼ªæµä¾†æŠ±ä½ ã€‚ç©ºæ°£ä¸­ç€°æ¼«è‘—æ¶ˆæ¯’æ°´çš„å‘³é“ï¼Œé€™å°‡æ˜¯ä½ æœªä¾†æœ€ç†Ÿæ‚‰çš„æ°£å‘³ã€‚",
        farmer:
          "æ¸…æ™¨çš„é›å•¼è²è¿æ¥ä½ çš„åˆ°ä¾†ã€‚çª—å¤–æ˜¯ä¸€æœ›ç„¡éš›çš„ç¨»ç”°ï¼Œçˆ¶æ¯é›–ç„¶æ±—æµæµ¹èƒŒï¼Œä½†çœ‹è‘—ä½ çš„ç¬‘å®¹å°±åƒçœ‹è‘—è±æ”¶çš„ä½œç‰©ä¸€æ¨£ç‡¦çˆ›ã€‚",
        fisher:
          "æµ·æµªæ‹æ‰“å²¸é‚Šçš„è²éŸ³æ˜¯ä½ è½åˆ°çš„ç¬¬ä¸€å€‹æ—‹å¾‹ã€‚ç©ºæ°£ä¸­å¸¶è‘—é¹¹é¹¹çš„æµ·é¢¨ï¼Œçˆ¶è¦ªèªªä½ æ˜¯æµ·çš„å¥³å…’/å…’å­ï¼Œå°‡ä¾†è¦å¾æœé€™ç‰‡å¤§æµ·ã€‚",
        aboriginal:
          "éƒ¨è½çš„é•·è€ç‚ºä½ å”±èµ·å¤è€çš„ç¥ç¦æ­Œè¬ ï¼Œç¥–éˆçš„åº‡ä½‘ç’°ç¹è‘—ä½ ã€‚ä½ åœ¨å±±æ—çš„æ‡·æŠ±ä¸­èª•ç”Ÿï¼Œè¨»å®šæ“æœ‰èˆ‡è‡ªç„¶æºé€šçš„å¤©è³¦ã€‚",
        immigrant:
          "çˆ¶æ¯ç”¨ä½ ä¸ç†Ÿæ‚‰çš„å®¶é„‰è©±è¼•è²å“„è‘—ä½ ã€‚é›–ç„¶åœ¨é€™å€‹æ–°åœ‹åº¦ä¸€åˆ‡éƒ½å¾ˆé™Œç”Ÿä¸”è‰±é›£ï¼Œä½†ä»–å€‘çœ‹è‘—ä½ çš„çœ¼ç¥å……æ»¿äº†å°æ–°ç”Ÿæ´»çš„å¸Œæœ›ã€‚",
        singleparent:
          "åª½åª½ç·Šç·ŠæŠ±è‘—ä½ ï¼Œé›–ç„¶åªæœ‰å¥¹ä¸€å€‹äººï¼Œä½†å¥¹çš„æ‡·æŠ±æ¯”ä»»ä½•åœ°æ–¹éƒ½æº«æš–ã€‚å¥¹è¼•è²æ‰¿è«¾ï¼Œæœƒçµ¦ä½ é›™å€çš„æ„›ã€‚",
        tech: "ä½ çš„ç¬¬ä¸€å¼µç…§ç‰‡æ˜¯ç”¨æœ€æ–°çš„åŸå‹æ©Ÿæ‹çš„ã€‚å®¶è£¡åˆ°è™•éƒ½æ˜¯é›»è·¯æ¿å’Œè¢å¹•ï¼Œçˆ¶æ¯æ­£åœ¨è¨è«–è¦å¯«ä¸€å€‹ AI ç¨‹å¼ä¾†å¹«ä½ æ›å°¿å¸ƒã€‚",
        artist:
          "å®¶è£¡æ’­æ”¾è‘—å¤å…¸æ¨‚ï¼Œç‰†ä¸Šæ›æ»¿äº†çˆ¶æ¯çš„ç•«ä½œã€‚ä½ æŠ“å‘¨æŠ“åˆ°äº†ä¸€æ”¯ç•«ç­†ï¼Œçˆ¶æ¯é–‹å¿ƒåœ°èªªä½ æ˜¯å¤©ç”Ÿçš„è—è¡“å®¶ã€‚",
        politician:
          "ä½ çš„æ»¿æœˆé…’å¸­ä¸Šå† è“‹é›²é›†ï¼Œç«‹å§”ã€è­°å“¡å€‘è¼ªæµæŠ±è‘—ä½ æ‹ç…§ã€‚ä½ é‚„ä¸æ‡‚äº‹ï¼Œå°±å·²ç¶“æˆç‚ºäº†çˆ¶æ¯å»ºç«‹è¦ªæ°‘å½¢è±¡çš„æœ€ä½³åŠ©é¸å“¡ã€‚",
        orphan:
          "ä½ æ˜¯å€‹è¢«éºè½åœ¨è‚²å¹¼é™¢é–€å£çš„å­©å­ï¼Œé™¢é•·å¥¶å¥¶æ”¶ç•™äº†ä½ ã€‚é›–ç„¶æ²’æœ‰çˆ¶æ¯çš„ç–¼æ„›ï¼Œä½†é€™è£¡æœ‰å¾ˆå¤šå’Œä½ ä¸€æ¨£çš„å…„å¼Ÿå§Šå¦¹ã€‚",
        temple:
          "æ™¨é˜æš®é¼“æ˜¯ä½ ç”Ÿå‘½çš„ç¯€å¥ã€‚ä½ åœ¨ç¹šç¹çš„é¦™ç«ä¸­é•·å¤§ï¼Œä¿¡å¾’å€‘éƒ½èªªä½ çœ‹èµ·ä¾†ç‰¹åˆ¥æœ‰éˆæ°£ï¼Œå½·å½¿æ˜¯ç¥æ˜è³œäºˆçš„å­©å­ã€‚",
        mafia:
          "æ»¿å±‹å­åˆºé’çš„å”å”ä¼¯ä¼¯åœè‘—ä½ çœ‹ï¼Œé›–ç„¶ä»–å€‘é•·ç›¸å…‡ç‹ ï¼Œä½†ééä¾†çš„ç´…åŒ…å»ç‰¹åˆ¥åšã€‚çˆ¶è¦ªèªªï¼Œåªè¦æœ‰ä»–åœ¨ï¼Œæ²’äººæ•¢æ¬ºè² ä½ ã€‚",
        royal:
          "çš‡å®¶ç¦®ç‚®é³´éŸ¿ï¼Œå…¨åœ‹æ…¶ç¥ä½ çš„èª•ç”Ÿã€‚ä½ èººåœ¨é‘²é‡‘çš„æ–ç±ƒè£¡ï¼Œç®¡å®¶é˜¿çˆ¾å¼—é›·å¾·æ­£åœ¨ç‚ºä½ æº–å‚™æº«ç†±çš„ç‰›å¥¶ï¼Œä½ è¨»å®šç”Ÿè€Œä¸å‡¡ã€‚",
        hacker:
          "ä½ çš„æˆ¿é–“æ²’æœ‰çª—æˆ¶ï¼Œåªæœ‰å¤šå€‹è¢å¹•ç™¼å‡ºçš„å¹½å…‰ã€‚çˆ¶æ¯æ•™ä½ çš„ç¬¬ä¸€å€‹å­—ä¸æ˜¯ã€Œçˆ¸çˆ¸ã€ï¼Œè€Œæ˜¯ã€Œsudoã€ã€‚",
        detective:
          "å®¶è£¡ç¸½æ˜¯å……æ»¿è¬åœ˜ï¼Œçˆ¶æ¯çœ‹ä½ çš„çœ¼ç¥åƒæ˜¯åœ¨å¯©è¦–å«Œç–‘çŠ¯ã€‚ä½ åœ¨å……æ»¿é‚è¼¯èˆ‡æ¨ç†çš„ç’°å¢ƒä¸‹é•·å¤§ï¼Œå­¸æœƒçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è§€å¯Ÿç´°ç¯€ã€‚",
        cheffamily:
          "å»šæˆ¿å‚³ä¾†çš„é¦™æ°£æ˜¯ä½ ç«¥å¹´çš„è¨˜æ†¶ã€‚ä½ çš„å¥¶ç“¶è£¡è£çš„ä¸æ˜¯æ™®é€šç‰›å¥¶ï¼Œè€Œæ˜¯ç¶“éçˆ¶æ¯ç²¾å¿ƒèª¿é…çš„é ‚ç´šé…æ–¹ã€‚",
        monk: "ä½ åœ¨æ·±å±±çš„å¤å‰ä¸­é†’ä¾†ï¼Œå¸«çˆ¶æ…ˆæ‚²åœ°çœ‹è‘—ä½ ã€‚é€™è£¡æ²’æœ‰å¡µä¸–çš„å–§å›‚ï¼Œåªæœ‰é¢¨å¹éæ¾æ—çš„è²éŸ³ï¼Œä½ å°‡èµ°ä¸Šä¸€æ¢ä¿®è¡Œçš„é“è·¯ã€‚",
        circus:
          "ä½ çš„æ–ç±ƒæ˜¯ç©ºä¸­çš„åŠåºŠï¼Œå‘¨åœæ˜¯å¤§è±¡å’Œç…å­ã€‚æŒè²å’Œæ­¡å‘¼è²æ˜¯ä½ ç¿’ä»¥ç‚ºå¸¸çš„èƒŒæ™¯éŸ³ï¼Œä½ çš„ç«¥å¹´è¨»å®šå……æ»¿é©šå¥‡ã€‚",
        diplomat:
          "ä½ çš„è­·ç…§ä¸Šè“‹æ»¿äº†å„åœ‹çš„å°ç« ã€‚å¾å°ä½ å°±ç¿’æ…£åœ¨ä¸åŒçš„åœ‹å®¶é†’ä¾†ï¼Œè½è‘—ä¸åŒçš„èªè¨€ï¼Œä¸–ç•Œå°±æ˜¯ä½ çš„éŠæ¨‚å ´ã€‚",
        esports:
          "éµç›¤çš„æ•²æ“Šè²æ˜¯ä½ è½éæœ€ç¾å¦™çš„éŸ³æ¨‚ã€‚çˆ¶æ¯æ˜¯å‚³å¥‡é¸æ‰‹ï¼Œä»–å€‘çœ‹è‘—ä½ çš„æ‰‹æŒ‡ï¼ŒæœŸå¾…è‘—ä½ ç¹¼æ‰¿ä»–å€‘çš„APMï¼ˆæ‰‹é€Ÿï¼‰ã€‚",
        spy: "å®¶è£¡æœ‰å¾ˆå¤šä¸èƒ½æ‰“é–‹çš„æŠ½å±œå’Œç¥•å¯†æˆ¿é–“ã€‚çˆ¶æ¯ç¸½æ˜¯çªç„¶æ¶ˆå¤±åˆçªç„¶å‡ºç¾ï¼Œä½ å¾å°å°±å­¸æœƒäº†ä¿å®ˆç§˜å¯†ã€‚",
        archaeologist:
          "ä½ çš„ç©å…·æ˜¯éŸå­å’Œåˆ·å­ã€‚çˆ¶æ¯å¸¶å›ä¾†çš„ä¸æ˜¯ä¼´æ‰‹ç¦®ï¼Œè€Œæ˜¯åƒå¹´å‰çš„åŒ–çŸ³ç¢ç‰‡ï¼Œæ­·å²çš„å¡µåŸƒæ˜¯ä½ ç«¥å¹´çš„é¤Šåˆ†ã€‚",
        fashion:
          "ä½ çš„å°¿å¸ƒæ˜¯é«˜ç´šè¨‚è£½æ¬¾ã€‚å¾å°ä½ å°±ååœ¨æ™‚è£ç§€çš„ç¬¬ä¸€æ’ï¼Œé‚å…‰ç‡ˆæ˜¯ä½ æœ€ç†Ÿæ‚‰çš„æœ‹å‹ï¼Œæ™‚å°šæ—©å·²èå…¥ä½ çš„è¡€æ¶²ã€‚",
        scientistfamily:
          "å®¶è£¡çš„æ›¸æ¶ä¸Šæ“ºæ»¿äº†è«¾è²çˆ¾çç« ã€‚çˆ¶æ¯å°ä½ çš„æœŸè¨±ä¸æ˜¯è³ºå¤§éŒ¢ï¼Œè€Œæ˜¯è§£é–‹å®‡å®™çš„å¥§ç¥•ã€‚",
      };

    // âœ… ä¿®æ­£èˆ‡åˆä½µå¾Œçš„ finishCharacterCreation å‡½æ•¸
function finishCharacterCreation() {
    // 1. å°‡é¸æ“‡çš„ç‰¹è³ªåŠ å…¥éŠæˆ²
    // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ TRAITS (å…¨å¤§å¯«) å’Œ selectedTraits (å…¨åŸŸè®Šæ•¸)
    Game.traits = selectedTraits.map((id) =>
        TRAITS.find((t) => t.id === id),
    );
    Game.unlockedTraits = [...selectedTraits];

    // 2. æ‡‰ç”¨ç‰¹è³ªæ•ˆæœèˆ‡è¨ˆç®—è£œå„Ÿ
    let rewardMessages = [];
    Game.traits.forEach((trait) => {
        // æ‡‰ç”¨æ•ˆæœ
        if (trait.effect) {
            trait.effect(Game);
        }

        // è¨ˆç®—è² é¢ç‰¹è³ªçå‹µ
        if (trait.isNegative && trait.reward) {
            if (trait.reward.money) {
                Game.money += trait.reward.money;
                rewardMessages.push(
                    `ğŸ’° è£œå„Ÿé‡‘ +$${trait.reward.money.toLocaleString()}`,
                );
            }
            if (trait.reward.intel) {
                Game.intel += trait.reward.intel;
                rewardMessages.push(`ğŸ§  æ™ºåŠ› +${trait.reward.intel}`);
            }
            if (trait.reward.health) {
                Game.health += trait.reward.health;
                rewardMessages.push(`â¤ï¸ å¥åº· +${trait.reward.health}`);
            }
            if (trait.reward.happy) {
                Game.happy += trait.reward.happy;
                rewardMessages.push(`ğŸ˜Š å¿«æ¨‚ +${trait.reward.happy}`);
            }
            if (trait.reward.charm) {
                Game.skills.charm += trait.reward.charm;
                rewardMessages.push(`âœ¨ é­…åŠ› +${trait.reward.charm}`);
            }
        }
    });

    // 3. é¡¯ç¤ºè£œå„Ÿè¨Šæ¯ (å¦‚æœæœ‰)
    if (rewardMessages.length > 0) {
        alert(`ğŸ è² é¢ç‰¹è³ªè£œå„Ÿçå‹µï¼š\n\n${rewardMessages.join("\n")}`);
    }

    // 4. åˆ‡æ›ä»‹é¢ï¼šéš±è—å‰µè§’ï¼Œé¡¯ç¤ºéŠæˆ²ä¸»ç•«é¢
    document.getElementById("scene-creation").style.display = "none";
    const gameScene = document.getElementById("scene-game");
    gameScene.style.display = "block";
    gameScene.classList.add("active");

    // 5. åˆå§‹åŒ–éŠæˆ²å„é …é¡¯ç¤º
    updateUI();
    renderJobs();
    renderShop();
    renderSocial();
    renderAchievements();
    renderStats();

    // 6. å¯«å…¥ç¬¬ä¸€ç­†æ—¥èªŒ
    log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼`);
    log(`ğŸ  å‡ºèº«ï¼š${Game.origin}`);
    log(`ğŸ å¤©è³¦ï¼š${Game.talents.map((t) => t.name).join("ã€")}`);
    log(`âœ¨ ç‰¹è³ªï¼š${Game.traits.map((t) => t.name).join("ã€")}`);

    // 7. âœ… è§¸ç™¼é–‹å ´åŠ‡æƒ… (æœ€é‡è¦çš„éƒ¨åˆ†)
    // é€™è£¡ä½¿ç”¨ setTimeout å»¶é² 500æ¯«ç§’ï¼Œç¢ºä¿ä»‹é¢åˆ‡æ›å®Œæˆå¾Œæ‰å½ˆå‡ºï¼Œé«”é©—è¼ƒå¥½
    if (
        typeof ORIGIN_STORY !== "undefined" &&
        ORIGIN_STORY[Game.originId]
    ) {
        setTimeout(() => {
            showModal("ğŸ“– äººç”Ÿç¯‡ç« é–‹å•Ÿ", ORIGIN_STORY[Game.originId], [
                { text: "é–‹å§‹å†’éšª", action: () => closeModal() },
            ]);
            log(ORIGIN_STORY[Game.originId]);
        }, 500);
    }
}
      const JOBS = [
        {
          id: "none",
          name: "ç„¡æ¥­",
          salary: 0,
          requirement: {},
          effect: null,
          desc: "å¾…æ¥­ä¸­",
        },

        {
          id: "clerk",
          name: "è¾¦äº‹å“¡",
          salary: 25000,
          requirement: { intel: 40 },
          effect: (g) => {
            g.happy -= 2;
          },
          desc: "è™•ç†æ—¥å¸¸æ–‡æ›¸å·¥ä½œ",
        },

        {
          id: "engineer",
          name: "å·¥ç¨‹å¸«",
          salary: 50000,
          requirement: { intel: 80, programming: 70 },
          traitBonus: {
            techsavvy: { salary: 1.3, desc: "ç§‘æŠ€é”äººè–ªè³‡åŠ æˆ 30%" },
            quicklearner: { salary: 1.2, desc: "å¿«é€Ÿå­¸ç¿’è€…è–ªè³‡åŠ æˆ 20%" },
            introvert: { salary: 1.1, desc: "å…§å‘è€…è–ªè³‡åŠ æˆ 10%" },
          },
          effect: (g) => {
            g.skills.programming += 2;
            g.happy -= 5;
            g.health -= 3;
          },
          desc: "é–‹ç™¼è»Ÿé«”ç³»çµ±",
        },

        {
          id: "doctor",
          name: "é†«ç”Ÿ",
          salary: 120000,
          requirement: { intel: 120, medical: 80 },
          requiredTrait: "athletic",
          traitBonus: { athletic: { salary: 1.2, desc: "é‹å‹•å¥å°‡è–ªè³‡åŠ æˆ" } },
          effect: (g) => {
            g.health -= 5;
            g.skills.medical += 3;
          },
          desc: "æ•‘æ­»æ‰¶å‚·çš„ç¥è–è·æ¥­",
        },

        {
          id: "artist",
          name: "è—è¡“å®¶",
          salary: 28000,
          requirement: { art: 70, charm: 60 },
          traitBonus: {
            artistic: { salary: 1.5, desc: "è—è¡“å¤©è³¦è–ªè³‡åŠ æˆ 50%" },
            pessimistic: { salary: 1.3, desc: "æ‚²è§€ä¸»ç¾©è€…è–ªè³‡åŠ æˆ 30%" },
          },
          effect: (g) => {
            g.happy += 10;
            g.skills.art += 3;
          },
          desc: "ç”¨è—è¡“è¡¨é”è‡ªæˆ‘",
        },

        {
          id: "teacher",
          name: "æ•™å¸«",
          salary: 38000,
          requirement: { intel: 70, communication: 60 },
          traitBonus: {
            extrovert: { salary: 1.2, desc: "å¤–å‘è€…è–ªè³‡åŠ æˆ" },
            charismatic: { salary: 1.15, desc: "é­…åŠ›éå‡¡è–ªè³‡åŠ æˆ" },
            optimistic: { salary: 1.1, desc: "æ¨‚è§€ä¸»ç¾©è€…è–ªè³‡åŠ æˆ 10%" },
          },
          effect: (g) => {
            g.happy += 5;
            g.skills.communication += 2;
          },
          desc: "æ•™è‚²ä¸‹ä¸€ä»£",
        },

        {
          id: "entrepreneur",
          name: "å‰µæ¥­å®¶",
          salary: 80000,
          requirement: { intel: 90, finance: 70, charm: 70 },
          traitBonus: {
            businessmind: { salary: 1.5, desc: "å•†æ¥­é ­è…¦è–ªè³‡åŠ æˆ" },
            brave: { salary: 1.3, desc: "å‹‡æ•¢è€…è–ªè³‡åŠ æˆ" },
            lucky: { salary: 1.4, desc: "å¹¸é‹å…’è–ªè³‡åŠ æˆ" },
            optimistic: { salary: 1.2, desc: "æ¨‚è§€ä¸»ç¾©è€…è–ªè³‡åŠ æˆ 20%" },
          },
          effect: (g) => {
            const fluctuation = Math.floor(Math.random() * 120000) - 60000; // âœ… åŠ å¤§æ³¢å‹• -60k ~ +60k
            g.money += fluctuation;
            g.happy -= 15;
            g.health -= 8;
            if (fluctuation > 0)
              log(`ğŸ“ˆ å‰µæ¥­ç²åˆ© +${fluctuation.toLocaleString()}`);
            else log(`ğŸ“‰ å‰µæ¥­è™§æ ${Math.abs(fluctuation).toLocaleString()}`);
          },
          desc: "é«˜é¢¨éšªé«˜å ±é…¬çš„å‰µæ¥­ä¹‹è·¯",
        },

        {
          id: "influencer",
          name: "ç¶²ç´…",
          salary: 60000,
          requirement: { charm: 90, communication: 70 },
          requiredTrait: "extrovert",
          traitBonus: {
            extrovert: { salary: 1.3, desc: "å¤–å‘è€…è–ªè³‡åŠ æˆ" },
            charismatic: { salary: 1.4, desc: "é­…åŠ›éå‡¡è–ªè³‡åŠ æˆ" },
            artistic: { salary: 1.2, desc: "è—è¡“å¤©è³¦è–ªè³‡åŠ æˆ" },
            optimistic: { salary: 1.15, desc: "æ¨‚è§€ä¸»ç¾©è€…è–ªè³‡åŠ æˆ 15%" },
          },
          effect: (g) => {
            g.skills.charm += 2;
            g.happy += 8;
            g.money += Math.floor(Math.random() * 40000) - 10000; // âœ… æ”¶å…¥æ³¢å‹• -10k ~ +30k
          },
          desc: "ä¾è³´æµé‡çš„ä¸ç©©å®šè·æ¥­",
        },

        {
          id: "scientist",
          name: "ç§‘å­¸å®¶",
          salary: 65000,
          requirement: { intel: 110 },
          traitBonus: {
            geniusmind: { salary: 1.5, desc: "å¤©æ‰å¿ƒæ™ºè–ªè³‡åŠ æˆ" },
            introvert: { salary: 1.2, desc: "å…§å‘è€…è–ªè³‡åŠ æˆ" },
            quicklearner: { salary: 1.3, desc: "å¿«é€Ÿå­¸ç¿’è€…è–ªè³‡åŠ æˆ 30%" },
          },
          effect: (g) => {
            g.intel += 5;
            g.happy += 3;
          },
          desc: "æ¢ç´¢æœªçŸ¥çš„çœŸç†",
        },

        {
          id: "lawyer",
          name: "å¾‹å¸«",
          salary: 100000,
          requirement: { intel: 100, communication: 80 },
          effect: (g) => {
            g.skills.communication += 3;
            g.happy -= 8;
          },
          desc: "ç‚ºæ­£ç¾©è¾¯è­·",
        },

        {
          id: "chef",
          name: "å»šå¸«",
          salary: 42000,
          requirement: { cooking: 80, art: 40 },
          effect: (g) => {
            g.skills.cooking += 3;
            g.happy += 5;
          },
          desc: "çƒ¹é£ªç¾é£Ÿçš„è—è¡“å®¶",
        },

        {
          id: "pilot",
          name: "æ©Ÿå¸«",
          salary: 135000,
          requirement: { intel: 90, health: 80 },
          effect: (g) => {
            g.health -= 5;
            g.happy += 3;
          },
          desc: "ç¿±ç¿”å¤©éš›çš„è·æ¥­",
        },

        {
          id: "athlete",
          name: "é‹å‹•å“¡",
          salary: 70000,
          requirement: { health: 90, charm: 60 },
          effect: (g) => {
            g.health += 3;
            if (g.age > 35) {
              g.happy -= 10;
              log("âš ï¸ é‹å‹•å“¡å¹´é½¡éå¤§ï¼Œè·æ¥­ç”Ÿæ¶¯èµ°ä¸‹å¡");
            }
          },
          desc: "35 æ­²å¾Œè·æ¥­ç”Ÿæ¶¯èµ°ä¸‹å¡",
        },

        {
          id: "police",
          name: "è­¦å¯Ÿ",
          salary: 45000,
          requirement: { health: 70, communication: 50 },
          effect: (g) => {
            g.health -= 3;
            g.happy -= 5;
          },
          desc: "ç¶­è­·ç¤¾æœƒæ²»å®‰",
        },

        {
          id: "designer",
          name: "è¨­è¨ˆå¸«",
          salary: 48000,
          requirement: { art: 80, programming: 40 },
          effect: (g) => {
            g.skills.art += 3;
            g.happy += 3;
          },
          desc: "å‰µé€ è¦–è¦ºç¾å­¸",
        },

        // ===== ç‰¹æ®Šå‡ºèº«å°ˆå±¬è·æ¥­ =====
        {
          id: "hackerpro",
          name: "é§­å®¢",
          salary: 180000,
          requirement: { intel: 100, programming: 100 },
          originRequired: "hacker",
          effect: (g) => {
            g.skills.programming += 5;
            g.money += Math.floor(Math.random() * 400000) - 100000; // âœ… å¤§æ³¢å‹• -100k ~ +300k
          },
          desc: "é«˜é¢¨éšªçš„ç°è‰²åœ°å¸¶",
        },

        {
          id: "royaladvisor",
          name: "çš‡å®¤é¡§å•",
          salary: 200000,
          requirement: { intel: 110, communication: 90 },
          originRequired: "royal",
          effect: (g) => {
            g.skills.charm += 3;
            g.happy += 10;
          },
          desc: "æœå‹™çš‡å®¤çš„æ¦®è€€",
        },

        {
          id: "esportsplayer",
          name: "é›»ç«¶é¸æ‰‹",
          salary: 100000,
          requirement: { intel: 70 },
          originRequired: "esports",
          effect: (g) => {
            if (g.age > 28) {
              g.happy -= 15;
              log("âš ï¸ é›»ç«¶é¸æ‰‹å¹´é½¡éå¤§ï¼Œåæ‡‰é€Ÿåº¦ä¸‹é™");
            } else {
              g.happy += 15;
            }
          },
          desc: "25 æ­²å·”å³°æœŸ",
        },

        {
          id: "spyagent",
          name: "é–“è«œ",
          salary: 140000,
          requirement: { intel: 100, health: 80 },
          originRequired: "spy",
          effect: (g) => {
            g.health -= 8;
            g.money += Math.floor(Math.random() * 250000) - 50000; // âœ… å±éšªæ´¥è²¼æ³¢å‹•
          },
          desc: "å±éšªçš„ç¥•å¯†ä»»å‹™",
        },

        {
          id: "michelinchef",
          name: "ç±³å…¶æ—å»šå¸«",
          salary: 120000,
          requirement: { cooking: 100, art: 60 },
          originRequired: "cheffamily",
          effect: (g) => {
            g.skills.cooking += 5;
            g.skills.art += 2;
            g.happy += 8;
          },
          desc: "é ‚ç´šæ–™ç†å¤§å¸«",
        },
      ];
      // ==========================================
      // ğŸ†• æ–°å¢ï¼šè·æ¥­æ™‰å‡ç³»çµ±
      // ==========================================
      const JOB_PROMOTIONS = {
        å¯¦ç¿’ç”Ÿ: {
          next: "æ­£è·å“¡å·¥",
          requirement: { age: 22, intel: 60, communication: 30 },
          salaryIncrease: 10000,
        },
        æ­£è·å“¡å·¥: {
          next: "è³‡æ·±å“¡å·¥",
          requirement: { age: 28, intel: 80, communication: 50, workYears: 5 },
          salaryIncrease: 20000,
        },
        è³‡æ·±å“¡å·¥: {
          next: "ä¸»ç®¡",
          requirement: { age: 35, intel: 100, leadership: 60, workYears: 10 },
          salaryIncrease: 40000,
        },
        ä¸»ç®¡: {
          next: "éƒ¨é–€ç¶“ç†",
          requirement: { age: 40, intel: 120, leadership: 80, workYears: 15 },
          salaryIncrease: 80000,
        },
        éƒ¨é–€ç¶“ç†: {
          next: "ç¸½ç¶“ç†",
          requirement: { age: 45, intel: 150, leadership: 100, workYears: 20 },
          salaryIncrease: 150000,
        },
      };

   function checkPromotion() {
        // ä¿®æ­£ï¼šgame -> Game
        if (!Game.job || Game.job === "ç„¡æ¥­" || Game.promotionChecked) return;

        const promotion = JOB_PROMOTIONS[Game.job]; // ä¿®æ­£ï¼šgame -> Game
        if (!promotion) return;

        const req = promotion.requirement;
        let canPromote = true;

        // ä¿®æ­£ï¼šgame -> Game
        if (req.age && Game.age < req.age) canPromote = false;
        if (req.intel && Game.intel < req.intel) canPromote = false;
        if (req.communication && Game.skills.communication < req.communication)
          canPromote = false;
        if (req.leadership && Game.skills.leadership < req.leadership)
          canPromote = false;
        if (req.workYears && Game.workYears < req.workYears) canPromote = false;

        if (canPromote) {
          showModal(
            "ğŸ‰ æ™‰å‡æ©Ÿæœƒ",
            `æ­å–œï¼ä½ å¯ä»¥å¾ã€Œ${Game.job}ã€æ™‰å‡ç‚ºã€Œ${promotion.next}ã€\nè–ªæ°´å°‡å¢åŠ  $${promotion.salaryIncrease.toLocaleString()}/å¹´`,
            "æ¥å—æ™‰å‡",
            "æš«ä¸æ™‰å‡",
            () => {
              const currentJob = JOBS.find((j) => j.name === Game.job);
              Game.job = promotion.next;
              if (currentJob) {
                currentJob.salary += promotion.salaryIncrease;
              }
              log(`âœ¨ ä½ æ™‰å‡ç‚º ${promotion.next}ï¼`);
              Game.promotionChecked = true;
              updateUI();
            },
            () => {
              log(`ä½ é¸æ“‡æš«ä¸æ™‰å‡`);
              Game.promotionChecked = true;
            },
          );
        }
      }
      // ==========================================
      // ğŸ†• æ–°å¢ï¼šå­å¥³é¤Šè‚²ç³»çµ± (å·²ä¿®æ­£è®Šæ•¸åç¨±)
      // ==========================================
      function createChild(name, age = 0) {
        return {
          name: name,
          age: age,
          health: 100,
          intel: 50 + Math.floor(Game.intel * 0.3), // ä¿®æ­£ï¼šgame -> Game
          personality: ["ä¹–å·§", "å›é€†", "è°æ˜", "é‹å‹•", "æ–‡éœ"][
            Math.floor(Math.random() * 5)
          ],
          education: "å­¸é½¡å‰",
          relationship: 80,
          expenses: 20000,
        };
      }

      function tryHaveBaby() {
        if (!Game.partner) { // ä¿®æ­£ï¼šgame -> Game
          showPopup("âŒ éœ€è¦å…ˆæœ‰ä¼´ä¾¶", "red");
          return;
        }

        if (Game.age < 20 || Game.age > 45) { // ä¿®æ­£ï¼šgame -> Game
          showPopup("âŒ å¹´é½¡ä¸é©åˆç”Ÿè‚² (20-45æ­²)", "red");
          return;
        }

        if (Game.money < 100000) { // ä¿®æ­£ï¼šgame -> Game
          showPopup("âŒ å­˜æ¬¾ä¸è¶³ $100,000", "red");
          return;
        }

        showModal(
          "ğŸ‘¶ è€ƒæ…®ç”Ÿè‚²",
          `ç”Ÿè‚²éœ€è¦ï¼š\nâ€¢ åˆæœŸè²»ç”¨ $100,000\nâ€¢ æ¯å¹´é¤Šè‚²è²» $20,000+\nâ€¢ å¤§é‡æ™‚é–“èˆ‡ç²¾åŠ›\n\næ˜¯å¦æº–å‚™å¥½è¿æ¥æ–°ç”Ÿå‘½ï¼Ÿ`,
          "ğŸ¼ æº–å‚™å¥½äº†",
          "âŒ æš«ä¸è€ƒæ…®",
          () => {
            Game.money -= 100000; // ä¿®æ­£ï¼šgame -> Game
            const babyName = prompt("è«‹ç‚ºå¯¶å¯¶å–åï¼š", "å°å¯¶") || "å°å¯¶";
            const baby = createChild(babyName, 0);
            Game.children.push(baby); // ä¿®æ­£ï¼šgame -> Game
            log(`ğŸ‰ æ­å–œï¼ä½ çš„å­©å­ ${babyName} å‡ºç”Ÿäº†ï¼`);
            Game.happy += 30; // ä¿®æ­£ï¼šgame -> Game
            updateUI();
            renderChildrenList();
          },
        );
      }

      function updateChildren() {
        Game.children.forEach((child) => { // ä¿®æ­£ï¼šgame -> Game
          child.age++;

          if (child.age === 6) child.education = "å°å­¸";
          if (child.age === 12) child.education = "åœ‹ä¸­";
          if (child.age === 15) child.education = "é«˜ä¸­";
          if (child.age === 18) {
            showModal(
              "ğŸ“ å­å¥³å‡å­¸",
              `${child.name} é«˜ä¸­ç•¢æ¥­äº†ï¼é¸æ“‡æœªä¾†æ–¹å‘ï¼š`,
              "ğŸ’° ç›´æ¥å·¥ä½œ",
              "ğŸ“š ä¸Šå¤§å­¸ ($200k)",
              () => {
                child.education = "å°±æ¥­";
                log(`${child.name} é–‹å§‹å·¥ä½œäº†ï¼`);
              },
              () => {
                if (Game.money >= 200000) { // ä¿®æ­£ï¼šgame -> Game
                  Game.money -= 200000;
                  child.education = "å¤§å­¸";
                  child.intel += 30;
                  log(`${child.name} é€²å…¥å¤§å­¸å°±è®€ï¼`);
                } else {
                  showPopup("âŒ å­¸è²»ä¸è¶³", "red");
                }
              },
            );
          }

          let cost = child.expenses;
          if (child.education === "å¤§å­¸") cost += 50000;
          Game.money -= cost; // ä¿®æ­£ï¼šgame -> Game

          if (child.education !== "å°±æ¥­") {
            child.intel += Math.floor(Math.random() * 3 + 1);
          }
        });
      }

      function interactWithChild(childIndex) {
        const child = Game.children[childIndex]; // ä¿®æ­£ï¼šgame -> Game
        if (!child) return;

        showModal(
          `ğŸ’• èˆ‡ ${child.name} äº’å‹•`,
          `å¹´é½¡ï¼š${child.age}æ­² | å€‹æ€§ï¼š${child.personality}\næ•™è‚²ï¼š${child.education} | æ™ºåŠ›ï¼š${child.intel}\né—œä¿‚ï¼š${child.relationship}/100`,
          "ğŸ® é™ªä¼´ç©è€ (-20é«”åŠ›)",
          "ğŸ“– è¼”å°åŠŸèª² (-30é«”åŠ›)",
          () => {
            if (Game.stamina >= 20) { // ä¿®æ­£ï¼šgame -> Game
              Game.stamina -= 20;
              child.relationship = Math.min(100, child.relationship + 5);
              Game.happy += 10;
              log(`é™ª ${child.name} ç©è€ï¼Œé—œä¿‚æ›´è¦ªå¯†äº†ï¼`);
              updateUI();
            } else {
              showPopup("âŒ é«”åŠ›ä¸è¶³", "red");
            }
          },
          () => {
            if (Game.stamina >= 30 && Game.intel >= 80) { // ä¿®æ­£ï¼šgame -> Game
              Game.stamina -= 30;
              child.intel += 3;
              child.relationship = Math.min(100, child.relationship + 3);
              log(`è¼”å° ${child.name} åŠŸèª²ï¼Œæ™ºåŠ›æå‡äº†ï¼`);
              updateUI();
            } else {
              showPopup("âŒ éœ€è¦é«”åŠ›30å’Œæ™ºåŠ›80", "red");
            }
          },
        );
      }

      function renderChildrenList() {
        const container = document.getElementById("children-list");
        if (!container) return;

        if (Game.children.length === 0) { // ä¿®æ­£ï¼šgame -> Game
          container.innerHTML =
            '<div style="color: var(--text-dim); text-align: center; padding: 10px;">å°šç„¡å­å¥³</div>';
          return;
        }

        container.innerHTML = Game.children // ä¿®æ­£ï¼šgame -> Game
          .map(
            (child, index) => `
            <div class="job-card" onclick="interactWithChild(${index})" style="cursor: pointer;">
              <div class="job-name">${child.name} (${child.age}æ­²)</div>
              <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 5px;">
                ${child.personality} | ${child.education} | æ™ºåŠ› ${child.intel}
              </div>
              <div style="font-size: 0.8em; color: var(--green); margin-top: 3px;">
                é—œä¿‚ï¼š${"â¤ï¸".repeat(Math.floor(child.relationship / 20))} ${child.relationship}/100
              </div>
              <div style="font-size: 0.75em; color: var(--orange); margin-top: 2px;">
                å¹´åº¦èŠ±è²»ï¼š$${child.education === "å¤§å­¸" ? (child.expenses + 50000).toLocaleString() : child.expenses.toLocaleString()}
              </div>
            </div>
            `,
          )
          .join("");
      }
    // ==========================================
      // ğŸ†• æ–°å¢ï¼šé€šè†¨èˆ‡æˆ¿è²¸ç³»çµ± (å·²ä¿®æ­£è®Šæ•¸åç¨±)
      // ==========================================
      function updateInflation() {
        Game.yearsPassed++; // ä¿®æ­£ï¼šgame -> Game
        if (Game.yearsPassed % 5 === 0) {
          Game.inflationRate *= 1.03;
          log(`ğŸ’¸ ç‰©åƒ¹ä¸Šæ¼²äº† 3%`);
        }
      }

      function getInflatedPrice(basePrice) {
        return Math.floor(basePrice * Game.inflationRate); // ä¿®æ­£ï¼šgame -> Game
      }

      function payMortgage() {
        if (Game.mortgage.active) { // ä¿®æ­£ï¼šgame -> Game
          if (Game.money >= Game.mortgage.monthlyPayment) {
            Game.money -= Game.mortgage.monthlyPayment;
            Game.mortgage.remaining -= Game.mortgage.monthlyPayment;
            Game.mortgage.years--;

            if (Game.mortgage.remaining <= 0 || Game.mortgage.years <= 0) {
              log(`ğŸ‰ æˆ¿è²¸ç¹³æ¸…äº†ï¼`);
              Game.mortgage.active = false;
            } else {
              log(
                `ç¹³æˆ¿è²¸ $${Game.mortgage.monthlyPayment.toLocaleString()}ï¼Œå‰© ${Game.mortgage.years} å¹´`,
              );
            }
          } else {
            log(`âš ï¸ ç„¡æ³•ç¹³ç´æˆ¿è²¸ï¼å¥åº·èˆ‡å¿«æ¨‚ä¸‹é™`);
            Game.health -= 10;
            Game.happy -= 15;
          }
        }
      }

      function buyHouseWithMortgage(house) {
        const realPrice = getInflatedPrice(house.price);
        const downPayment = Math.floor(realPrice * 0.3);
        const loanAmount = realPrice - downPayment;

        showModal(
          "ğŸ  è³¼å±‹æ–¹æ¡ˆ",
          `${house.name}\næˆ¿åƒ¹ï¼š$${realPrice.toLocaleString()}\né ­æœŸæ¬¾(30%)ï¼š$${downPayment.toLocaleString()}\nè²¸æ¬¾é‡‘é¡ï¼š$${loanAmount.toLocaleString()}\nè²¸æ¬¾å¹´é™ï¼š20å¹´\nå¹´ç¹³é‡‘é¡ï¼š$${Math.floor(loanAmount / 20).toLocaleString()}`,
          "ğŸ’° å…¨é¡ä»˜æ¸…",
          "ğŸ¦ ç”³è«‹è²¸æ¬¾",
          () => {
            if (Game.money >= realPrice) { // ä¿®æ­£ï¼šgame -> Game
              Game.money -= realPrice;
              Game.items.push(house.name);
              if (house.happyBonus) Game.happy += house.happyBonus;
              log(`å…¨é¡è³¼è²·äº† ${house.name}ï¼`);
              updateUI();
              renderAssets(); 
            } else {
              showPopup("âŒ é‡‘éŒ¢ä¸è¶³", "red");
            }
          },
          () => {
            if (Game.money >= downPayment) {
              if (Game.mortgage.active) {
                showPopup("âŒ å·²æœ‰è²¸æ¬¾é€²è¡Œä¸­", "red");
                return;
              }
              Game.money -= downPayment;
              Game.mortgage = {
                active: true,
                totalAmount: loanAmount,
                remaining: loanAmount,
                monthlyPayment: Math.floor(loanAmount / 20),
                years: 20,
                itemName: house.name,
              };
              Game.items.push(house.name);
              if (house.happyBonus) Game.happy += house.happyBonus;
              log(
                `è²¸æ¬¾è³¼è²·äº† ${house.name}ï¼æ¯å¹´ç¹³ç´ $${Game.mortgage.monthlyPayment.toLocaleString()}`,
              );
              updateUI();
              renderAssets(); 
            } else {
              showPopup("âŒ é ­æœŸæ¬¾ä¸è¶³", "red");
            }
          },
        );
      }
      
      // âœ… é€™æ˜¯æœ€é—œéµçš„ä¿®å¾©ï¼nextYear å‡½æ•¸
      function nextYear() {
        // é˜²æŠ–æ£€æŸ¥
        if (isProcessing) {
          console.log("â³ è™•ç†ä¸­ï¼Œè«‹ç¨å€™...");
          return;
        }

        if (Game.health <= 0) {
          showEnding();
          return;
        }

        isProcessing = true; 

        const oldStage = LIFE_STAGES.find(
          (s) => Game.age >= s.min && Game.age <= s.max,
        );

        Game.age++;
        Game.stamina = 100;
        
        // âœ… é€™è£¡åŸæœ¬æ˜¯ gameï¼Œå°è‡´å´©æ½°
        Game.workYears++;
        Game.promotionChecked = false;
        
        // é€™äº›å‡½æ•¸ç¾åœ¨å…§éƒ¨ä¹Ÿä¿®æ­£ç‚º Game äº†
        updateInflation();
        payMortgage();
        updateChildren();
        checkPromotion();

        // æ¯5å¹´è‡ªå‹•å­˜æª”
        if (Game.age % 5 === 0) { // ä¿®æ­£ï¼šgame -> Game
          saveGame();
        }

        const newStage = LIFE_STAGES.find(
          (s) => Game.age >= s.min && Game.age <= s.max,
        );

        // ç”Ÿæ´»æˆæœ¬ç³»ç»Ÿ
        let livingCost = 0;
        if (Game.age >= 18 && Game.age < 25) {
          livingCost = 15000;
        } else if (Game.age >= 25 && Game.age < 40) {
          livingCost = 30000;
        } else if (Game.age >= 40 && Game.age < 60) {
          livingCost = 50000;
        } else if (Game.age >= 60) {
          livingCost = 70000;
        }

        const hasHouse = Game.inventory.some((i) => i.startsWith("house"));
        if (hasHouse) {
          livingCost = Math.floor(livingCost * 0.6);
        }

        const hasCar = Game.inventory.some((i) => i.startsWith("car"));
        if (hasCar) {
          livingCost += 12000;
        }

        if (livingCost > 0) {
          Game.money -= livingCost;
          log(`ğŸ’¸ å¹´åº¦ç”Ÿæ´»è²» -${livingCost.toLocaleString()}`);
        }

        // éšæœºçªå‘äº‹ä»¶
        if (Math.random() < 0.15) {
          const emergencies = [
            { name: "ğŸ“± æ‰‹æ©Ÿå£æ‰", cost: 8000 },
            { name: "ğŸ¥ çªç™¼ç–¾ç—…", cost: 15000 },
            { name: "ğŸ’» é›»è…¦æ•…éšœ", cost: 12000 },
            { name: "ğŸš— è»Šè¼›ç¶­ä¿®", cost: 20000 },
            { name: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶äººæ€¥ç”¨", cost: 25000 },
            { name: "ğŸ  æˆ¿å±‹ç¶­ä¿®", cost: 30000 },
          ];
          const emergency =
            emergencies[Math.floor(Math.random() * emergencies.length)];
          Game.money -= emergency.cost;
          Game.happy -= 5;
          log(`âš ï¸ ${emergency.name} -${emergency.cost.toLocaleString()}`);
        }

        updateNPCLifecycle();

        const yearChanges = [];

        if (Game.yearlyMoney > 0) {
          Game.money += Game.yearlyMoney;
          yearChanges.push(`ğŸ’° +${Game.yearlyMoney.toLocaleString()}`);
        }

        Game.inventory.forEach((item) => {
          const house = HOUSES.find((h) => h.id === item);
          if (house && house.passive) {
            Game.money += house.passive;
            yearChanges.push(
              `ğŸ  ${house.name} +${house.passive.toLocaleString()}`,
            );
          }
        });

        Game.health -= Math.floor(5 * Game.healthDecay);
        Game.happy -= Math.floor(3 * Game.happyDecay);

        if (Game.happy > 80) Game.happyYears++;

        if (Game.money < 0) {
          Game.hasBeenInDebt = true;
          log("âš ï¸ é™·å…¥è² å‚µï¼");
        }

        if (yearChanges.length > 0) {
          log(`ğŸ“… ${Game.age} æ­²ï¼š${yearChanges.join("ã€")}`);
        }

        if (oldStage && newStage && oldStage.name !== newStage.name) {
          log(`ğŸ‚ é€²å…¥æ–°éšæ®µï¼š${newStage.icon} ${newStage.name}`);

          const toast = document.createElement("div");
          toast.style.cssText = `
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent), var(--purple));
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            z-index: 400;
            box-shadow: 0 8px 25px rgba(187, 134, 252, 0.6);
            animation: slideIn 0.5s;
            font-size: 1.2em;
            border: 3px solid white;
        `;
          toast.innerHTML = `${newStage.icon} é€²å…¥ ${newStage.name}`;
          document.body.appendChild(toast);

          setTimeout(() => {
            toast.style.animation = "slideIn 0.5s reverse";
            setTimeout(() => {
              if (toast.parentNode) {
                document.body.removeChild(toast);
              }
            }, 500);
          }, 2000);
        }

        checkAchievements();

        updateUI();
        renderChildrenList(); 
        
        // å»¶é²è§£é–ï¼Œè®“æŒ‰éˆ•æ¢å¾©å¯ç”¨
        setTimeout(() => {
          isProcessing = false;
        }, 300);
      }
      // ===== ğŸ« æ•™è‚²ç³»çµ± =====
      // ===== ğŸ« æ•™è‚²ç³»çµ±ï¼ˆå°ç£å­¸æ ¡ç‰ˆï¼‰=====
      const EDUCATION_LEVELS = [
        { id: "none", name: "ç„¡å­¸æ­·", minAge: 0, unlock: true },
        {
          id: "kindergarten",
          name: "å¹¼å…’åœ’",
          minAge: 3,
          unlock: true,
          bonus: { intel: 2 },
        },
        {
          id: "elementary",
          name: "å°å­¸",
          minAge: 6,
          unlock: true,
          bonus: { intel: 5, "skills.communication": 5 },
        },
        {
          id: "middle",
          name: "åœ‹ä¸­",
          minAge: 13,
          unlock: true,
          bonus: { intel: 10, "skills.communication": 10 },
        },
        {
          id: "high",
          name: "é«˜ä¸­",
          minAge: 16,
          unlock: false,
          requirement: { intel: 40 },
          bonus: { intel: 15, "skills.communication": 15 },
        },
        {
          id: "university",
          name: "å¤§å­¸",
          minAge: 19,
          unlock: false,
          requirement: { intel: 60 },
          bonus: { intel: 25, "skills.communication": 20 },
          cost: 200000,
        },
        {
          id: "master",
          name: "ç¢©å£«",
          minAge: 23,
          unlock: false,
          requirement: { intel: 80 },
          bonus: { intel: 35, "skills.communication": 25 },
          cost: 300000,
        },
        {
          id: "phd",
          name: "åšå£«",
          minAge: 26,
          unlock: false,
          requirement: { intel: 100 },
          bonus: { intel: 50, "skills.communication": 30 },
          cost: 500000,
        },
      ];

      // å°ç£å¯¦éš›å­¸æ ¡åå–®
      const TAIWAN_SCHOOLS = {
        kindergarten: [
          "ä½•å˜‰ä»å¹¼å…’åœ’",
          "åº·æ©‹å¹¼å…’åœ’",
          "èŠéº»è¡—ç¾èªå¹¼å…’åœ’",
          "å‰çš„å ¡å¹¼å…’åœ’",
          "å°å“ˆä½›å¹¼å…’åœ’",
          "é“ç¦¾å¹¼å…’åœ’",
          "ä¿¡èª¼å¹¼å…’åœ’",
          "å¸‚ç«‹å¹¼å…’åœ’",
        ],
        elementary: [
          "å°åŒ—å¸‚ç«‹åœ‹èªå¯¦å°",
          "æ–°åŒ—å¸‚æ¿æ©‹åœ‹å°",
          "æ¡ƒåœ’å¸‚ä¸­å£¢åœ‹å°",
          "å°ä¸­å¸‚åŠ›è¡Œåœ‹å°",
          "å°å—å¸‚å‹åˆ©åœ‹å°",
          "é«˜é›„å¸‚é¼“å±±åœ‹å°",
          "æ–°ç«¹å¸‚æ±é–€åœ‹å°",
          "å°åŒ—å¸‚æ•¦åŒ–åœ‹å°",
        ],
        middle: [
          "å°åŒ—å¸‚ç«‹é‡‘è¯åœ‹ä¸­",
          "æ–°åŒ—å¸‚ç«‹æ¿æ©‹åœ‹ä¸­",
          "æ¡ƒåœ’å¸‚ç«‹é’æºªåœ‹ä¸­",
          "å°ä¸­å¸‚ç«‹å±…ä»åœ‹ä¸­",
          "å°å—å¸‚ç«‹å»ºèˆˆåœ‹ä¸­",
          "é«˜é›„å¸‚ç«‹æ˜è¯åœ‹ä¸­",
          "æ–°ç«¹å¸‚ç«‹å»ºè¯åœ‹ä¸­",
          "å°åŒ—å¸‚ç«‹ä¸­æ­£åœ‹ä¸­",
        ],
        high: [
          // é ‚å°–é«˜ä¸­ï¼ˆéœ€è¦é«˜æ™ºåŠ›ï¼‰
          { name: "å°åŒ—å¸‚ç«‹å»ºåœ‹ä¸­å­¸", requirement: 90, prestige: "top" },
          { name: "å°åŒ—å¸‚ç«‹åŒ—ä¸€å¥³ä¸­", requirement: 90, prestige: "top" },
          { name: "åœ‹ç«‹å¸«å¤§é™„ä¸­", requirement: 85, prestige: "top" },
          { name: "å°ä¸­å¸‚ç«‹å°ä¸­ä¸€ä¸­", requirement: 85, prestige: "top" },
          { name: "å°å—å¸‚ç«‹å°å—ä¸€ä¸­", requirement: 85, prestige: "top" },
          { name: "é«˜é›„å¸‚ç«‹é«˜é›„ä¸­å­¸", requirement: 85, prestige: "top" },

          // å„ªè³ªé«˜ä¸­
          { name: "å°åŒ—å¸‚ç«‹æˆåŠŸé«˜ä¸­", requirement: 75, prestige: "good" },
          { name: "å°åŒ—å¸‚ç«‹ä¸­å±±å¥³ä¸­", requirement: 75, prestige: "good" },
          { name: "æ–°åŒ—å¸‚ç«‹æ¿æ©‹é«˜ä¸­", requirement: 70, prestige: "good" },
          { name: "æ¡ƒåœ’å¸‚ç«‹æ­¦é™µé«˜ä¸­", requirement: 80, prestige: "good" },
          { name: "æ–°ç«¹å¸‚ç«‹æ–°ç«¹é«˜ä¸­", requirement: 75, prestige: "good" },
          { name: "å°ä¸­å¸‚ç«‹å°ä¸­å¥³ä¸­", requirement: 80, prestige: "good" },

          // ä¸€èˆ¬é«˜ä¸­
          { name: "å°åŒ—å¸‚ç«‹æ¾å±±é«˜ä¸­", requirement: 60, prestige: "normal" },
          { name: "æ–°åŒ—å¸‚ç«‹æ–°èŠé«˜ä¸­", requirement: 55, prestige: "normal" },
          { name: "æ¡ƒåœ’å¸‚ç«‹ä¸­å£¢é«˜ä¸­", requirement: 60, prestige: "normal" },
          { name: "å°ä¸­å¸‚ç«‹æƒ æ–‡é«˜ä¸­", requirement: 65, prestige: "normal" },
          { name: "å°å—å¸‚ç«‹å°å—äºŒä¸­", requirement: 60, prestige: "normal" },
          { name: "é«˜é›„å¸‚ç«‹æ–°èŠé«˜ä¸­", requirement: 55, prestige: "normal" },
        ],
        university: [
          // é ‚å°–å¤§å­¸
          { name: "åœ‹ç«‹å°ç£å¤§å­¸", requirement: 85, prestige: "top" },
          { name: "åœ‹ç«‹æ¸…è¯å¤§å­¸", requirement: 80, prestige: "top" },
          { name: "åœ‹ç«‹é™½æ˜äº¤é€šå¤§å­¸", requirement: 80, prestige: "top" },
          { name: "åœ‹ç«‹æˆåŠŸå¤§å­¸", requirement: 75, prestige: "top" },

          // å„ªè³ªå¤§å­¸
          { name: "åœ‹ç«‹æ”¿æ²»å¤§å­¸", requirement: 70, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­å¤®å¤§å­¸", requirement: 68, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­èˆˆå¤§å­¸", requirement: 65, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­å±±å¤§å­¸", requirement: 65, prestige: "good" },
          { name: "åœ‹ç«‹å°ç£å¸«ç¯„å¤§å­¸", requirement: 70, prestige: "good" },

          // ä¸€èˆ¬å¤§å­¸
          { name: "åœ‹ç«‹å°åŒ—å¤§å­¸", requirement: 60, prestige: "normal" },
          { name: "åœ‹ç«‹å°ç£ç§‘æŠ€å¤§å­¸", requirement: 65, prestige: "normal" },
          { name: "åœ‹ç«‹å°åŒ—ç§‘æŠ€å¤§å­¸", requirement: 63, prestige: "normal" },
          { name: "è¼”ä»å¤§å­¸", requirement: 60, prestige: "normal" },
          { name: "æ±å³å¤§å­¸", requirement: 58, prestige: "normal" },
          { name: "æ·¡æ±Ÿå¤§å­¸", requirement: 55, prestige: "normal" },
          { name: "é€¢ç”²å¤§å­¸", requirement: 58, prestige: "normal" },
        ],
      };
      const MAJORS = {
        university: [
          {
            id: "cs",
            name: "è³‡è¨Šå·¥ç¨‹å­¸ç³»",
            skills: { programming: 30 },
            intel: 10,
          },
          {
            id: "business",
            name: "ä¼æ¥­ç®¡ç†å­¸ç³»",
            skills: { finance: 30, communication: 20 },
            intel: 5,
          },
          {
            id: "medicine",
            name: "é†«å­¸ç³»",
            skills: { medical: 40 },
            intel: 20,
            requirement: 85,
          },
          {
            id: "art",
            name: "è—è¡“å­¸ç³»",
            skills: { art: 35, charm: 15 },
            intel: 5,
          },
          {
            id: "engineering",
            name: "é›»æ©Ÿå·¥ç¨‹å­¸ç³»",
            skills: { programming: 20, communication: 10 },
            intel: 15,
          },
          {
            id: "education",
            name: "æ•™è‚²å­¸ç³»",
            skills: { communication: 30 },
            intel: 10,
          },
          {
            id: "law",
            name: "æ³•å¾‹å­¸ç³»",
            skills: { communication: 25 },
            intel: 15,
          },
          {
            id: "economics",
            name: "ç¶“æ¿Ÿå­¸ç³»",
            skills: { finance: 35 },
            intel: 12,
          },
        ],
        master: [
          {
            id: "mba",
            name: "MBA ä¼ç®¡ç¢©å£«",
            skills: { finance: 40, communication: 30 },
            intel: 15,
          },
          {
            id: "cs_master",
            name: "è³‡å·¥ç¢©å£«",
            skills: { programming: 45 },
            intel: 20,
          },
          {
            id: "med_master",
            name: "é†«å­¸ç¢©å£«",
            skills: { medical: 55 },
            intel: 25,
          },
        ],
        phd: [
          {
            id: "cs_phd",
            name: "è³‡å·¥åšå£«",
            skills: { programming: 60 },
            intel: 30,
          },
          {
            id: "med_phd",
            name: "é†«å­¸åšå£«",
            skills: { medical: 70 },
            intel: 35,
          },
        ],
      };
      const CARS = [
        {
          id: "car1",
          name: "åœ‹ç”¢ä»£æ­¥è»Š",
          price: 500000,
          charm: 3,
          desc: "é®é¢¨é¿é›¨å°±å¥½",
        },
        {
          id: "car2",
          name: "Toyota Camry",
          price: 1200000,
          charm: 8,
          desc: "å¯é è€ç”¨çš„ä¸­å‹æˆ¿è»Š",
        },
        {
          id: "car3",
          name: "Tesla Model 3",
          price: 1800000,
          charm: 15,
          desc: "é›»å‹•è»Šæ–°æ½®æµ",
        },
        {
          id: "car4",
          name: "BMW 5ç³»åˆ—",
          price: 3500000,
          charm: 25,
          desc: "è±ªè¯å“ç‰Œè±¡å¾µ",
        },
        {
          id: "car5",
          name: "ä¿æ™‚æ· 911",
          price: 7000000,
          charm: 40,
          desc: "ç¶“å…¸è·‘è»Š",
        },
        {
          id: "car6",
          name: "æ³•æ‹‰åˆ© F8",
          price: 15000000,
          charm: 70,
          desc: "çµ‚æ¥µå¤¢å¹»è·‘è»Š",
        },
      ];

      const HOUSES = [
        {
          id: "house1",
          name: "å°å¥—æˆ¿",
          price: 2500000,
          happy: 5,
          passive: 1800,
          desc: "æº«é¦¨çš„å°çª©",
        }, // åŸ3000 â†’ 1800
        {
          id: "house2",
          name: "å…¬å¯“",
          price: 6000000,
          happy: 12,
          passive: 4800,
          desc: "èˆ’é©çš„å±…ä½ç©ºé–“",
        }, // åŸ8000 â†’ 4800
        {
          id: "house3",
          name: "é€å¤©å",
          price: 12000000,
          happy: 20,
          passive: 9000,
          desc: "å¯¬æ•çš„ç¨ç«‹ä½å®…",
        }, // åŸ15000 â†’ 9000
        {
          id: "house4",
          name: "åˆ¥å¢…",
          price: 25000000,
          happy: 30,
          passive: 18000,
          desc: "è±ªè¯çš„åˆ¥å¢…",
        }, // åŸ30000 â†’ 18000
        {
          id: "house5",
          name: "è±ªå®…",
          price: 80000000,
          happy: 50,
          passive: 48000,
          desc: "é ‚ç´šè±ªå®…",
        }, // åŸ80000 â†’ 48000
        {
          id: "house6",
          name: "åŸå ¡",
          price: 200000000,
          happy: 80,
          passive: 120000,
          desc: "å¤¢å¹»çš„åŸå ¡",
        }, // åŸ200000 â†’ 120000
      ];
      const LUXURIES = [
        {
          id: "lux1",
          name: "å‹åŠ›å£«æ‰‹éŒ¶",
          price: 500000,
          charm: 10,
          desc: "æ™‚é–“çš„è—è¡“å“",
        },
        {
          id: "lux2",
          name: "åç‰ŒåŒ…",
          price: 300000,
          charm: 8,
          desc: "LVã€Gucciã€HermÃ¨s",
        },
        {
          id: "lux3",
          name: "é«˜ç´šéŸ³éŸ¿",
          price: 800000,
          happy: 10,
          desc: "äº«å—é ‚ç´šéŸ³è³ª",
        },
        {
          id: "lux4",
          name: "éŠè‰‡",
          price: 50000000,
          charm: 50,
          happy: 30,
          desc: "æµ·ä¸Šç§»å‹•åŸå ¡",
        },
        {
          id: "lux5",
          name: "ç§äººé£›æ©Ÿ",
          price: 300000000,
          charm: 100,
          happy: 50,
          desc: "çµ‚æ¥µå¥¢è¯",
        },
      ];
      // ===== ğŸ‘¥ NPC ç³»çµ± =====
      const NPC_TEMPLATES = {
        classmate: [
          { name: "é™³å¥•å®‰", personality: "friendly", baseRelation: 50 },
          { name: "æ—ä¿Šä½‘", personality: "quiet", baseRelation: 40 },
          { name: "ç‹é›²å“²", personality: "outgoing", baseRelation: 60 },
          { name: "å¼µåŠè¼", personality: "smart", baseRelation: 45 },
          { name: "åŠ‰è¬™åœ", personality: "athletic", baseRelation: 55 },
          { name: "è²·åç¿”", personality: "artistic", baseRelation: 50 },
          { name: "æ¥Šæ­£ç†™", personality: "leader", baseRelation: 65 },
          { name: "é„­é †å‰", personality: "kind", baseRelation: 70 },
          {
            name: "é™³é›…å©·",
            personality: "kind",
            baseRelation: 70,
            gender: "female",
          },
          {
            name: "æ—ä½³ç©",
            personality: "smart",
            baseRelation: 48,
            gender: "female",
          },
          {
            name: "é»ƒæ€¡å›",
            personality: "artistic",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "å¼µå¿ƒæ€¡",
            personality: "gentle",
            baseRelation: 60,
            gender: "female",
          },
          {
            name: "æè©©æ¶µ",
            personality: "quiet",
            baseRelation: 42,
            gender: "female",
          },
          {
            name: "ç‹é›…é›¯",
            personality: "outgoing",
            baseRelation: 62,
            gender: "female",
          },
          {
            name: "å³ä½©å›",
            personality: "kind",
            baseRelation: 68,
            gender: "female",
          },
          {
            name: "åŠ‰æ¬£æ€¡",
            personality: "cheerful",
            baseRelation: 58,
            gender: "female",
          },
          {
            name: "è”¡å®œåº­",
            personality: "artistic",
            baseRelation: 52,
            gender: "female",
          },
          {
            name: "æ¥Šéœæ€¡",
            personality: "gentle",
            baseRelation: 56,
            gender: "female",
          },
        ],
        colleague: [
          // ç”·æ€§åŒäº‹
          {
            name: "ç‹ç¶“ç†å¿—æ˜",
            personality: "strict",
            baseRelation: 30,
            gender: "male",
          },
          {
            name: "é™³å·¥ç¨‹å¸«å»ºåœ‹",
            personality: "quiet",
            baseRelation: 40,
            gender: "male",
          },
          {
            name: "æ—ä¸»ç®¡æ–‡é¾",
            personality: "competitive",
            baseRelation: 35,
            gender: "male",
          },
          {
            name: "å¼µå”ç†ä¿Šå®",
            personality: "leader",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "é»ƒè³‡æ·±å“¡å·¥å¿—è±ª",
            personality: "helpful",
            baseRelation: 60,
            gender: "male",
          },

          // å¥³æ€§åŒäº‹
          {
            name: "æå§æ·‘èŠ¬",
            personality: "helpful",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "åŠ‰å°å§é›…èŠ³",
            personality: "cheerful",
            baseRelation: 55,
            gender: "female",
          },
          {
            name: "å³ä¸»ä»»ç¾ç²",
            personality: "strict",
            baseRelation: 32,
            gender: "female",
          },
          {
            name: "é™³ç§˜æ›¸ä½©çŠ",
            personality: "kind",
            baseRelation: 58,
            gender: "female",
          },
          {
            name: "æ¥Šçµ„é•·æ·‘æƒ ",
            personality: "competitive",
            baseRelation: 38,
            gender: "female",
          },
        ],

        neighbor: [
          // ç”·æ€§é„°å±…
          {
            name: "éš”å£è€ç‹",
            personality: "nosy",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "æ¨“ä¸‹é™³ä¼¯ä¼¯",
            personality: "kind",
            baseRelation: 60,
            gender: "male",
          },
          {
            name: "å°é–€çš„å¤§å­¸ç”Ÿå°å‚‘",
            personality: "friendly",
            baseRelation: 50,
            gender: "male",
          },
          {
            name: "ä¸€æ¨“æ—å…ˆç”Ÿ",
            personality: "quiet",
            baseRelation: 42,
            gender: "male",
          },

          // å¥³æ€§é„°å±…
          {
            name: "æ¨“ä¸Šé™³å¤ªå¤ª",
            personality: "gossipy",
            baseRelation: 40,
            gender: "female",
          },
          {
            name: "ç‹åª½åª½",
            personality: "kind",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "ä¾¿åˆ©å•†åº—åº—å“¡å°ç¾",
            personality: "friendly",
            baseRelation: 55,
            gender: "female",
          },
          {
            name: "é„°å±…æé˜¿å§¨",
            personality: "helpful",
            baseRelation: 58,
            gender: "female",
          },
        ],

        romantic: [
          // é©åˆç•¶æˆ€æ„›å°è±¡çš„å¥³ç”Ÿ
          {
            name: "æ—å¿ƒå¦‚",
            personality: "gentle",
            baseRelation: 30,
            gender: "female",
            charm: 80,
          },
          {
            name: "é™³é›¨æ¶µ",
            personality: "artistic",
            baseRelation: 28,
            gender: "female",
            charm: 75,
          },
          {
            name: "å¼µè©©å©·",
            personality: "quiet",
            baseRelation: 25,
            gender: "female",
            charm: 78,
          },
          {
            name: "é»ƒæ€¡å®‰",
            personality: "cheerful",
            baseRelation: 32,
            gender: "female",
            charm: 82,
          },
          {
            name: "æé›…ç­‘",
            personality: "smart",
            baseRelation: 26,
            gender: "female",
            charm: 76,
          },
          {
            name: "ç‹æ€æ¶µ",
            personality: "kind",
            baseRelation: 30,
            gender: "female",
            charm: 79,
          },
          {
            name: "å³ä½³è“‰",
            personality: "outgoing",
            baseRelation: 35,
            gender: "female",
            charm: 77,
          },
          {
            name: "åŠ‰å©‰å©·",
            personality: "gentle",
            baseRelation: 28,
            gender: "female",
            charm: 81,
          },

          // é©åˆç•¶æˆ€æ„›å°è±¡çš„ç”·ç”Ÿ
          {
            name: "é™³æŸå®‡",
            personality: "confident",
            baseRelation: 28,
            gender: "male",
            charm: 78,
          },
          {
            name: "æ—å­è»’",
            personality: "mature",
            baseRelation: 25,
            gender: "male",
            charm: 80,
          },
          {
            name: "å¼µæ–‡å‡±",
            personality: "cheerful",
            baseRelation: 30,
            gender: "male",
            charm: 75,
          },
          {
            name: "é»ƒä¿Šå‡±",
            personality: "athletic",
            baseRelation: 32,
            gender: "male",
            charm: 77,
          },
          {
            name: "æå† å»·",
            personality: "smart",
            baseRelation: 26,
            gender: "male",
            charm: 76,
          },
          {
            name: "ç‹å®¥å‹",
            personality: "gentle",
            baseRelation: 28,
            gender: "male",
            charm: 79,
          },
          {
            name: "å³æ‰¿æ¾”",
            personality: "confident",
            baseRelation: 30,
            gender: "male",
            charm: 82,
          },
          {
            name: "åŠ‰å½¥å»·",
            personality: "mature",
            baseRelation: 27,
            gender: "male",
            charm: 81,
          },
        ],

        // é¡å¤–ï¼šè€å¸«/é•·è¼©
        teacher: [
          {
            name: "ç‹è€å¸«æ·‘è²",
            personality: "strict",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "é™³è€å¸«æ–‡é›„",
            personality: "kind",
            baseRelation: 60,
            gender: "male",
          },
          {
            name: "æ—è€å¸«ç¾æƒ ",
            personality: "helpful",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "å¼µè€å¸«å¿—æˆ",
            personality: "strict",
            baseRelation: 48,
            gender: "male",
          },
          {
            name: "é»ƒè€å¸«é›…èŠ³",
            personality: "gentle",
            baseRelation: 62,
            gender: "female",
          },
        ],

        // é¡å¤–ï¼šæœ‹å‹çš„æœ‹å‹
        friend: [
          {
            name: "é™³å“ç¿°",
            personality: "outgoing",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "æ—æ€å¦¤",
            personality: "cheerful",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "é»ƒå®‡è¾°",
            personality: "friendly",
            baseRelation: 48,
            gender: "male",
          },
          {
            name: "å¼µè© æ™´",
            personality: "kind",
            baseRelation: 52,
            gender: "female",
          },
          {
            name: "ææ‰¿ç¿°",
            personality: "athletic",
            baseRelation: 46,
            gender: "male",
          },
          {
            name: "ç‹èŠ·è±",
            personality: "artistic",
            baseRelation: 50,
            gender: "female",
          },
        ],
      };

      const NPC_INTERACTIONS = {
        chat: { cost: 10, relationChange: 5, moneyChange: 0, desc: "é–’èŠ" },
        help: {
          cost: 20,
          relationChange: 10,
          moneyChange: -1000,
          desc: "å¹«åŠ©å°æ–¹",
        },
        gift: {
          cost: 15,
          relationChange: 15,
          moneyChange: -3000,
          desc: "é€ç¦®ç‰©",
        },
        date: {
          cost: 25,
          relationChange: 20,
          moneyChange: -2000,
          desc: "ç´„æœƒ",
          requireRelation: 50,
        },
        argue: { cost: 5, relationChange: -20, moneyChange: 0, desc: "çˆ­åµ" },
      };

      // ==========================================
      // ğŸ”´ éŠæˆ²ç‹€æ…‹
      // ==========================================
      let currentOriginIndex = 0;
      let skillsCollapsed = false;
      let currentJobIndex = 0; // ç•¶å‰é¡¯ç¤ºçš„è·æ¥­ç´¢å¼•
      let isProcessing = false; // é˜²æ­¢é‡å¤ç‚¹å‡»
      let lastUpdateTime = 0;
      const UPDATE_THROTTLE = 50; // UIæ›´æ–°èŠ‚æµ
      let Game = {
        name: "",
        origin: "",
        originId: "",
        education: "none",
        major: "",
        isStudying: false,
        studyProgress: 0,
        age: 0,
        gender: "ç”·",
        money: 0,
        health: 100,
        happy: 80,
        intel: 50,
        stamina: 100,
        maxStamina: 100,
        workYears: 0, // å·¥ä½œå¹´è³‡
        promotionChecked: false, // æœ¬å¹´æ˜¯å¦å·²æª¢æŸ¥æ™‰å‡
        children: [], // å­å¥³é™£åˆ—
        inflationRate: 1.0, // é€šè†¨å€ç‡
        yearsPassed: 0, // ç¶“éå¹´æ•¸
        mortgage: {
          // æˆ¿è²¸ç³»çµ±
          active: false,
          totalAmount: 0,
          remaining: 0,
          monthlyPayment: 0,
          years: 0,
        },

        skills: {
          programming: 0,
          art: 0,
          medical: 0,
          cooking: 0,
          finance: 0,
          communication: 0,
          charm: 0,
        },

        jobId: "none",
        jobYears: 0,
        yearlyMoney: 0,

        inventory: [],
        relationships: [],
        npcs: [],
        metNPCs: [],
        talents: [],
        traits: [],
        unlockedTraits: [],
        unlockedAchievements: [],

        happyYears: 0,
        debtYears: 0,
        hasBeenInDebt: false,
        totalActions: 0,
        totalEvents: 0,

        // åŠ æˆä¿‚æ•¸
        learnBonus: 1,
        healthDecay: 1,
        happyDecay: 1,
        socialBonus: 1,
        incomeBonus: 1,
        workPenalty: 1,
        skillBonus: 1,
        luckBonus: 0,
      };

      let activeEvent = null;
      let selectedOriginId = "common";
      let currentTraitIndex = 0; // âœ… æ–°å¢ï¼šç•¶å‰é¡¯ç¤ºçš„ç‰¹è³ªç´¢å¼•
      let availableTraits = []; // âœ… æ–°å¢ï¼šå¯é¸æ“‡çš„ç‰¹è³ªåˆ—è¡¨
      let selectedTraits = [];
      let traitChoices = [];
      // ==========================================
      // ğŸ”´ åˆå§‹åŒ–
      // ==========================================

      function initCreation() {
        renderOriginCard();
      }

      function renderOriginCard() {
        // ç¢ºä¿ç´¢å¼•åœ¨ç¯„åœå…§
        if (currentOriginIndex >= ORIGINS.length) currentOriginIndex = 0;
        if (currentOriginIndex < 0) currentOriginIndex = ORIGINS.length - 1;

        const o = ORIGINS[currentOriginIndex];

        let html = `
              <div style="position: relative; min-height: 450px;">
                  <!-- å·¦ç®­é ­ -->
                  <button onclick="prevOrigin()"
                          style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
                                 width: 60px; height: 60px; border-radius: 50%; font-size: 2em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 100;
                                 border: 3px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                      â—€
                  </button>

                  <!-- å³ç®­é ­ -->
                  <button onclick="nextOrigin()"
                          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                                 width: 60px; height: 60px; border-radius: 50%; font-size: 2em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 100;
                                 border: 3px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                      â–¶
                  </button>

                  <!-- å‡ºèº«å¡ç‰‡ -->
                  <div style="padding: 0 80px;">
                      <div class="origin-card selected"
                           style="transform: scale(1.05); box-shadow: 0 10px 30px rgba(187, 134, 252, 0.4);
                                  border-color: var(--accent); cursor: default;">
                          <div class="origin-name" style="font-size: 1.8em; text-align: center; margin-bottom: 10px; color: var(--gold);">
                              ${o.name}
                          </div>
                          <div class="origin-parents" style="text-align: center; font-size: 1em; margin-bottom: 15px; color: #888;">
                              ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ${o.parents}
                          </div>
                          <div class="origin-desc" style="line-height: 1.6; margin: 15px 0; font-size: 0.95em; color: var(--text-dim);">
                              ${o.desc}
                          </div>
                          <div class="origin-stats" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                              <div style="margin-bottom: 8px;">
                                  ğŸ’° åˆå§‹è³‡é‡‘: <span style="color: var(--gold); font-weight: bold;">$${o.money.toLocaleString()}</span>
                              </div>
                              <div style="margin-bottom: 8px;">
                                  ğŸ§  æ™ºåŠ›: ${o.intel} | ğŸ˜Š å¿«æ¨‚: ${o.happy}
                              </div>
                              <div style="margin-bottom: 8px;">
                                  ğŸ“… å¹´æ”¶å…¥: $${o.yearlyMoney.toLocaleString()}
                              </div>
                              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); color: var(--green);">
                                  âœ¨ ${o.buff}
                              </div>
                          </div>
                      </div>

                      <!-- æŒ‡ç¤ºå™¨ -->
                      <div style="text-align: center; margin-top: 20px; color: var(--text-dim);">
                          <div style="font-size: 1.1em; margin-bottom: 5px;">
                              å‡ºèº« ${currentOriginIndex + 1} / ${ORIGINS.length}
                          </div>
                          <div style="font-size: 0.9em;">
                              ğŸ’¡ å·¦å³åˆ‡æ›æŸ¥çœ‹æ›´å¤šå‡ºèº«èƒŒæ™¯
                          </div>
                      </div>
                  </div>
              </div>
          `;

        document.getElementById("origin-list").innerHTML = html;

        // è‡ªå‹•é¸ä¸­ç•¶å‰å‡ºèº«
        selectOrigin(o.id);
      }

      function selectOrigin(id) {
        selectedOriginId = id;
      }
      function prevOrigin() {
        currentOriginIndex--;
        if (currentOriginIndex < 0) {
          currentOriginIndex = ORIGINS.length - 1;
        }
        renderOriginCard();
      }

      function nextOrigin() {
        currentOriginIndex++;
        if (currentOriginIndex >= ORIGINS.length) {
          currentOriginIndex = 0;
        }
        renderOriginCard();
      }
      function toggleSkills() {
        skillsCollapsed = !skillsCollapsed;
        updateUI();
      }
      function showChanges(changes) {
        const changeDiv = document.createElement("div");
        changeDiv.style.cssText = `
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        background: linear-gradient(135deg, rgba(30, 30, 46, 0.98), rgba(42, 42, 62, 0.98));
        border: 3px solid var(--accent);
        border-radius: 20px;
        padding: 25px 35px;
        z-index: 500;
        box-shadow: 0 15px 50px rgba(187, 134, 252, 0.4), 0 0 20px rgba(187, 134, 252, 0.2);
        min-width: 250px;
        text-align: center;
        animation: popIn 0.3s ease-out forwards;
    `;

        let html =
          '<div style="font-size: 1.3em; font-weight: bold; color: var(--gold); margin-bottom: 15px; text-shadow: 0 0 10px var(--gold);">âœ¨ æ•¸å€¼è®ŠåŒ–</div>';
        html +=
          '<div style="display: flex; flex-direction: column; gap: 8px;">';

        changes.forEach((change) => {
          const isPositive = change.includes("+");
          const color = isPositive ? "var(--green)" : "var(--red)";
          const icon = isPositive ? "â–²" : "â–¼";
          html += `
            <div style="font-size: 1.05em; padding: 8px 15px; background: rgba(0,0,0,0.3); 
                        border-radius: 8px; color: ${color}; font-weight: bold; 
                        border-left: 3px solid ${color};">
                ${icon} ${change}
            </div>
        `;
        });

        html += "</div>";
        changeDiv.innerHTML = html;
        document.body.appendChild(changeDiv);

        // 2 ç§’å¾Œæ·¡å‡º
        setTimeout(() => {
          changeDiv.style.animation = "fadeOut 0.3s ease-out forwards";
          setTimeout(() => changeDiv.remove(), 300);
        }, 2000);
      }

      function startGame() {
        const name = document.getElementById("inp-name").value.trim();
        if (!name) return alert("è«‹è¼¸å…¥å§“å");

        const origin = ORIGINS.find((o) => o.id === selectedOriginId);
        const gender = document.getElementById("inp-gender").value;

        // éš¨æ©Ÿå¤©è³¦
        let talentPool = [...TALENTS];
        let selectedTalents = [];
        const talentCount = Math.random() > 0.6 ? 2 : 1;
        for (let i = 0; i < talentCount; i++) {
          const idx = Math.floor(Math.random() * talentPool.length);
          selectedTalents.push(talentPool[idx]);
          talentPool.splice(idx, 1);
        }
        const savedAchievements = loadAchievements();
        console.log("ğŸ“‚ è¼‰å…¥å·²ä¿å­˜çš„æˆå°±:", savedAchievements);
        // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
        Game = {
          ...Game,
          name,
          origin: origin.name,
          originId: origin.id,
          gender,
          money: origin.money,
          intel: origin.intel,
          happy: origin.happy,
          yearlyMoney: origin.yearlyMoney,
          talents: selectedTalents,
          age: 0,
          relationships: [],
          unlockedAchievements: savedAchievements, // âœ… ä½¿ç”¨å·²ä¿å­˜çš„æˆå°±
        };

        // è¨˜éŒ„æ˜¯å¦è² å‚µé
        if (Game.money < 0) Game.hasBeenInDebt = true;

        // æ ¹æ“šå‡ºèº«æ·»åŠ çˆ¶æ¯é—œä¿‚
        if (origin.parents && origin.parents !== "ç„¡") {
          const parentsSplit = origin.parents.split(" / ");
          if (parentsSplit.length === 2) {
            Game.relationships.push(
              {
                id: "dad",
                name: "çˆ¸çˆ¸",
                type: "parent",
                relation: 80,
                role: parentsSplit[0],
              },
              {
                id: "mom",
                name: "åª½åª½",
                type: "parent",
                relation: 90,
                role: parentsSplit[1],
              },
            );
          } else if (parentsSplit.length === 1) {
            Game.relationships.push({
              id: "mom",
              name: "åª½åª½",
              type: "parent",
              relation: 95,
              role: parentsSplit[0],
            });
          }
        }

        // æ‡‰ç”¨å‡ºèº«ç‰¹æ®Šæ•ˆæœ
        if (origin.id === "military") Game.health += 20;
        if (origin.id === "doctor") Game.skills.medical += 30;
        if (origin.id === "farmer") {
          Game.health += 15;
          Game.happy += 5;
        }
        if (origin.id === "fisher") Game.health += 10;
        if (origin.id === "aboriginal") {
          Game.skills.charm += 15;
          Game.skills.art += 20;
          Game.happy += 10;
        }
        if (origin.id === "immigrant") Game.skills.communication += 20;
        if (origin.id === "tech") Game.skills.programming += 30;
        if (origin.id === "artist") {
          Game.skills.art += 40;
          Game.skills.charm += 10;
        }
        if (origin.id === "politician") Game.skills.communication += 25;
        if (origin.id === "temple") {
          Game.skills.communication += 15;
          Game.happy += 5;
        }
        if (origin.id === "mafia") {
          Game.skills.charm += 20;
          Game.health += 15;
        }
        if (origin.id === "star") Game.skills.charm += 30;
        switch (origin.id) {
          case "royal":
            Game.relationships.push({
              id: "butler",
              name: "ç®¡å®¶é˜¿çˆ¾å¼—é›·å¾·",
              type: "servant",
              relation: 80,
              role: "å¿ èª ç®¡å®¶",
            });
            Game.skills.charm += 30;
            break;
          case "mafia":
            Game.relationships.push({
              id: "bodyguard",
              name: "ä¿é‘£é˜¿å¼·",
              type: "subordinate",
              relation: 70,
              role: "è²¼èº«ä¿é‘£",
            });
            break;
          case "hacker":
            Game.relationships.push({
              id: "mentor",
              name: "é§­å®¢å°å¸« Ghost",
              type: "mentor",
              relation: 85,
              role: "æŠ€è¡“å°å¸«",
            });
            Game.skills.programming += 50;
            break;
          case "monk":
            Game.relationships.push({
              id: "master",
              name: "å¸«çˆ¶ç„ç©º",
              type: "master",
              relation: 95,
              role: "æˆæ¥­æ©å¸«",
            });
            Game.health += 25;
            Game.happy += 10;
            break;
          case "spy":
            Game.relationships.push({
              id: "handler",
              name: "æ¥é ­äºº Mr. Smith",
              type: "contact",
              relation: 60,
              role: "ç¥ç§˜æ¥é ­äºº",
            });
            break;
          case "chef_family":
            Game.relationships.push({
              id: "sous_chef",
              name: "å‰¯ä¸»å»šè€æ",
              type: "colleague",
              relation: 75,
              role: "å»šæˆ¿å¤¥ä¼´",
            });
            Game.skills.cooking += 60;
            Game.skills.art += 20;
            break;
          case "detective":
            Game.relationships.push({
              id: "partner",
              name: "æ­æª”è€ç‹",
              type: "partner",
              relation: 80,
              role: "æœ€ä½³æ‹æª”",
            });
            break;
          case "esports":
            Game.relationships.push({
              id: "coach",
              name: "æ•™ç·´",
              type: "coach",
              relation: 75,
              role: "æˆ°éšŠæ•™ç·´",
            });
            break;
          case "fashion":
            Game.relationships.push({
              id: "stylist",
              name: "é€ å‹å¸«",
              type: "stylist",
              relation: 70,
              role: "å¾¡ç”¨é€ å‹å¸«",
            });
            Game.skills.charm += 35;
            Game.skills.art += 25;
            break;
          case "scientist_family":
            Game.relationships.push({
              id: "lab_assistant",
              name: "å¯¦é©—åŠ©ç†",
              type: "assistant",
              relation: 75,
              role: "ç ”ç©¶åŠ©ç†",
            });
            break;
        }
        // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
        // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
        Game.talents.forEach((t) => t.effect(Game));

        // âœ… é–‹å§‹ç‰¹è³ªé¸æ“‡æµç¨‹
        currentTraitStep = 0;
        selectedTraits = [];
        showTraitSelection();
      }

      // âœ… æ–°å¢ç‰¹è³ªé¸æ“‡å‡½æ•¸
      function showTraitSelection() {
        document.getElementById("scene-creation").style.display = "none";

        // åˆå§‹åŒ–å¯é¸ç‰¹è³ªï¼ˆåªæœ‰ unlock: 'default' çš„ï¼‰
        availableTraits = TRAITS.filter((t) => t.unlock === "default");
        currentTraitIndex = 0;
        selectedTraits = [];

        let selectionHtml = `
        <div style="padding: 20px; text-align: center; max-width: 600px; margin: 0 auto;">
            <h1 style="font-size: 2em; color: var(--gold); margin-bottom: 10px;">âœ¨ é¸æ“‡å€‹äººç‰¹è³ª</h1>
            <p style="color: var(--text-dim); margin-bottom: 20px;">è«‹é¸æ“‡ 3 å€‹ç‰¹è³ªä¾†å®šç¾©ä½ çš„äººç”Ÿ</p>
            
            <!-- å·²é¸ç‰¹è³ªé¡¯ç¤º -->
            <div id="selected-traits-display" style="margin-bottom: 20px; min-height: 50px;">
                <p style="color: var(--text-dim); font-size: 0.9em;">å·²é¸æ“‡ï¼š<span id="selected-count">0</span>/3</p>
                <div id="selected-traits-list" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 10px;"></div>
            </div>
            
            <!-- ç‰¹è³ªé¸æ“‡å¡ç‰‡ -->
            <div id="trait-card-container"></div>
            
            <!-- å®ŒæˆæŒ‰éˆ• -->
            <button class="btn-main" id="finish-trait-btn" onclick="finishTraitSelection()" disabled style="margin-top: 20px; opacity: 0.5;">
                é–‹å§‹éŠæˆ²
            </button>
        </div>
    `;

        document.getElementById("scene-creation").innerHTML = selectionHtml;
        document.getElementById("scene-creation").style.display = "block";

        renderTraitCard();
      }

      function renderTraitOptions() {
        let html = "";

        traitChoices.forEach((trait, index) => {
          html += `
            <div class="origin-card" onclick="selectTrait(${index})" 
                 style="margin: 15px auto; max-width: 500px; cursor: pointer;">
                <div class="origin-name" style="font-size: 1.5em; margin-bottom: 10px;">
                    ${trait.name}
                </div>
                <div class="origin-desc" style="font-size: 1em; line-height: 1.5; color: var(--text-dim);">
                    ${trait.desc}
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 0.9em; color: var(--green);">
                    é¡å‹ï¼š${trait.category === "personality" ? "æ€§æ ¼ç‰¹è³ª" : "èƒ½åŠ›ç‰¹è³ª"}
                </div>
            </div>
        `;
        });

        document.getElementById("trait-options").innerHTML = html;
      }
      // ===== âœ… æ–°å¢ç‰¹è³ªå¡ç‰‡æ¸²æŸ“å‡½æ•¸ =====
      // âœ… å„ªåŒ–å¾Œçš„ç‰¹è³ªå¡ç‰‡æ¸²æŸ“ (é©é…æ‰‹æ©Ÿ)
      function renderTraitCard() {
        // 1. ç¢ºä¿ç´¢å¼•åœ¨ç¯„åœå…§
        if (currentTraitIndex < 0)
          currentTraitIndex = availableTraits.length - 1;
        if (currentTraitIndex >= availableTraits.length) currentTraitIndex = 0;

        const trait = availableTraits[currentTraitIndex];
        const isSelected = selectedTraits.includes(trait.id);

        // 2. è¨­å®šèƒŒæ™¯é¡è‰² (æ ¹æ“šé¡å‹)
        let categoryColor, categoryName, badgeColor;
        if (trait.category === "personality") {
          categoryColor = "linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)"; // æ·±è—
          badgeColor = "#2196f3";
          categoryName = "æ€§æ ¼ç‰¹è³ª";
        } else if (trait.category === "ability") {
          categoryColor = "linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%)"; // ç´«è‰²
          badgeColor = "#9c27b0";
          categoryName = "èƒ½åŠ›ç‰¹è³ª";
        } else {
          categoryColor = "linear-gradient(135deg, #f12711 0%, #f5af19 100%)"; // æ©˜ç´…
          badgeColor = "#ff9800";
          categoryName = "ç‰¹æ®Šç‰¹è³ª";
        }

        // 3. æª¢æŸ¥è¡çª (Conflict Check)
        let conflictWarning = "";
        if (trait.conflictWith) {
          const conflictingSelected = selectedTraits.filter((id) =>
            trait.conflictWith.includes(id),
          );
          if (conflictingSelected.length > 0) {
            const conflictNames = conflictingSelected
              .map((id) => TRAITS.find((t) => t.id === id).name)
              .join("ã€");
            conflictWarning = `
            <div style="background: rgba(200, 50, 50, 0.2); padding: 8px; border-radius: 6px; margin-top: 10px; border: 1px solid #ff5252; font-size: 0.85em; display: flex; align-items: center; gap: 5px;">
                <span>âš ï¸</span> <span>èˆ‡å·²é¸çš„ <b>${conflictNames}</b> è¡çª</span>
            </div>`;
          }
        }

        // 4. è² é¢çå‹µé¡¯ç¤º
        let rewardInfo = "";
        if (trait.isNegative && trait.reward) {
          let rewards = [];
          if (trait.reward.money)
            rewards.push(`ğŸ’°$${(trait.reward.money / 1000).toFixed(0)}k`); // é¡¯ç¤ºç‚º k
          if (trait.reward.intel) rewards.push(`ğŸ§ +${trait.reward.intel}`);
          if (trait.reward.health) rewards.push(`â¤ï¸+${trait.reward.health}`);
          if (trait.reward.happy) rewards.push(`ğŸ˜Š+${trait.reward.happy}`);
          if (trait.reward.charm) rewards.push(`âœ¨+${trait.reward.charm}`);

          if (rewards.length > 0) {
            rewardInfo = `
            <div style="background: rgba(3, 218, 198, 0.1); padding: 8px; border-radius: 6px; margin-top: 10px; border: 1px solid var(--green); font-size: 0.85em; color: var(--green);">
                ğŸ <b>è£œå„Ÿï¼š</b> ${rewards.join(" ")}
            </div>`;
          }
        }

        // 5. ç”Ÿæˆ HTML
        let html = `
    <div class="trait-card-wrapper">
        <button class="trait-nav-btn trait-nav-prev" onclick="prevTrait()">â—€</button>
        <button class="trait-nav-btn trait-nav-next" onclick="nextTrait()">â–¶</button>

        <div class="trait-card-body ${isSelected ? "selected" : ""}" 
             onclick="toggleTraitSelection('${trait.id}')"
             style="background: ${isSelected ? "" : categoryColor};">
             
            ${isSelected ? '<div style="position: absolute; top: 15px; right: 15px; background: var(--green); color: black; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 0 10px var(--green);">âœ“</div>' : ""}

            <div class="trait-name-text" style="font-size: 1.8em; font-weight: bold; color: white; margin-bottom: 5px; text-shadow: 0 2px 5px rgba(0,0,0,0.5);">
                ${trait.name}
            </div>
            
            <div style="margin-bottom: 15px;">
                <span style="background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 20px; font-size: 0.8em; color: rgba(255,255,255,0.9); border: 1px solid rgba(255,255,255,0.2);">
                    ${categoryName}
                </span>
            </div>

            <div class="trait-desc-text" style="color: rgba(255,255,255,0.9); margin-bottom: 15px; font-size: 1.1em; line-height: 1.5; min-height: 3.2em;">
                ${trait.desc}
            </div>

            <div style="background: rgba(0,0,0,0.25); padding: 15px; border-radius: 10px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 0.9em; color: var(--gold); margin-bottom: 5px; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                    âœ¨ æ•ˆæœè©³æƒ…
                </div>
                <div style="font-size: 0.95em; line-height: 1.6; white-space: pre-wrap; color: #f0f0f0;">${trait.detailedEffect || "ç„¡ç‰¹æ®Šæ•ˆæœ"}</div>
            </div>

            ${rewardInfo}
            ${conflictWarning}

            <div style="margin-top: 15px; font-size: 0.8em; color: rgba(255,255,255,0.5); text-align: center;">
                ${isSelected ? "å†æ¬¡é»æ“Šå–æ¶ˆé¸æ“‡" : "é»æ“Šå¡ç‰‡é€²è¡Œé¸æ“‡"} <br>
                (${currentTraitIndex + 1} / ${availableTraits.length})
            </div>
        </div>

        <div class="mobile-nav-container">
            <button class="mobile-nav-btn" onclick="event.stopPropagation(); prevTrait()">â—€ ä¸Šä¸€å€‹</button>
            <button class="mobile-nav-btn" onclick="event.stopPropagation(); nextTrait()">ä¸‹ä¸€å€‹ â–¶</button>
        </div>
    </div>
    `;

        document.getElementById("trait-card-container").innerHTML = html;
        updateSelectedTraitsDisplay();
      }

      function prevTrait() {
        currentTraitIndex--;
        if (currentTraitIndex < 0)
          currentTraitIndex = availableTraits.length - 1;
        renderTraitCard();
      }

      function nextTrait() {
        currentTraitIndex++;
        if (currentTraitIndex >= availableTraits.length) currentTraitIndex = 0;
        renderTraitCard();
      }

      function toggleTraitSelection(traitId) {
        const trait = TRAITS.find((t) => t.id === traitId);
        const index = selectedTraits.indexOf(traitId);

        if (index !== -1) {
          // å–æ¶ˆé€‰æ‹©
          selectedTraits.splice(index, 1);
        } else {
          if (selectedTraits.length >= 3) {
            alert("âš ï¸ æœ€å¤šåªèƒ½é¸æ“‡ 3 å€‹ç‰¹è³ªï¼");
            return;
          }

          // âœ… æ£€æŸ¥å†²çª
          const conflicts = [];
          selectedTraits.forEach((selectedId) => {
            const selectedTrait = TRAITS.find((t) => t.id === selectedId);
            if (trait.conflictWith && trait.conflictWith.includes(selectedId)) {
              conflicts.push(selectedTrait.name);
            }
            if (
              selectedTrait.conflictWith &&
              selectedTrait.conflictWith.includes(traitId)
            ) {
              conflicts.push(selectedTrait.name);
            }
          });

          if (conflicts.length > 0) {
            alert(
              `âš ï¸ ç‰¹è³ªè¡çªï¼\n\n${trait.name} èˆ‡ ${conflicts.join("ã€")} äº’ç›¸çŸ›ç›¾ï¼Œç„¡æ³•åŒæ™‚é¸æ“‡ã€‚`,
            );
            return;
          }

          selectedTraits.push(traitId);
        }

        renderTraitCard();
        updateSelectedTraitsDisplay();
      }

      function updateSelectedTraitsDisplay() {
        document.getElementById("selected-count").textContent =
          selectedTraits.length;

        let selectedHtml = "";
        selectedTraits.forEach((id) => {
          const trait = TRAITS.find((t) => t.id === id);
          if (trait) {
            let bgColor =
              trait.category === "personality"
                ? "linear-gradient(135deg, #2196f3, #1976d2)"
                : "linear-gradient(135deg, #9c27b0, #7b1fa2)";

            selectedHtml += `
                <div class="trait-tooltip" style="background: ${bgColor}; padding: 8px 15px; border-radius: 20px; 
                     font-size: 0.9em; color: white; position: relative; cursor: pointer;"
                     onclick="toggleTraitSelection('${id}')">
                    ${trait.name} âœ•
                </div>
            `;
          }
        });

        document.getElementById("selected-traits-list").innerHTML =
          selectedHtml;

        // æ›´æ–°å®ŒæˆæŒ‰éˆ•
        const finishBtn = document.getElementById("finish-trait-btn");
        if (selectedTraits.length === 3) {
          finishBtn.disabled = false;
          finishBtn.style.opacity = "1";
        } else {
          finishBtn.disabled = true;
          finishBtn.style.opacity = "0.5";
        }
      }
      // âœ… å„ªåŒ–å¾Œçš„ç‰¹è³ªè©³æƒ…å½ˆçª— (ç²¾ç·»å¡ç‰‡ç‰ˆ)
      // âœ… æœ€çµ‚ä¿®å¾©ç‰ˆï¼šç‰¹è³ªè©³æƒ… (è§£æ±ºæ’ç‰ˆè·‘æ‰å•é¡Œ)
      function showTraitDetail(traitId) {
        const trait = TRAITS.find((t) => t.id === traitId);
        if (!trait) return;

        // 1. å–å¾— DOM å…ƒç´ 
        const modalBox = document.querySelector(".modal-box");
        const modalOverlay = document.getElementById("event-modal");
        const title = document.getElementById("ev-title");
        const desc = document.getElementById("ev-desc");
        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        // 2. é–‹å•Ÿã€Œç´”æ·¨æ¨¡å¼ã€ (ç§»é™¤åŸæœ¬çš„ padding å’Œ border)
        modalBox.classList.add("clean-modal");

        // 3. éš±è—åŸæœ¬çš„é€šç”¨æ¨™é¡Œèˆ‡æŒ‰éˆ• (æˆ‘å€‘æœƒåœ¨å¡ç‰‡å…§è‡ªå·±ç•«)
        title.style.display = "none";
        btnA.style.display = "none";
        btnB.style.display = "none";

        // 4. å®šç¾©ä¸»é¡Œé¡è‰²
        let themeColor, themeIcon, typeName;
        if (trait.category === "personality") {
          themeColor = "linear-gradient(135deg, #2196f3, #1976d2)";
          themeIcon = "ğŸ§˜";
          typeName = "æ€§æ ¼ç‰¹è³ª";
        } else if (trait.category === "ability") {
          themeColor = "linear-gradient(135deg, #9c27b0, #7b1fa2)";
          themeIcon = "âš¡";
          typeName = "èƒ½åŠ›ç‰¹è³ª";
        } else {
          themeColor = "linear-gradient(135deg, #ff9800, #f57c00)";
          themeIcon = "ğŸŒŸ";
          typeName = "ç‰¹æ®Šç‰¹è³ª";
        }

        // 5. æ§‹å»º HTML (åŒ…å«æ¨™é¡Œã€å…§å®¹ã€æŒ‰éˆ•)
        // æ³¨æ„ï¼šé€™è£¡æˆ‘å€‘è‡ªå·±å»ºç«‹äº†ä¸€å€‹å®Œæ•´çš„å¡ç‰‡çµæ§‹

        // è£œå„Ÿçå‹µå€å¡Š
        let rewardHtml = "";
        if (trait.isNegative && trait.reward) {
          let rewards = [];
          if (trait.reward.money)
            rewards.push(`ğŸ’° è³‡é‡‘ +$${trait.reward.money.toLocaleString()}`);
          if (trait.reward.intel)
            rewards.push(`ğŸ§  æ™ºåŠ› +${trait.reward.intel}`);
          if (trait.reward.health)
            rewards.push(`â¤ï¸ å¥åº· +${trait.reward.health}`);
          if (trait.reward.happy)
            rewards.push(`ğŸ˜Š å¿«æ¨‚ +${trait.reward.happy}`);

          if (rewards.length > 0) {
            rewardHtml = `
                <div style="margin-top: 15px; padding: 12px; background: rgba(3, 218, 198, 0.1); border: 1px solid rgba(3, 218, 198, 0.3); border-radius: 8px;">
                    <div style="color: var(--green); font-weight: bold; font-size: 0.9em; margin-bottom: 5px;">ğŸ è² é¢ç‰¹è³ªè£œå„Ÿ</div>
                    <div style="font-size: 0.85em; color: #eee; line-height: 1.6;">${rewards.join(" / ")}</div>
                </div>
            `;
          }
        }

        const cardHtml = `
        <div style="border-radius: 12px; overflow: hidden; background: #1e1e2e; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; max-height: 80vh;">
            
            <div style="background: ${themeColor}; padding: 25px 20px; text-align: center; position: relative; flex-shrink: 0;">
                <div style="font-size: 3em; margin-bottom: 5px; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">${themeIcon}</div>
                <div style="font-size: 1.8em; font-weight: bold; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3); letter-spacing: 1px;">
                    ${trait.name}
                </div>
                <div style="position: absolute; top: 15px; right: 15px; font-size: 0.75em; background: rgba(0,0,0,0.3); color: white; padding: 4px 10px; border-radius: 20px; backdrop-filter: blur(5px);">
                    ${typeName}
                </div>
            </div>

            <div class="trait-card-scroll">
                <div style="text-align: center; color: #b0b0b0; font-size: 1em; line-height: 1.6; margin-bottom: 20px; font-style: italic;">
                    "${trait.desc}"
                </div>

                <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; border: 1px solid rgba(255,255,255,0.08);">
                    <div style="color: var(--gold); font-size: 0.95em; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center;">
                        <span style="margin-right: 8px; font-size: 1.2em;">âš¡</span> ç‰¹è³ªå½±éŸ¿
                    </div>
                    <div style="color: #fff; font-size: 0.95em; line-height: 1.8; white-space: pre-line;">
                        ${trait.detailedEffect ? trait.detailedEffect : "ç„¡ç‰¹æ®Šæ•¸å€¼å½±éŸ¿"}
                    </div>
                </div>

                ${rewardHtml}
            </div>

            <div class="trait-card-footer">
                <button id="trait-close-btn" style="
                    width: 100%; 
                    padding: 12px; 
                    border: none; 
                    border-radius: 8px; 
                    background: ${themeColor}; 
                    color: white; 
                    font-weight: bold; 
                    font-size: 1em; 
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                    transition: transform 0.2s;">
                    é—œé–‰
                </button>
            </div>
        </div>
    `;

        // 6. å¯«å…¥å…§å®¹
        desc.innerHTML = cardHtml;
        // å› ç‚ºæˆ‘å€‘ç”¨äº† clean-modalï¼Œæ‰€ä»¥è¦é‡ç½® desc çš„é è¨­æ¨£å¼
        desc.style.padding = "0";
        desc.style.margin = "0";
        desc.style.overflow = "visible"; // è®“æˆ‘å€‘çš„å¡ç‰‡è‡ªå·±è™•ç† overflow

        // 7. ç¶å®šé—œé–‰äº‹ä»¶ (åŒ…å«æ¸…ç†å·¥ä½œ)
        document.getElementById("trait-close-btn").onclick = function () {
          modalOverlay.style.display = "none";

          // âš ï¸ é‡è¦ï¼šå¾©åŸ Modal çš„åŸå§‹ç‹€æ…‹ï¼Œä»¥å…å½±éŸ¿å…¶ä»–äº‹ä»¶è¦–çª—
          modalBox.classList.remove("clean-modal");
          title.style.display = "block";
          desc.style.padding = ""; // æ¢å¾© CSS å®šç¾©çš„ padding
          desc.style.margin = ""; // æ¢å¾© CSS å®šç¾©çš„ margin
          desc.innerHTML = ""; // æ¸…ç©ºå…§å®¹
        };

        modalOverlay.style.display = "flex";
      }

      function finishTraitSelection() {
        if (selectedTraits.length !== 3) {
          alert("âš ï¸ è«‹é¸æ“‡ 3 å€‹ç‰¹è³ªï¼");
          return;
        }

        finishCharacterCreation();
      }
      function selectTrait(index) {
        const selectedTrait = traitChoices[index];
        selectedTraits.push(selectedTrait.id);
        currentTraitStep++;

        // å¦‚æœé‚„æ²’é¸å®Œ3å€‹ï¼Œç¹¼çºŒé¸æ“‡
        if (currentTraitStep < 3) {
          showTraitSelection();
        } else {
          // é¸å®Œäº†ï¼Œé–‹å§‹éŠæˆ²
          finishCharacterCreation();
        }
      }

      // ==========================================
      // ğŸ”´ UI æ›´æ–°
      // ==========================================

      function log(msg, changes = null) {
        const box = document.getElementById("game-log");
        if (box) {
          const timestamp = `[${Game.age}æ­²]`;
          let logHtml = `<div style="margin-bottom: 8px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px;">`;
          logHtml += `<span style="color: var(--text-dim); font-size: 0.85em;">${timestamp}</span> `;
          logHtml += `<span style="color: var(--text);">${msg}</span>`;

          if (changes && changes.length > 0) {
            logHtml +=
              '<div style="margin-top: 5px; display: flex; flex-wrap: wrap; gap: 8px;">';
            changes.forEach((change) => {
              const isPositive = change.includes("+");
              const color = isPositive ? "var(--green)" : "var(--red)";
              logHtml += `<span style="font-size: 0.8em; padding: 2px 8px; background: rgba(255,255,255,0.1); color: ${color}; border-radius: 4px;">${change}</span>`;
            });
            logHtml += "</div>";
          }
          logHtml += "</div>";

          box.innerHTML += logHtml;

          // âœ… å„ªåŒ–ï¼šåªä¿ç•™æœ€è¿‘ 50 æ¢ç´€éŒ„ï¼Œé˜²æ­¢è¨˜æ†¶é«”æº¢å‡ºè®Šæ…¢
          const logs = box.getElementsByTagName("div");
          if (logs.length > 50) {
            // å› ç‚ºä¸€å€‹ log å¯èƒ½åŒ…å«å­ divï¼Œé€™è£¡ç°¡å–®ç§»é™¤æœ€ä¸Šé¢çš„ä¸€å€‹å€å¡Š
            // æ³¨æ„ï¼šé€™è£¡ logs æ˜¯ live collectionï¼Œçµæ§‹è¼ƒè¤‡é›œï¼Œå»ºè­°ç›´æ¥æ“ä½œ innerHTML æˆ–ç”¨ array ç®¡ç†
            // ç°¡å–®å„ªåŒ–ï¼šç•¶å…§å®¹éå¤šæ™‚ï¼Œæ¸…ç©ºå‰ä¸€åŠ
            if (box.innerHTML.length > 10000) {
              box.innerHTML = box.innerHTML.substring(box.innerHTML.length / 2);
            }
          }

          box.scrollTop = box.scrollHeight;
        }
      }
      // ===== âœ… æˆå°±æŒä¹…åŒ–ç³»ç»Ÿ =====
      function saveAchievements() {
        try {
          const achievementData = {
            unlockedAchievements: Game.unlockedAchievements,
            timestamp: Date.now(),
          };
          localStorage.setItem(
            "lifeSimAchievements",
            JSON.stringify(achievementData),
          );
          console.log("âœ… æˆå°±å·²ä¿å­˜", Game.unlockedAchievements);
        } catch (e) {
          console.error("âŒ æˆå°±ä¿å­˜å¤±æ•—", e);
        }
      }

      function loadAchievements() {
        try {
          const saved = localStorage.getItem("lifeSimAchievements");
          if (saved) {
            const data = JSON.parse(saved);
            return data.unlockedAchievements || [];
          }
        } catch (e) {
          console.error("âŒ æˆå°±è®€å–å¤±æ•—", e);
        }
        return [];
      }

      function resetAchievements() {
        if (confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æˆå°±å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼")) {
          localStorage.removeItem("lifeSimAchievements");
          Game.unlockedAchievements = [];
          updateUI();
          alert("âœ… æˆå°±å·²é‡ç½®");
        }
      }
      // ===== âœ… æˆå°±å¯¼å‡º/å¯¼å…¥ï¼ˆå¤‡ä»½ç”¨ï¼‰=====
      function exportAchievements() {
        const data = localStorage.getItem("lifeSimAchievements");
        if (!data) {
          alert("âŒ æ²’æœ‰å¯å°å‡ºçš„æˆå°±æ•¸æ“š");
          return;
        }

        const blob = new Blob([data], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `æˆå°±å‚™ä»½_${new Date().toLocaleDateString()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        alert("âœ… æˆå°±å·²å°å‡º");
      }

      function importAchievements() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = JSON.parse(e.target.result);
              localStorage.setItem("lifeSimAchievements", e.target.result);
              Game.unlockedAchievements = data.unlockedAchievements || [];
              updateUI();
              alert("âœ… æˆå°±å·²å°å…¥");
            } catch (err) {
              alert("âŒ æ–‡ä»¶æ ¼å¼éŒ¯èª¤");
            }
          };
          reader.readAsText(file);
        };
        input.click();
      }

      function getAchievementStats() {
        const total = ACHIEVEMENTS.length;
        const unlocked = Game.unlockedAchievements.length;
        const percentage = Math.floor((unlocked / total) * 100);
        return { total, unlocked, percentage };
      }

      function updateUI() {
        // ===== âœ… æ–°å¢ï¼šUIæ›´æ–°èŠ‚æµ =====
        const now = Date.now();
        if (now - lastUpdateTime < UPDATE_THROTTLE) {
          return;
        }
        lastUpdateTime = now;
        // åŸºæœ¬è³‡è¨Š
        document.getElementById("player-name").textContent = Game.name;
        document.getElementById("age-display").textContent = Game.age;
        document.getElementById("player-origin").textContent = Game.origin;
        document.getElementById("player-job").textContent = JOBS.find(
          (j) => j.id === Game.jobId,
        ).name;
        document.getElementById("money-display").textContent =
          "$" + Game.money.toLocaleString();

        // æ•¸å€¼
        document.getElementById("health").textContent = Math.max(
          0,
          Math.floor(Game.health),
        );
        document.getElementById("happy").textContent = Math.max(
          0,
          Math.floor(Game.happy),
        );
        document.getElementById("intel").textContent = Math.floor(Game.intel);

        // é ­åƒ
        const stage = LIFE_STAGES.find(
          (s) => Game.age >= s.min && Game.age <= s.max,
        );
        document.getElementById("player-avatar").textContent = stage.icon;
        document.getElementById("life-stage").textContent = stage.name;

        // å¤©è³¦æ¨™ç±¤
        // å¤©è³¦é¡¯ç¤º
        let talentHtml = "";
        Game.talents.forEach((t) => {
          talentHtml += `<span class="talent-tag ${t.type === "bad" ? "talent-bad" : ""}" title="${t.desc}">${t.name}</span>`;
        });
        document.getElementById("talent-display").innerHTML = talentHtml;

        // ç‰¹è³ªé¡¯ç¤ºï¼ˆå¸¶è©³ç´°æ•ˆæœæç¤ºï¼‰
        // ===== ç‰¹è´¨æ˜¾ç¤ºï¼ˆå¸¦ç‚¹å‡»äº‹ä»¶ï¼‰=====
        let traitHtml = "";
        if (Game.traits && Game.traits.length > 0) {
          traitHtml =
            '<div style="font-size: 0.7em; color: var(--text-dim); margin-bottom: 3px;">âœ¨ ç‰¹è³ª</div>';
          Game.traits.forEach((t) => {
            let bgColor = "";
            if (t.category === "personality") {
              bgColor =
                "background: linear-gradient(135deg, #2196f3, #1976d2);";
            } else if (t.category === "ability") {
              bgColor =
                "background: linear-gradient(135deg, #9c27b0, #7b1fa2);";
            } else if (t.category === "special") {
              bgColor =
                "background: linear-gradient(135deg, #ff9800, #f57c00);";
            }

            // âœ… ä½¿ç”¨ data å±æ€§å­˜å‚¨ç‰¹è´¨ ID
            traitHtml += `
            <span class="talent-tag trait-tooltip" 
                  style="${bgColor} pointer-events: auto; cursor: pointer;" 
                  data-trait-id="${t.id}"
                  title="é»æ“ŠæŸ¥çœ‹è©³æƒ…">
                ${t.name}
            </span>
        `;
          });
        }
        document.getElementById("trait-display").innerHTML = traitHtml;

        // âœ… é‡æ–°ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆæ¯æ¬¡ updateUI éƒ½è¦é‡æ–°ç»‘å®šï¼‰
        document.querySelectorAll(".trait-tooltip").forEach((el) => {
          el.onclick = function (e) {
            e.preventDefault();
            e.stopPropagation();
            const traitId = this.getAttribute("data-trait-id");
            console.log("ç‚¹å‡»ç‰¹è´¨:", traitId); // è°ƒè¯•ç”¨
            if (traitId) {
              showTraitDetail(traitId);
            }
          };
        });

        // æŠ€èƒ½æ¢
        /// ... åœ¨ updateUI å‡½æ•¸å…§ ...

        // âœ… ç”ŸæˆæŠ€èƒ½æ¨™ç±¤
        let skillHtml = ''; 
        
        const skillNames = {
          programming: "ğŸ’» ç¨‹å¼", // åŠ é»åœ–ç¤ºæ›´ç”Ÿå‹•
          art: "ğŸ¨ è—è¡“",
          medical: "âš•ï¸ é†«ç™‚",
          cooking: "ğŸ³ çƒ¹é£ª",
          finance: "ğŸ’° ç†è²¡",
          communication: "ğŸ—£ï¸ æºé€š",
          charm: "âœ¨ é­…åŠ›",
        };

        // éæ­·æŠ€èƒ½
        Object.keys(Game.skills).forEach((key) => {
          const val = Math.floor(Game.skills[key]);
          if (val > 0) { // æ•¸å€¼ > 0 æ‰é¡¯ç¤º
            skillHtml += `
                <div class="skill-tag">
                    ${skillNames[key] || key} <span class="skill-val">${val}</span>
                </div>
            `;
          }
        });

        // è‹¥ç„¡æŠ€èƒ½
        if (skillHtml === '') {
            skillHtml = '<span style="font-size: 0.8em; color: var(--text-dim); opacity: 0.5;">( å°šæœªç¿’å¾—æŠ€èƒ½ )</span>';
        }

        document.getElementById("skills-container").innerHTML = skillHtml;
       if (!skillsCollapsed) {
          const skillNames = {
            programming: "ç¨‹å¼",
            art: "è—è¡“",
            medical: "é†«ç™‚",
            cooking: "çƒ¹é£ª",
            finance: "ç†è²¡",
            communication: "æºé€š",
            charm: "é­…åŠ›",
          };

          // âœ… ä¿®æ”¹ï¼šæ”¹æˆ Grid ä½ˆå±€ï¼Œè®“æŠ€èƒ½åƒå±¬æ€§é¢æ¿ä¸€æ¨£æ’åˆ—
          skillHtml += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">';

          Object.keys(Game.skills).forEach((key) => {
            const val = Math.floor(Game.skills[key]); // å–æ•´æ•¸ï¼Œç„¡ä¸Šé™

            // âœ… ä¿®æ”¹ï¼šç§»é™¤é€²åº¦æ¢ï¼Œæ”¹ç”¨ç²¾ç·»çš„æ•¸å€¼å¡ç‰‡æ¨£å¼
            skillHtml += `
                  <div class="skill-item" style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
                      <span style="color: var(--text-dim); font-size: 0.9em;">${skillNames[key]}</span>
                      <span style="color: var(--gold); font-weight: bold; font-size: 1.1em;">${val}</span>
                  </div>
              `;
          });
          
          skillHtml += '</div>';
        }

        document.getElementById("skills-container").innerHTML = skillHtml;

        // é«”åŠ›æ¢
        const stamina = Math.max(0, Math.min(100, Game.stamina));
        const staminaRatio = stamina / 100;
        document.getElementById("stamina-bar").style.transform =
          `scaleX(${staminaRatio})`;
        document.getElementById("stamina-text").textContent =
          `${Math.floor(stamina)}/100`;

        if (stamina < 20) {
          document.getElementById("stamina-bar").classList.add("low");
        } else {
          document.getElementById("stamina-bar").classList.remove("low");
        }

        // ç‹€æ…‹è­¦å‘Š
        let alertHtml = "";
        if (Game.money < 0) {
          alertHtml += `<div class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼å‰© ${3 - Game.debtYears} å¹´</div>`;
        }
        if (Game.happy < 20) {
          alertHtml += `<div class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹</div>`;
        }
        if (Game.health < 30) {
          alertHtml += `<div class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Š</div>`;
        }
        if (Game.age >= 18 && Game.jobId === "none") {
          alertHtml += `<div class="status-alert alert-blue">ğŸ’¼ å°šæœªå°±æ¥­</div>`;
        }
        document.getElementById("status-alerts").innerHTML = alertHtml;

        // æ›´æ–°è¡Œå‹•æŒ‰éˆ•
        updateActionButtons();
      }

     function updateActionButtons() {
        const btns = document.getElementById("action-buttons");
        let html = "";
        const age = Game.age;

        if (age <= 2) {
          html = `
            <button onclick="action('cry')">ğŸ˜­ å“­é¬§<span class="cost-tag">âš¡-10</span></button>
            <button onclick="action('sleep')">ğŸ˜´ ç¡è¦º<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_toy')">ğŸ§¸ ç©ç©å…·<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('learn_speak')">ğŸ—£ï¸ ç‰™ç‰™å­¸èª<span class="cost-tag">âš¡-25</span></button>
            <button onclick="action('crawl')">ğŸ› çˆ¬è¡Œ<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('watch_mobile')">ğŸ‘€ çœ‹å¤§äººçš„æ‰‹æ©Ÿ<span class="cost-tag">âš¡-10</span></button>
        `;
        } else if (age <= 5) {
          html = `
            <button onclick="action('kindergarten')">ğŸ« ä¸Šå¹¼å…’åœ’<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('draw')">ğŸ–ï¸ ç•«ç•«<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('watch_tv')">ğŸ“º çœ‹é›»è¦–<span class="cost-tag">âš¡-10</span></button>
            <button onclick="action('make_friend')">ğŸ‘« äº¤æœ‹å‹<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_outside')">ğŸŒ³ æˆ¶å¤–ç©è€<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('learn_music')">ğŸµ å­¸æ‰è—<span class="cost-tag">âš¡-25 / $-5000</span></button>
        `;
        } else if (age <= 12) {
          html = `
            <button onclick="action('study_hard')">ğŸ“š èªçœŸè®€æ›¸<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('cram_school')">ğŸ“– è£œç¿’ç­<span class="cost-tag">âš¡-25 / $-2000</span></button>
            <button onclick="action('sports')">âš½ é‹å‹•<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_game')">ğŸ® æ‰“é›»å‹•<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('help_parent')">ğŸ  å¹«å¿™å®¶å‹™<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('read_book')">ğŸ“• çœ‹èª²å¤–æ›¸<span class="cost-tag">âš¡-25</span></button>
        `;
        } else if (age <= 17) {
          html = `
            <button onclick="action('exam_prep')">ğŸ“ æº–å‚™è€ƒè©¦<span class="cost-tag">âš¡-35</span></button>
            <button onclick="action('club')">ğŸ­ åƒåŠ ç¤¾åœ˜<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('date_crush')">ğŸ’• å’Œå–œæ­¡çš„äººç´„æœƒ<span class="cost-tag">âš¡-25 / $-500</span></button>
            <button onclick="action('rebel')">ğŸ˜¤ å›é€†æœŸ<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('part_time')">ğŸ’¼ æ‰“å·¥<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('learn_code')">ğŸ’» è‡ªå­¸ç¨‹å¼<span class="cost-tag">âš¡-35</span></button>
        `;
        } else {
          html = `
            <button onclick="action('work')">ğŸ’¼ å·¥ä½œ<span class="cost-tag">âš¡-35</span></button>
            <button onclick="action('study_skill')">ğŸ“– å­¸ç¿’æŠ€èƒ½<span class="cost-tag">âš¡-25 / $-3000</span></button>
            <button onclick="action('socialize')">ğŸ» ç¤¾äº¤æ´»å‹•<span class="cost-tag">âš¡-20 / $-2000</span></button>
            <button onclick="action('relax')">ğŸ® ä¼‘é–’å¨›æ¨‚<span class="cost-tag">âš¡-15 / $-1000</span></button>
            <button onclick="action('invest')">ğŸ“ˆ æŠ•è³‡ç†è²¡<span class="cost-tag">âš¡-20 / $-10000</span></button>
            <button onclick="action('exercise')">ğŸ’ª å¥èº«<span class="cost-tag">âš¡-25 / $-1500</span></button>
            <button onclick="action('volunteer')">ğŸ¤ å¿—å·¥æœå‹™<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('travel')">âœˆï¸ æ—…éŠ<span class="cost-tag">âš¡-30 / $-20000</span></button>
        `;
        }

        btns.innerHTML = html;

        const allBtns = btns.querySelectorAll("button");
        allBtns.forEach((btn) => {
          if (Game.stamina < 10 || Game.happy < 5 || Game.health <= 0) {
            btn.disabled = true;
          }
        });
      }

      function getActionName(type) {
        const actionNames = {
          // å¬°å…’æœŸ
          cry: "ğŸ˜­ å“­é¬§",
          sleep: "ğŸ˜´ ç¡è¦º",
          play_toy: "ğŸ§¸ ç©ç©å…·",
          learn_speak: "ğŸ—£ï¸ ç‰™ç‰™å­¸èª",
          crawl: "ğŸ› çˆ¬è¡Œ",
          watch_mobile: "ğŸ‘€ çœ‹æ‰‹æ©Ÿ",

          // å¹¼å…’æœŸ
          kindergarten: "ğŸ« ä¸Šå¹¼å…’åœ’",
          draw: "ğŸ–ï¸ ç•«ç•«",
          watch_tv: "ğŸ“º çœ‹é›»è¦–",
          make_friend: "ğŸ‘« äº¤æœ‹å‹",
          play_outside: "ğŸŒ³ æˆ¶å¤–ç©è€",
          learn_music: "ğŸµ å­¸æ‰è—",

          // å…’ç«¥æœŸ
          study_hard: "ğŸ“š èªçœŸè®€æ›¸",
          cram_school: "ğŸ“– è£œç¿’ç­",
          sports: "âš½ é‹å‹•",
          play_game: "ğŸ® æ‰“é›»å‹•",
          help_parent: "ğŸ  å¹«å¿™å®¶å‹™",
          read_book: "ğŸ“• çœ‹èª²å¤–æ›¸",

          // é’å°‘å¹´æœŸ
          exam_prep: "ğŸ“ æº–å‚™è€ƒè©¦",
          club: "ğŸ­ åƒåŠ ç¤¾åœ˜",
          date_crush: "ğŸ’• ç´„æœƒ",
          rebel: "ğŸ˜¤ å›é€†",
          part_time: "ğŸ’¼ æ‰“å·¥",
          learn_code: "ğŸ’» è‡ªå­¸ç¨‹å¼",

          // æˆå¹´æœŸ
          work: "ğŸ’¼ å·¥ä½œ",
          study_skill: "ğŸ“– å­¸ç¿’æŠ€èƒ½",
          socialize: "ğŸ» ç¤¾äº¤",
          relax: "ğŸ® ä¼‘é–’",
          invest: "ğŸ“ˆ æŠ•è³‡",
          exercise: "ğŸ’ª å¥èº«",
          volunteer: "ğŸ¤ å¿—å·¥",
          travel: "âœˆï¸ æ—…éŠ",
        };

        return actionNames[type] || "";
      }

    // âœ… ä¿®æ­£å¾Œçš„ action å‡½æ•¸ (ç¢ºä¿ ID èˆ‡ HTML ä¸€è‡´)
      function action(type) {
        // 1. é˜²æŠ–å‹•æª¢æŸ¥
        if (isProcessing) {
            console.log("â³ è™•ç†ä¸­ï¼Œè«‹ç¨å€™...");
            return; 
        }

        // 2. é«”åŠ›æª¢æŸ¥
        if (Game.stamina <= 0) {
          alert("âŒ é«”åŠ›ä¸è¶³ï¼");
          return;
        }

        // 3. é–å®šç‹€æ…‹
        isProcessing = true;
        
        let cost = 20;
        let effects = {};
        let actionName = "";

        // 4. Switch Case (ID å¿…é ˆå®Œå…¨åŒ¹é… updateActionButtons ä¸­çš„ onclick)
        switch (type) {
          // === 0-2 æ­² ===
          case "cry":
            cost = 10;
            effects = { happy: 5 };
            actionName = "ğŸ˜­ å“­é¬§";
            break;
          case "sleep":
            cost = 20;
            effects = { health: 3, happy: 2 };
            actionName = "ğŸ˜´ ç¡è¦º";
            break;
          case "play_toy": // âœ… ä¿®æ­£ ID
            cost = 15;
            effects = { happy: 8 };
            actionName = "ğŸ§¸ ç©ç©å…·";
            break;
          case "learn_speak": // âœ… ä¿®æ­£ ID
            cost = 25;
            effects = {
              intel: 3 * Game.learnBonus,
              skills: { communication: 2 * Game.skillBonus },
            };
            actionName = "ğŸ—£ï¸ ç‰™ç‰™å­¸èª";
            break;
          case "crawl":
            cost = 15;
            effects = { health: 2, happy: 5 };
            actionName = "ğŸ› çˆ¬è¡Œ";
            break;
          case "watch_mobile": // âœ… ä¿®æ­£ ID
            cost = 10;
            effects = { happy: 8, intel: -2 };
            actionName = "ğŸ‘€ çœ‹æ‰‹æ©Ÿ";
            break;

          // === 3-5 æ­² ===
          case "kindergarten":
            cost = 20;
            effects = {
              intel: 2 * Game.learnBonus,
              skills: { communication: 3 * Game.skillBonus },
              happy: 5,
            };
            actionName = "ğŸ« ä¸Šå¹¼å…’åœ’";
            break;
          case "draw":
            cost = 15;
            effects = { skills: { art: 4 * Game.skillBonus }, happy: 5 };
            actionName = "ğŸ–ï¸ ç•«ç•«";
            break;
          case "watch_tv": // âœ… ä¿®æ­£ ID
            cost = 10;
            effects = { happy: 10, intel: -1 };
            actionName = "ğŸ“º çœ‹é›»è¦–";
            break;
          case "make_friend": // âœ… ä¿®æ­£ ID
            cost = 20;
            effects = {
              skills: { communication: 5 * Game.skillBonus },
              happy: 8,
            };
            actionName = "ğŸ‘« äº¤æœ‹å‹";
            if (Math.random() < 0.7) addFriend();
            break;
          case "play_outside": // âœ… ä¿®æ­£ ID
            cost = 20;
            effects = {
              health: 5,
              happy: 10,
              skills: { charm: 2 * Game.skillBonus },
            };
            actionName = "ğŸŒ³ æˆ¶å¤–ç©è€";
            break;
          case "learn_music": // âœ… ä¿®æ­£ ID
            if (Game.money < 5000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 25;
            effects = {
              money: -5000,
              skills: { art: 5 * Game.skillBonus },
              happy: 5,
            };
            actionName = "ğŸµ å­¸æ‰è—";
            break;

          // === 6-12 æ­² ===
          case "study_hard": // âœ… ä¿®æ­£ ID
            cost = 30;
            effects = { intel: 5 * Game.learnBonus, happy: -3 };
            actionName = "ğŸ“š èªçœŸè®€æ›¸";
            break;
          case "cram_school": // âœ… ä¿®æ­£ ID
            if (Game.money < 2000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 25;
            effects = { intel: 8 * Game.learnBonus, money: -2000, happy: -5 };
            actionName = "ğŸ“– è£œç¿’ç­";
            break;
          case "sports":
            cost = 20;
            effects = {
              health: 5,
              happy: 5,
              skills: { charm: 2 * Game.skillBonus },
            };
            actionName = "âš½ é‹å‹•";
            break;
          case "play_game": // âœ… ä¿®æ­£ ID
            cost = 15;
            effects = { happy: 12, intel: -2 };
            actionName = "ğŸ® æ‰“é›»å‹•";
            break;
          case "help_parent": // âœ… ä¿®æ­£ ID
            cost = 20;
            effects = {
              happy: 5,
              skills: { communication: 3 * Game.skillBonus },
            };
            actionName = "ğŸ  å¹«å¿™å®¶å‹™";
            break;
          case "read_book": // âœ… ä¿®æ­£ ID
            cost = 25;
            effects = {
              intel: 4 * Game.learnBonus,
              skills: { communication: 2 * Game.skillBonus },
              happy: 3,
            };
            actionName = "ğŸ“• çœ‹èª²å¤–æ›¸";
            break;

          // === 13-17 æ­² ===
          case "exam_prep": // âœ… ä¿®æ­£ ID
            cost = 35;
            effects = { intel: 10 * Game.learnBonus, happy: -8 };
            actionName = "ğŸ“ æº–å‚™è€ƒè©¦";
            break;
          case "club":
            cost = 20;
            effects = {
              skills: {
                communication: 5 * Game.skillBonus,
                charm: 3 * Game.skillBonus,
              },
              happy: 10,
            };
            actionName = "ğŸ­ åƒåŠ ç¤¾åœ˜";
            break;
          case "date_crush": // âœ… ä¿®æ­£ ID
            if (Game.money < 500) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 25;
            effects = {
              money: -500,
              happy: 15,
              skills: { charm: 5 * Game.skillBonus },
            };
            actionName = "ğŸ’• ç´„æœƒ";
            break;
          case "rebel":
            cost = 15;
            effects = { happy: 8, intel: -3 };
            actionName = "ğŸ˜¤ å›é€†æœŸ";
            break;
          case "part_time": // âœ… ä¿®æ­£ ID
            cost = 30;
            const salary = Math.floor(10000 + Math.random() * 5000);
            effects = {
              money: salary,
              happy: -5,
              skills: { communication: 3 * Game.skillBonus },
            };
            actionName = "ğŸ’¼ æ‰“å·¥";
            break;
          case "learn_code": // âœ… ä¿®æ­£ ID
            cost = 35;
            effects = {
              intel: 5 * Game.learnBonus,
              skills: { programming: 8 * Game.skillBonus },
              happy: -5,
            };
            actionName = "ğŸ’» è‡ªå­¸ç¨‹å¼";
            break;

          // === 18æ­²ä»¥ä¸Š ===
          case "work":
            cost = 35;
            const job = JOBS.find((j) => j.id === Game.jobId);
            if (job && job.salary > 0) {
              const base = Math.floor(
                (job.salary * Game.incomeBonus) / Game.workPenalty,
              );
              const fluc = Math.random() * 0.3 - 0.15;
              const finalSal = Math.floor(base * (1 + fluc));
              effects = { money: finalSal, happy: -5, health: -3 };
              Game.jobYears++;
              actionName = "ğŸ’¼ ä¸Šç­";
              if (job.effect) job.effect(Game);
            } else {
              effects = { happy: -10 };
              actionName = "ğŸ’¼ æ‰¾å·¥ä½œå¤±æ•—(ç„¡æ¥­)";
            }
            break;
          case "study_skill": // âœ… ä¿®æ­£ ID
            if (Game.money < 3000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 25;
            effects = { money: -3000, intel: 3 * Game.learnBonus, skills: {} };
            const sKey = Object.keys(Game.skills)[
              Math.floor(Math.random() * 7)
            ];
            effects.skills[sKey] = 8 * Game.learnBonus * Game.skillBonus;
            actionName = "ğŸ“– é€²ä¿®æŠ€èƒ½";
            break;
          case "socialize":
            if (Game.money < 2000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 20;
            effects = {
              money: -2000,
              happy: 10,
              skills: {
                communication: 5 * Game.skillBonus,
                charm: 3 * Game.skillBonus,
              },
            };
            actionName = "ğŸ» ç¤¾äº¤";
            if (Math.random() < 0.6) addFriend();
            break;
          case "relax":
            if (Game.money < 1000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 15;
            effects = { money: -1000, happy: 15 };
            actionName = "ğŸ® æ”¾é¬†";
            break;
          case "invest":
            if (Game.money < 10000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 20;
            const profit =
              Math.random() > 0.5
                ? Math.floor(10000 * 0.3)
                : -Math.floor(10000 * 0.2);
            effects = {
              money: profit,
              skills: { finance: 5 * Game.skillBonus },
              happy: profit > 0 ? 10 : -15,
            };
            actionName = "ğŸ“ˆ æŠ•è³‡";
            break;
          case "exercise":
            if (Game.money < 1500) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 25;
            effects = {
              money: -1500,
              health: 8,
              skills: { charm: 3 * Game.skillBonus },
              happy: 5,
            };
            actionName = "ğŸ’ª å¥èº«";
            break;
          case "volunteer":
            cost = 30;
            effects = {
              happy: 15,
              skills: {
                communication: 5 * Game.skillBonus,
                charm: 3 * Game.skillBonus,
              },
            };
            actionName = "ğŸ¤ å¿—å·¥";
            break;
          case "travel":
            if (Game.money < 20000) {
              isProcessing = false;
              return alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
            }
            cost = 30;
            effects = {
              money: -20000,
              happy: 25,
              intel: 3,
              skills: { communication: 3 * Game.skillBonus },
            };
            actionName = "âœˆï¸ æ—…éŠ";
            break;

          default:
            isProcessing = false;
            return alert("âŒ æœªçŸ¥æ“ä½œ: " + type);
        }

        // 5. é«”åŠ›å†æ¬¡æª¢æŸ¥ (ä¿éšªèµ·è¦‹)
        if (Game.stamina < cost) {
          isProcessing = false;
          return alert("âŒ é«”åŠ›ä¸è¶³ï¼");
        }

        Game.stamina -= cost;
        Game.totalActions++;

        // 6. æ‡‰ç”¨æ•¸å€¼æ•ˆæœ
        const changes = [];
        Object.keys(effects).forEach((key) => {
          if (key === "skills") {
            Object.keys(effects.skills).forEach((sk) => {
              const old = Game.skills[sk];
              Game.skills[sk] += effects.skills[sk];
              changes.push(`${sk} +${Math.floor(effects.skills[sk])}`);
            });
          } else {
            const val = effects[key];
            Game[key] += val;
            changes.push(`${key} ${val > 0 ? "+" : ""}${Math.floor(val)}`);
          }
        });

        // 7. æ›´æ–°ç•«é¢èˆ‡æ—¥èªŒ
        updateUI();
        log(actionName, changes);
        if (changes.length > 0) showChanges(changes);

        // 8. è§£é™¤é–å®š
        setTimeout(() => {
          isProcessing = false;
        }, 300);
      }
      // æ–°å¢å‡½æ•¸
      function triggerOriginEvent() {
        const originEvents = {
          // === åŸºç¤å‡ºèº« ===
          common: [
            {
              title: "ğŸ’¸ ç‰©åƒ¹ä¸Šæ¼²",
              desc: "æœ€è¿‘ç‰©åƒ¹é£›æ¼²ï¼Œå®¶è£¡çš„é–‹éŠ·è®Šå¤§äº†ã€‚",
              choices: [
                {
                  txt: "æ¸›å°‘é›¶ç”¨éŒ¢",
                  effect: (g) => {
                    g.happy -= 5;
                    return "å…±é«”æ™‚è‰±";
                  },
                },
                {
                  txt: "å¹«å¿™æ‰“å·¥",
                  effect: (g) => {
                    g.money += 1000;
                    g.stamina -= 20;
                    return "è³ºé»å°éŒ¢è£œè²¼å®¶ç”¨";
                  },
                },
              ],
            },
          ],
          rich: [
            {
              title: "ğŸ¢ å®¶æ—ä¼æ¥­å±æ©Ÿ",
              desc: "çˆ¶è¦ªå…¬å¸é­æƒ¡æ„æ”¶è³¼ï¼Œéœ€è¦ç·Šæ€¥è³‡é‡‘æ´åŠ©ã€‚",
              choices: [
                {
                  txt: "æŠ•è³‡500è¬æ•‘å…¬å¸",
                  effect: (g) => {
                    if (g.money >= 5000000) {
                      g.money -= 5000000;
                      g.money += 12000000;
                      return "æˆåŠŸæ‹¯æ•‘ï¼ç²åˆ©700è¬";
                    }
                    return "è³‡é‡‘ä¸è¶³ï¼Œçœ¼çœ‹å…¬å¸å€’é–‰";
                  },
                },
                {
                  txt: "è¢–æ‰‹æ—è§€",
                  effect: (g) => {
                    g.yearlyMoney = 0;
                    g.happy -= 20;
                    return "å®¶æ—ä¼æ¥­å€’é–‰ï¼Œå¤±å»è¢«å‹•æ”¶å…¥";
                  },
                },
              ],
            },
            {
              title: "ğŸï¸ è±ªè»Šèšæœƒ",
              desc: "å¯ŒäºŒä»£æœ‹å‹å€‘é‚€è«‹ä½ åƒåŠ è¶…è·‘èšæœƒã€‚",
              choices: [
                {
                  txt: "åƒåŠ ",
                  effect: (g) => {
                    g.money -= 50000;
                    g.skills.charm += 10;
                    return "èŠ±éŒ¢ç¤¾äº¤ï¼Œé­…åŠ›æå‡";
                  },
                },
                {
                  txt: "ä¸å»",
                  effect: (g) => {
                    g.intel += 2;
                    return "åœ¨å®¶çœ‹è²¡å ±";
                  },
                },
              ],
            },
          ],
          genius: [
            {
              title: "ğŸ”¬ åœ‹å®¶ç´šå¯¦é©—",
              desc: "åœ‹å®¶ç§‘å­¸é™¢é‚€è«‹ä½ åƒèˆ‡æ©Ÿå¯†å¯¦é©—ã€‚",
              choices: [
                {
                  txt: "åƒåŠ ",
                  effect: (g) => {
                    g.intel += 20;
                    g.money += 100000;
                    g.health -= 10;
                    return "æ™ºåŠ›å¤§å¢ï¼Œä½†èº«é«”ç–²æ†Š";
                  },
                },
                {
                  txt: "å°ˆæ³¨å€‹äººç ”ç©¶",
                  effect: (g) => {
                    g.intel += 5;
                    return "ç©©æ­¥å‰é€²";
                  },
                },
              ],
            },
          ],
          mafia: [
            {
              title: "ğŸ—¡ï¸ å¹«æ´¾é¬¥çˆ­",
              desc: "æ•µå°å¹«æ´¾æ‰¾ä¸Šé–€ä¾†å°‹ä»‡ï¼",
              choices: [
                {
                  txt: "æ­£é¢å°æ±º",
                  effect: (g) => {
                    if (Math.random() > 0.4) {
                      g.money += 2000000;
                      g.health -= 20;
                      g.skills.charm += 20;
                      return "å¤§ç²å…¨å‹ï¼æ¶åœ°ç›¤è³º200è¬";
                    } else {
                      g.health -= 50;
                      g.money -= 500000;
                      return "é‡å‚·ä½é™¢ï¼Œæå¤±æ…˜é‡";
                    }
                  },
                },
                {
                  txt: "è«‡åˆ¤å’Œè§£",
                  effect: (g) => {
                    g.money -= 300000;
                    g.skills.communication += 15;
                    return "èŠ±éŒ¢æ¶ˆç½ï¼Œç£¨ç·´å£æ‰";
                  },
                },
              ],
            },
            {
              title: "ğŸ“¦ ç¥ç§˜è²¨ç‰©",
              desc: "å”å”è®“ä½ å¹«å¿™é‹é€ä¸€æ‰¹ã€Œæµ·é®®ã€ã€‚",
              effect: (g) => {
                g.money += 100000;
                g.happy -= 5;
                return "è³ºäº†10è¬è·‘è·¯è²»ï¼Œä½†å¿ƒè£¡æ¯›æ¯›çš„";
              },
            },
          ],
          politician: [
            {
              title: "ğŸ—³ï¸ é¸èˆ‰é†œè",
              desc: "çˆ¶è¦ªçš„æ”¿æ•µæ•£å¸ƒå‡æ–°èæ”»æ“Šå®¶æ—ã€‚",
              choices: [
                {
                  txt: "å…¬é–‹æ¾„æ¸…",
                  effect: (g) => {
                    g.skills.communication += 10;
                    g.happy -= 10;
                    return "åŠªåŠ›æ¾„æ¸…ï¼Œèº«å¿ƒä¿±ç–²";
                  },
                },
                {
                  txt: "å‹•ç”¨ç¶²è»",
                  effect: (g) => {
                    g.money -= 200000;
                    g.luckBonus -= 0.1;
                    return "é›–ç„¶å£“ä¸‹æ–°èï¼Œä½†æœ‰æé™°å¾·";
                  },
                },
              ],
            },
          ],
          hacker: [
            {
              title: "ğŸ’» éŠ€è¡Œæ¼æ´",
              desc: "ä½ ç™¼ç¾äº†æŸå¤§éŠ€è¡Œçš„è³‡å®‰æ¼æ´ã€‚",
              choices: [
                {
                  txt: "é€šå ±éŠ€è¡Œ",
                  effect: (g) => {
                    g.money += 500000;
                    g.happy += 10;
                    return "ç²å¾—ç™½å¸½é§­å®¢çé‡‘50è¬";
                  },
                },
                {
                  txt: "ç›œå–è³‡é‡‘",
                  effect: (g) => {
                    if (Math.random() > 0.3) {
                      g.money += 10000000;
                      return "ç¥ä¸çŸ¥é¬¼ä¸è¦ºè½‰èµ°1000è¬ï¼";
                    } else {
                      g.money = 0;
                      g.happy -= 50;
                      return "è¢«æŠ“åŒ…ï¼è³‡ç”¢å‡çµï¼";
                    }
                  },
                },
              ],
            },
          ],
          royal: [
            {
              title: "ğŸ’ æ”¿æ²»è¯å§»",
              desc: "é„°åœ‹çš‡å®¤æå‡ºè¯å§»è«‹æ±‚ã€‚",
              choices: [
                {
                  txt: "ç‚ºäº†åœ‹å®¶æ¥å—",
                  effect: (g) => {
                    g.money += 10000000;
                    g.happy -= 30;
                    return "ç²å¾—å·¨é¡å«å¦ï¼Œä½†å¤±å»äº†è‡ªç”±";
                  },
                },
                {
                  txt: "è¿½æ±‚çœŸæ„›æ‹’çµ•",
                  effect: (g) => {
                    g.happy += 20;
                    g.yearlyMoney /= 2;
                    return "è¢«å‰Šæ¸›çš‡å®¤æ´¥è²¼ï¼Œä½†å¿ƒéˆè‡ªç”±";
                  },
                },
              ],
            },
          ],
          temple: [
            {
              title: "ğŸ‘» æ³•æœƒå§”è¨—",
              desc: "æœ‰å¯Œå•†æ’é‚ªï¼Œè«‹æ±‚èˆ‰è¾¦æ³•æœƒã€‚",
              choices: [
                {
                  txt: "è¦ªè‡ªä¸»æŒ",
                  effect: (g) => {
                    g.money += 100000;
                    g.stamina -= 30;
                    return "å¯Œå•†åº·å¾©ï¼Œæè´ˆ10è¬é¦™æ²¹éŒ¢";
                  },
                },
                {
                  txt: "æ¨è–¦å¸«çˆ¶",
                  effect: (g) => {
                    g.skills.communication += 5;
                    return "çµå€‹å–„ç·£";
                  },
                },
              ],
            },
          ],
          farmer: [
            {
              title: "ğŸŒ¾ ä¹¾æ—±å±æ©Ÿ",
              desc: "ä»Šå¹´é›¨æ°´ä¸è¶³ï¼Œè¾²ä½œç‰©é¢è‡¨æ¯æ­»ã€‚",
              choices: [
                {
                  txt: "èˆˆå»ºçŒæº‰ç³»çµ±",
                  effect: (g) => {
                    g.money -= 50000;
                    g.yearlyMoney += 500;
                    return "é›–ç„¶èŠ±éŒ¢ï¼Œä½†ä¿éšœäº†æœªä¾†æ”¶æˆ";
                  },
                },
                {
                  txt: "ç¥ˆé›¨",
                  effect: (g) => {
                    if (Math.random() > 0.5) {
                      g.yearlyMoney += 1000;
                      return "å¥‡è¹Ÿé™é›¨ï¼å¤§è±æ”¶ï¼";
                    } else {
                      g.money -= 10000;
                      return "æ²’ç”¨ï¼Œæå¤±æ…˜é‡";
                    }
                  },
                },
              ],
            },
          ],
          singleparent: [
            {
              title: "ğŸ² åª½åª½ç”Ÿç—…",
              desc: "åª½åª½éå‹ç”Ÿç—…äº†ï¼Œå®¶è£¡é “æ™‚å¤±å»ä¾é ã€‚",
              choices: [
                {
                  txt: "è«‹å‡ç…§é¡§",
                  effect: (g) => {
                    g.money -= 5000;
                    g.happy += 10;
                    return "åª½åª½åº·å¾©äº†ï¼Œæ„Ÿæƒ…æ›´æ·±åš";
                  },
                },
                {
                  txt: "åŠªåŠ›è³ºéŒ¢è«‹çœ‹è­·",
                  effect: (g) => {
                    g.money -= 20000;
                    g.happy -= 10;
                    return "ç¶“æ¿Ÿå£“åŠ›å¥½å¤§";
                  },
                },
              ],
            },
          ],
          tech: [
            {
              title: "ğŸ¤– AI è¦ºé†’",
              desc: "ä½ å¯«çš„ AI ç¨‹å¼ä¼¼ä¹ç”¢ç”Ÿäº†è‡ªæˆ‘æ„è­˜ã€‚",
              choices: [
                {
                  txt: "ç™¼å¸ƒè«–æ–‡",
                  effect: (g) => {
                    g.intel += 20;
                    g.skills.programming += 20;
                    return "éœ‡é©šå­¸è¡“ç•Œï¼";
                  },
                },
                {
                  txt: "è³£çµ¦ç§‘æŠ€å·¨é ­",
                  effect: (g) => {
                    g.money += 2000000;
                    return "ç²å¾—å°ˆåˆ©è²·æ–·è²»200è¬";
                  },
                },
              ],
            },
          ],
          star: [
            {
              title: "ğŸ“¸ ç‹—ä»”éšŠ",
              desc: "ä½ å’Œæœ‹å‹åƒé£¯è¢«ç‹—ä»”éšŠå·æ‹äº‚å¯«ã€‚",
              choices: [
                {
                  txt: "ç™¼æ–‡åæ“Š",
                  effect: (g) => {
                    g.skills.charm -= 5;
                    return "å¼•ç™¼ç¶²æˆ°ï¼Œå½¢è±¡å—æ";
                  },
                },
                {
                  txt: "å†·è™•ç†",
                  effect: (g) => {
                    g.happy -= 5;
                    return "å¿ä¸€æ™‚é¢¨å¹³æµªéœ";
                  },
                },
              ],
            },
          ],
          monk: [
            {
              title: "ğŸ§˜ é–‰é—œä¿®è¡Œ",
              desc: "å¸«çˆ¶å•ä½ è¦ä¸è¦é€²è¡Œä¸ƒæ—¥æ–·é£Ÿé–‰é—œã€‚",
              choices: [
                {
                  txt: "åƒåŠ ",
                  effect: (g) => {
                    g.health += 20;
                    g.intel += 10;
                    g.happy += 20;
                    return "èº«å¿ƒéˆæ·¨åŒ–ï¼Œå¢ƒç•Œæå‡";
                  },
                },
                {
                  txt: "å©‰æ‹’",
                  effect: (g) => {
                    return "é‚„æ˜¯æ­£å¸¸ä½œæ¯å°±å¥½";
                  },
                },
              ],
            },
          ],
          spy: [
            {
              title: "ğŸ•µï¸ é›™é¢é–“è«œ",
              desc: "æ•µåœ‹æƒ…å ±å“¡è©¦åœ–å¸æ”¶ä½ ã€‚",
              choices: [
                {
                  txt: "å‡æ„æŠ•èª ",
                  effect: (g) => {
                    g.money += 1000000;
                    g.health -= 20;
                    return "ç²å¾—æ•µæ–¹ç¶“è²»100è¬ï¼Œä½†æ¯å¤©æå¿ƒåŠè†½";
                  },
                },
                {
                  txt: "èˆ‰å ±",
                  effect: (g) => {
                    g.money += 200000;
                    return "ç²å¾—åœ‹å®¶çé‡‘20è¬";
                  },
                },
              ],
            },
          ],
        };

        // é è¨­äº‹ä»¶ (é¿å…è©²å‡ºèº«æ²’æœ‰äº‹ä»¶æ™‚å ±éŒ¯)
        const defaultEvents = [
          {
            title: "ğŸŒŸ å‘½é‹çš„è½‰æŠ˜",
            desc: "ä½ æ„Ÿè¦ºä»Šå¤©æœƒæœ‰å¥½äº‹ç™¼ç”Ÿã€‚",
            effect: (g) => {
              g.happy += 5;
              return "å¿ƒæƒ…ä¸éŒ¯";
            },
          },
        ];

        const originId = Game.originId;
        const events = originEvents[originId] || defaultEvents;

        // 20% æ©Ÿç‡è§¸ç™¼å‡ºèº«äº‹ä»¶
        if (Math.random() < 0.2) {
          const event = events[Math.floor(Math.random() * events.length)];

          if (event.choices) {
            showOriginEventModal(event);
          } else if (event.effect) {
            const result = event.effect(Game);
            log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}ï¼š${result}`);
            Game.totalEvents++;
          }
        }
      }

      function showOriginEventModal(event) {
        document.getElementById("ev-title").textContent =
          `ã€${Game.origin}ã€‘${event.title}`;
        document.getElementById("ev-desc").textContent = event.desc;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        btnA.textContent = event.choices[0].txt;
        btnB.textContent = event.choices[1].txt;

        btnA.onclick = () => {
          const result = event.choices[0].effect(Game);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[0].txt} â†’ ${result}`);
          closeModal();
          updateUI();
        };

        btnB.onclick = () => {
          const result = event.choices[1].effect(Game);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[1].txt} â†’ ${result}`);
          closeModal();
          updateUI();
        };

        document.getElementById("event-modal").style.display = "flex";
      }
      // âœ… è£œé½Šï¼šé€šç”¨çš„äº‹ä»¶å½ˆçª—å‡½æ•¸
      function showEventModal(event) {
        const modal = document.getElementById("event-modal");
        document.getElementById("ev-title").textContent = event.title;
        document.getElementById("ev-desc").textContent = event.desc;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        // è¨­å®šé¸é … A
        if (event.choices && event.choices[0]) {
          btnA.textContent = event.choices[0].text || event.choices[0].txt;
          btnA.style.display = "block";
          btnA.onclick = () => {
            const result = event.choices[0].effect(Game);
            log(
              `ğŸ‘‰ é¸æ“‡ï¼š${event.choices[0].text || event.choices[0].txt} â†’ ${result}`,
            );
            closeModal();
            updateUI();
          };
        } else {
          btnA.style.display = "none";
        }

        // è¨­å®šé¸é … B
        if (event.choices && event.choices[1]) {
          btnB.textContent = event.choices[1].text || event.choices[1].txt;
          btnB.style.display = "block";
          btnB.onclick = () => {
            const result = event.choices[1].effect(Game);
            log(
              `ğŸ‘‰ é¸æ“‡ï¼š${event.choices[1].text || event.choices[1].txt} â†’ ${result}`,
            );
            closeModal();
            updateUI();
          };
        } else {
          btnB.style.display = "none";
        }

        modal.style.display = "flex";
      }
      // ==========================================
      // ğŸ”´ éš¨æ©Ÿäº‹ä»¶ç³»çµ±
      // ==========================================

      function triggerRandomEvent() {
        const RANDOM_EVENTS = [
          // === ğŸ’° é‡‘éŒ¢äº‹ä»¶ ===
          {
            title: "ğŸ’° è·¯ä¸Šæ’¿åˆ°éŒ¢",
            desc: "èµ°è·¯æ™‚åœ¨åœ°ä¸Šç™¼ç¾ä¸€å€‹éŒ¢åŒ…",
            choices: [
              {
                text: "é€äº¤è­¦å¯Ÿå±€",
                effect: (g) => {
                  g.happy += 10;
                  return "åšäº†å¥½äº‹å¿ƒæƒ…å¾ˆå¥½";
                },
              },
              {
                text: "æ‹¿èµ°ç¾é‡‘",
                effect: (g) => {
                  const money = Math.floor(Math.random() * 50000) + 10000;
                  g.money += money;
                  g.happy -= 5;
                  return `æ‹¿åˆ° $${money.toLocaleString()}ï¼Œä½†æœ‰é»å¿ƒè™›`;
                },
              },
            ],
          },
          {
            title: "ğŸ° æœ‹å‹é‚€ä½ æŠ•è³‡",
            desc: "æœ‹å‹èªªæœ‰å€‹ç©©è³ºä¸è³ çš„æŠ•è³‡æ©Ÿæœƒ",
            choices: [
              {
                text: "æŠ•è³‡ $50,000",
                effect: (g) => {
                  if (g.money < 50000) return "éŒ¢ä¸å¤ ";
                  g.money -= 50000;
                  if (Math.random() > 0.5) {
                    g.money += 100000;
                    return "ğŸ‰ è³ºäº† $50,000ï¼";
                  } else {
                    return "ğŸ˜¢ è¡€æœ¬ç„¡æ­¸...";
                  }
                },
              },
              {
                text: "æ‹’çµ•",
                effect: (g) => {
                  return "ä¿ä½äº†éŒ¢åŒ…";
                },
              },
            ],
          },
          {
            title: "ğŸ† ä¸­çäº†",
            desc: "ç™¼ç¥¨å°ä¸­çè™Ÿ",
            effect: (g) => {
              const prizes = [200, 1000, 10000, 200000, 10000000];
              const prize = prizes[Math.floor(Math.random() * prizes.length)];
              g.money += prize;
              g.happy += 20;
              return `ä¸­äº† $${prize.toLocaleString()}ï¼`;
            },
          },

          // === â¤ï¸ å¥åº·äº‹ä»¶ ===
          {
            title: "ğŸ¤’ æ„Ÿå†’äº†",
            desc: "èº«é«”ä¸èˆ’æœ",
            effect: (g) => {
              g.health -= 10;
              g.money -= 1000;
              return "çœ‹é†«ç”ŸèŠ±äº† $1,000";
            },
          },
          {
            title: "ğŸƒ åƒåŠ è·¯è·‘",
            desc: "æœ‹å‹é‚€ä½ åƒåŠ é¦¬æ‹‰æ¾",
            choices: [
              {
                text: "åƒåŠ ",
                effect: (g) => {
                  g.health += 15;
                  g.happy += 10;
                  g.stamina -= 30;
                  return "å®Œæˆæ¯”è³½ï¼èº«é«”æ›´å¥åº·äº†";
                },
              },
              {
                text: "æ‹’çµ•",
                effect: (g) => {
                  return "å¾…åœ¨å®¶è£¡ä¼‘æ¯";
                },
              },
            ],
          },
          {
            title: "ğŸ’Š ç™¼ç¾ä¿å¥é£Ÿå“",
            desc: "è—¥å±€æ¨è–¦ä¿å¥é£Ÿå“",
            choices: [
              {
                text: "è³¼è²· ($5,000)",
                effect: (g) => {
                  g.money -= 5000;
                  g.health += 10;
                  g.healthDecay *= 0.9;
                  return "é•·æœŸæœç”¨æ”¹å–„äº†å¥åº·";
                },
              },
              {
                text: "ä¸è²·",
                effect: (g) => {
                  return "çœä¸‹ä¸€ç­†éŒ¢";
                },
              },
            ],
          },

          // === ğŸ˜Š å¿«æ¨‚äº‹ä»¶ ===
          {
            title: "ğŸ® æ–°éŠæˆ²ç™¼å”®",
            desc: "æœŸå¾…å·²ä¹…çš„éŠæˆ²çµ‚æ–¼ä¸Šå¸‚äº†",
            choices: [
              {
                text: "è³¼è²· ($2,000)",
                effect: (g) => {
                  g.money -= 2000;
                  g.happy += 25;
                  return "ç©å¾—è¶…é–‹å¿ƒï¼";
                },
              },
              {
                text: "å¿ä½ä¸è²·",
                effect: (g) => {
                  g.happy -= 10;
                  return "å¥½æƒ³ç©...";
                },
              },
            ],
          },
          {
            title: "ğŸ¬ æœ‹å‹ç´„çœ‹é›»å½±",
            desc: "æœ‹å‹é‚€ä½ å»çœ‹æœ€æ–°é›»å½±",
            choices: [
              {
                text: "ä¸€èµ·å» ($500)",
                effect: (g) => {
                  g.money -= 500;
                  g.happy += 15;
                  g.skills.communication += 2;
                  return "åº¦éæ„‰å¿«çš„æ™‚å…‰";
                },
              },
              {
                text: "å©‰æ‹’",
                effect: (g) => {
                  return "åœ¨å®¶ä¼‘æ¯";
                },
              },
            ],
          },
          {
            title: "ğŸ‰ ç”Ÿæ—¥æ´¾å°",
            desc: "ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥",
            effect: (g) => {
              const gifts = Math.floor(Math.random() * 20000) + 5000;
              g.money += gifts;
              g.happy += 30;
              return `æ”¶åˆ° $${gifts.toLocaleString()} çš„ç´…åŒ…ï¼`;
            },
          },

          // === ğŸ§  å­¸ç¿’äº‹ä»¶ ===
          {
            title: "ğŸ“š ç™¼ç¾å¥½æ›¸",
            desc: "åœ¨æ›¸åº—ç™¼ç¾ä¸€æœ¬å¥½æ›¸",
            choices: [
              {
                text: "è³¼è²· ($800)",
                effect: (g) => {
                  g.money -= 800;
                  g.intel += 5;
                  g.happy += 10;
                  return "ç²å¾—äº†æ–°çŸ¥è­˜";
                },
              },
              {
                text: "ä¸è²·",
                effect: (g) => {
                  return "æ”¹å¤©å†èªª";
                },
              },
            ],
          },
          {
            title: "ğŸ’» ç·šä¸Šèª²ç¨‹å„ªæƒ ",
            desc: "çœ‹åˆ°æœ‰èˆˆè¶£çš„ç·šä¸Šèª²ç¨‹æ‰“æŠ˜",
            choices: [
              {
                text: "è³¼è²· ($3,000)",
                effect: (g) => {
                  g.money -= 3000;
                  g.intel += 8;
                  const skills = [
                    "programming",
                    "art",
                    "finance",
                    "communication",
                  ];
                  const skill =
                    skills[Math.floor(Math.random() * skills.length)];
                  g.skills[skill] += 15;
                  return `å­¸åˆ°æ–°æŠ€èƒ½ï¼`;
                },
              },
              {
                text: "æ”¾æ£„",
                effect: (g) => {
                  return "çœä¸‹éŒ¢";
                },
              },
            ],
          },

          // === ğŸ‘¥ ç¤¾äº¤äº‹ä»¶ ===
          {
            title: "ğŸ­ ç¤¾äº¤èšæœƒ",
            desc: "è¢«é‚€è«‹åƒåŠ èšæœƒ",
            choices: [
              {
                text: "åƒåŠ  ($1,500)",
                effect: (g) => {
                  g.money -= 1500;
                  g.happy += 15;
                  g.skills.charm += 5;
                  g.skills.communication += 5;
                  if (Math.random() > 0.6) {
                    addFriend();
                    return "èªè­˜äº†æ–°æœ‹å‹ï¼";
                  }
                  return "åº¦éæ„‰å¿«çš„å¤œæ™š";
                },
              },
              {
                text: "ä¸å»",
                effect: (g) => {
                  return "å®…åœ¨å®¶è£¡";
                },
              },
            ],
          },
          {
            title: "ğŸ’¼ äººè„ˆä»‹ç´¹",
            desc: "æœ‹å‹ä»‹ç´¹é‡è¦äººå£«çµ¦ä½ èªè­˜",
            effect: (g) => {
              g.skills.communication += 10;
              g.skills.charm += 5;
              addFriend();
              return "å»ºç«‹äº†æœ‰ç”¨çš„äººè„ˆ";
            },
          },

          // === âš ï¸ å±æ©Ÿäº‹ä»¶ ===
          {
            title: "ğŸš— è»Šç¦",
            desc: "ä¸å°å¿ƒç™¼ç”Ÿè»Šç¦",
            effect: (g) => {
              g.health -= 20;
              g.money -= 30000;
              g.happy -= 15;
              return "å—å‚·ä½é™¢ï¼ŒèŠ±äº† $30,000";
            },
          },
          {
            title: "ğŸ“± æ‰‹æ©Ÿå£äº†",
            desc: "æ‰‹æ©Ÿæ‘”å£äº†",
            choices: [
              {
                text: "è²·æ–°çš„ ($20,000)",
                effect: (g) => {
                  g.money -= 20000;
                  g.happy += 5;
                  return "æ›äº†æ–°æ‰‹æ©Ÿ";
                },
              },
              {
                text: "ä¿®ç† ($3,000)",
                effect: (g) => {
                  g.money -= 3000;
                  return "ä¿®å¥½äº†";
                },
              },
              {
                text: "æ¹Šåˆè‘—ç”¨",
                effect: (g) => {
                  g.happy -= 10;
                  return "ç”¨å¾—å¾ˆä¸æ–¹ä¾¿...";
                },
              },
            ],
          },
          {
            title: "ğŸ  æˆ¿æ±æ¼²ç§Ÿ",
            desc: "æˆ¿æ±èªªè¦æ¼²æˆ¿ç§Ÿ",
            choices: [
              {
                text: "æ¥å—",
                effect: (g) => {
                  g.yearlyMoney -= 12000;
                  return "æ¯æœˆå¤šä»˜ $1,000";
                },
              },
              {
                text: "æ¬å®¶",
                effect: (g) => {
                  g.money -= 10000;
                  g.stamina -= 20;
                  return "æ¬å®¶èŠ±äº† $10,000";
                },
              },
            ],
          },

          // === ğŸ é©šå–œäº‹ä»¶ ===
          {
            title: "ğŸ° åˆ®åˆ®æ¨‚",
            desc: "è·¯éè²·äº†åˆ®åˆ®æ¨‚",
            effect: (g) => {
              g.money -= 100;
              if (Math.random() > 0.8) {
                const prize = Math.floor(Math.random() * 100000) + 1000;
                g.money += prize;
                g.happy += 30;
                return `ä¸­äº† $${prize.toLocaleString()}ï¼`;
              }
              return "æ²’ä¸­ç";
            },
          },
          {
            title: "ğŸ“¦ ç¶²è³¼é©šå–œ",
            desc: "æ”¶åˆ°æ„å¤–çš„åŒ…è£¹",
            effect: (g) => {
              g.happy += 20;
              return "åŸä¾†æ˜¯ä¹‹å‰è²·çš„æ±è¥¿åˆ°äº†ï¼";
            },
          },
          {
            title: "â˜€ï¸ å¥½å¤©æ°£",
            desc: "ä»Šå¤©å¤©æ°£ç‰¹åˆ¥å¥½",
            effect: (g) => {
              g.happy += 10;
              g.health += 5;
              return "å¿ƒæƒ…æ„‰å¿«ï¼";
            },
          },

          // === ğŸ’¼ å·¥ä½œäº‹ä»¶ ===
          {
            title: "ğŸ’° å¹´çµ‚çé‡‘",
            desc: "å…¬å¸ç™¼å¹´çµ‚çé‡‘",
            effect: (g) => {
              if (g.jobId === "none") return "ä½ æ²’æœ‰å·¥ä½œ";
              const bonus = Math.floor(Math.random() * 100000) + 50000;
              g.money += bonus;
              g.happy += 25;
              return `é ˜åˆ° $${bonus.toLocaleString()} å¹´çµ‚ï¼`;
            },
          },
          {
            title: "ğŸ“ˆ å‡è·æ©Ÿæœƒ",
            desc: "è€é—†æå‡ºå‡è·",
            effect: (g) => {
              if (g.jobId === "none") return "ä½ æ²’æœ‰å·¥ä½œ";
              g.incomeBonus *= 1.2;
              g.happy += 20;
              return "è–ªæ°´å¢åŠ  20%ï¼";
            },
          },
          {
            title: "ğŸ˜° å·¥ä½œå£“åŠ›",
            desc: "æœ€è¿‘å·¥ä½œå£“åŠ›å¾ˆå¤§",
            choices: [
              {
                text: "å’¬ç‰™æ’é",
                effect: (g) => {
                  g.health -= 15;
                  g.happy -= 20;
                  g.money += 30000;
                  return "è³ºäº†åŠ ç­è²»ä½†å¾ˆç´¯";
                },
              },
              {
                text: "è«‹å‡ä¼‘æ¯",
                effect: (g) => {
                  g.money -= 10000;
                  g.health += 10;
                  g.happy += 15;
                  return "èº«å¿ƒç²å¾—ä¼‘æ¯";
                },
              },
            ],
          },
          {
            title: "ğŸ¯ æŠ•è³‡æ©Ÿæœƒ",
            desc: "æœ‰äººå‘ä½ æ¨è–¦æŠ•è³‡é …ç›®",
            condition: () => Game.traits.some((t) => t.id === "businessmind"),
            effect: (g) => {
              if (g.money < 100000) return "è³‡é‡‘ä¸è¶³";
              g.money -= 100000;
              const success = Math.random() > 0.3; // å•†æ¥­é ­è…¦æé«˜æˆåŠŸç‡åˆ°70%
              if (success) {
                g.money += 250000;
                if (!g.successfulInvestments) g.successfulInvestments = 0;
                g.successfulInvestments++;
                return "ğŸ’° å•†æ¥­é ­è…¦è®“ä½ è³ºäº† $150,000ï¼";
              } else {
                return "ğŸ˜¢ æŠ•è³‡å¤±æ•—ï¼Œæå¤± $100,000";
              }
            },
          },

          // ç‰¹è³ªäº‹ä»¶2ï¼šè—è¡“æ¯”è³½ï¼ˆéœ€è¦è—è¡“å¤©è³¦ï¼‰
          {
            title: "ğŸ¨ è—è¡“æ¯”è³½",
            desc: "çœ‹åˆ°è—è¡“æ¯”è³½çš„æµ·å ±",
            condition: () => Game.traits.some((t) => t.id === "artistic"),
            choices: [
              {
                text: "åƒåŠ æ¯”è³½",
                effect: (g) => {
                  g.stamina -= 30;
                  const prize = Math.floor(Math.random() * 50000) + 20000;
                  g.money += prize;
                  g.happy += 20;
                  g.skills.art += 10;
                  return `ğŸ† è—è¡“å¤©è³¦è®“ä½ å¾—çï¼ç²å¾— $${prize.toLocaleString()}`;
                },
              },
              {
                text: "ä¸åƒåŠ ",
                effect: (g) => {
                  return "ä¸‹æ¬¡å†èªª";
                },
              },
            ],
          },

          // ç‰¹è³ªäº‹ä»¶3ï¼šé§­å®¢é¦¬æ‹‰æ¾ï¼ˆéœ€è¦ç§‘æŠ€é”äººï¼‰
          {
            title: "ğŸ’» é§­å®¢é¦¬æ‹‰æ¾",
            desc: "ç§‘æŠ€å…¬å¸èˆ‰è¾¦é§­å®¢æ¾",
            condition: () => Game.traits.some((t) => t.id === "techsavvy"),
            choices: [
              {
                text: "åƒåŠ ",
                effect: (g) => {
                  g.stamina -= 40;
                  g.skills.programming += 15;
                  if (Math.random() > 0.5) {
                    g.money += 100000;
                    return "ğŸ† ç§‘æŠ€é”äººè´å¾—é¦–ç $100,000ï¼";
                  } else {
                    g.money += 30000;
                    return "ğŸ‰ ç²å¾—åƒåŠ ç $30,000";
                  }
                },
              },
              {
                text: "ä¸åƒåŠ ",
                effect: (g) => {
                  return "å¤ªç´¯äº†";
                },
              },
            ],
          },

          // ç‰¹è³ªäº‹ä»¶4ï¼šæ„å¤–å¥½é‹ï¼ˆéœ€è¦å¹¸é‹ç‰¹è³ªï¼‰
          {
            title: "ğŸ² æ„å¤–å¥½é‹",
            desc: "ä»Šå¤©é‹æ°£ç‰¹åˆ¥å¥½",
            condition: () => Game.traits.some((t) => t.id === "lucky"),
            effect: (g) => {
              const bonus = Math.floor(Math.random() * 100000) + 50000;
              g.money += bonus;
              g.happy += 15;
              if (!g.luckyEventCount) g.luckyEventCount = 0;
              g.luckyEventCount++;
              return `ğŸ€ å¹¸é‹ç‰¹è³ªç™¼å‹•ï¼æ„å¤–ä¹‹è²¡ $${bonus.toLocaleString()}`;
            },
          },

          // ç‰¹è³ªäº‹ä»¶5ï¼šå£“åŠ›äº‹ä»¶ï¼ˆç‰¹è³ªå½±éŸ¿åæ‡‰ï¼‰
          {
            title: "ğŸ˜° å£“åŠ›äº‹ä»¶",
            desc: "é‡åˆ°è®“äººç„¦æ…®çš„äº‹",
            effect: (g) => {
              if (g.traits.some((t) => t.id === "optimistic")) {
                g.happy -= 5;
                return "ğŸŒŸ æ¨‚è§€ç‰¹è³ªè®“ä½ å¾ˆå¿«æ¢å¾©å¿ƒæƒ…";
              } else if (g.traits.some((t) => t.id === "pessimistic")) {
                g.happy -= 25;
                g.health -= 10;
                if (!g.negativeEvents) g.negativeEvents = 0;
                g.negativeEvents++;
                return "ğŸ˜° é™·å…¥æ·±æ·±çš„ç„¦æ…®...";
              } else {
                g.happy -= 15;
                return "å¿ƒæƒ…æœ‰é»ä½è½";
              }
            },
          },

          // ç‰¹è³ªäº‹ä»¶6ï¼šé«”è‚²æŒ‘æˆ°ï¼ˆéœ€è¦å¼·å¥é«”é­„ï¼‰
          {
            title: "ğŸƒ é«”è‚²æŒ‘æˆ°",
            desc: "æœ‹å‹ç´„ä½ åƒåŠ ä¸‰éµæ¯”è³½",
            condition: () => Game.traits.some((t) => t.id === "athletic"),
            choices: [
              {
                text: "åƒåŠ ",
                effect: (g) => {
                  g.health += 20;
                  g.stamina -= 50;
                  g.money += 50000;
                  return "ğŸ… å¼·å¥é«”é­„è®“ä½ è¼•é¬†å®Œè³½ä¸¦ç²çï¼";
                },
              },
              {
                text: "ä¸åƒåŠ ",
                effect: (g) => {
                  return "æ”¹å¤©å§";
                },
              },
            ],
          },

          // ç‰¹è³ªäº‹ä»¶7ï¼šæ¼”è¬›é‚€è«‹ï¼ˆéœ€è¦é­…åŠ›æˆ–å¤–å‘ï¼‰
          {
            title: "ğŸ¤ æ¼”è¬›é‚€è«‹",
            desc: "å—é‚€åˆ°å¤§å­¸æ¼”è¬›",
            condition: () =>
              Game.traits.some((t) => t.id === "charismatic") ||
              Game.traits.some((t) => t.id === "extrovert"),
            choices: [
              {
                text: "æ¥å—é‚€è«‹",
                effect: (g) => {
                  g.money += 30000;
                  g.skills.communication += 10;
                  g.skills.charm += 8;
                  g.happy += 15;
                  return "âœ¨ é­…åŠ›ç‰¹è³ªè®“ä½ çš„æ¼”è¬›å¤§å—æ­¡è¿ï¼";
                },
              },
              {
                text: "å©‰æ‹’",
                effect: (g) => {
                  return "å¤ªç·Šå¼µäº†";
                },
              },
            ],
          },

          // ç‰¹è³ªäº‹ä»¶8ï¼šå­¸è¡“ç ”è¨æœƒï¼ˆéœ€è¦å¤©æ‰é ­è…¦+åšå£«å­¸æ­·ï¼‰
          {
            title: "ğŸ“š å­¸è¡“ç ”è¨æœƒ",
            desc: "å—é‚€åƒåŠ åœ‹éš›ç ”è¨æœƒ",
            condition: () =>
              Game.traits.some((t) => t.id === "geniusmind") &&
              Game.education === "phd",
            effect: (g) => {
              g.intel += 15;
              g.skills.communication += 10;
              g.money += 50000;
              g.happy += 20;
              return "ğŸ“ å¤©æ‰é ­è…¦è®“ä½ åœ¨å­¸è¡“ç•Œå¤§æ”¾ç•°å½©ï¼";
            },
          },

          // ç‰¹è³ªäº‹ä»¶9ï¼šå‰µæ¥­æ©Ÿæœƒï¼ˆéœ€è¦å‹‡æ•¢ç‰¹è³ªï¼‰
          {
            title: "ğŸ’¡ å‰µæ¥­æ©Ÿæœƒ",
            desc: "æœ‹å‹é‚€ä½ ä¸€èµ·å‰µæ¥­",
            condition: () => Game.traits.some((t) => t.id === "brave"),
            choices: [
              {
                text: "æŠ•è³‡ $500,000",
                effect: (g) => {
                  if (g.money < 500000) return "è³‡é‡‘ä¸è¶³";
                  g.money -= 500000;
                  const success = Math.random() > 0.4;
                  if (success) {
                    g.money += 2000000;
                    return "ğŸš€ å‹‡æ•¢çš„æ±ºç­–è®“ä½ è³ºäº† $1,500,000ï¼";
                  } else {
                    return "ğŸ˜¢ å‰µæ¥­å¤±æ•—...";
                  }
                },
              },
              {
                text: "æ‹’çµ•",
                effect: (g) => {
                  return "å¤ªå†’éšªäº†";
                },
              },
            ],
          },

          // ç‰¹è³ªäº‹ä»¶10ï¼šå­¤ç¨æ„Ÿï¼ˆå…§å‘è€…å½±éŸ¿è¼ƒå°ï¼‰
          {
            title: "ğŸ˜” å­¤ç¨æ„Ÿ",
            desc: "æ„Ÿè¦ºæœ‰é»å­¤å–®",
            effect: (g) => {
              if (g.traits.some((t) => t.id === "introvert")) {
                g.happy -= 3;
                return "ğŸ¤« å…§å‘çš„ä½ äº«å—ç¨è™•æ™‚å…‰";
              } else if (g.traits.some((t) => t.id === "extrovert")) {
                g.happy -= 15;
                return "ğŸ˜¢ å¤–å‘çš„ä½ å¾ˆéœ€è¦ç¤¾äº¤...";
              } else {
                g.happy -= 8;
                return "æœ‰é»å¯‚å¯";
              }
            },
          },
        ];

        // ===== âœ… éæ¿¾ç¬¦åˆæ¢ä»¶çš„äº‹ä»¶ï¼ˆå«ç‰¹è³ªæª¢æŸ¥ï¼‰=====
        const availableEvents = RANDOM_EVENTS.filter((event) => {
          if (event.condition) {
            return event.condition();
          }
          return true; // æ²’æœ‰æ¢ä»¶çš„äº‹ä»¶ç¸½æ˜¯å¯ç”¨
        });

        if (availableEvents.length === 0) return;

        // éš¨æ©Ÿé¸æ“‡äº‹ä»¶
        const event =
          RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];

        if (event.choices) {
          showEventModal(event);
        } else if (event.effect) {
          const result = event.effect(Game);
          log(`${event.title}ï¼š${event.desc} - ${result}`);
        }

        Game.totalEvents++;
        updateUI();
      }

      function showEnding() {
        let endingType = "å¹³å‡¡äººç”Ÿ";
        let endingIcon = "ğŸƒ";
        let endingDesc = "ä½ éå®Œäº†å¹³å‡¡è€ŒçœŸå¯¦çš„ä¸€ç”Ÿï¼Œé€™å°±æ˜¯äººç”Ÿã€‚";

        // å„ªå…ˆæª¢æŸ¥å‡ºèº«å°ˆå±¬çµå±€
        let specialEnding = false;

        switch (Game.originId) {
          case "royal":
            if (Game.money >= 100000000 && Game.happy > 80) {
              endingType = "ğŸ‘‘ å‚³å¥‡å›ç‹";
              endingIcon = "ğŸ°";
              endingDesc =
                "ä½ ä¸åƒ…å»¶çºŒäº†çš‡å®¤çš„æ¦®è€€ï¼Œæ›´ç”¨è²¡å¯Œèˆ‡ä»æ…ˆæ²»ç†åœ‹å®¶ï¼Œæˆç‚ºå²æ›¸ä¸Šçš„ä¸€ä»£æ˜å›ï¼";
              specialEnding = true;
            }
            break;
          case "mafia":
            if (Game.money >= 50000000 && Game.skills.charm > 100) {
              endingType = "ğŸ•¶ï¸ åœ°ä¸‹æ•™çˆ¶";
              endingIcon = "ğŸ¥ƒ";
              endingDesc =
                "ä½ çµ±ä¸€äº†æ‰€æœ‰å¹«æ´¾ï¼Œåˆ¶å®šäº†åœ°ä¸‹ç¤¾æœƒçš„ç§©åºã€‚ä½ çš„åå­—æˆç‚ºäº†å‚³èªªï¼Œç„¡äººæ•¢ç›´å‘¼ã€‚";
              specialEnding = true;
            }
            break;
          case "hacker":
            if (Game.skills.programming >= 150) {
              endingType = "ğŸ’» ç¶²è·¯ä¹‹ç¥";
              endingIcon = "ğŸŒ";
              endingDesc =
                "åœ¨ç¶²è·¯ä¸–ç•Œè£¡ï¼Œä½ å°±æ˜¯ç¥ã€‚ä½ å¯ä»¥éš¨æ„é€²å‡ºä»»ä½•ç³»çµ±ï¼Œæ•´å€‹æ•¸ä½ä¸–ç•Œéƒ½åœ¨ä½ çš„æŒæ§ä¹‹ä¸­ã€‚";
              specialEnding = true;
            }
            break;
          case "monk":
            if (Game.happy >= 95 && Game.age >= 80) {
              endingType = "ğŸ§˜ ä¸€ä»£é«˜åƒ§";
              endingIcon = "ğŸ“¿";
              endingDesc =
                "ä½ åƒé€äº†ç”Ÿå‘½çš„çœŸè«¦ï¼Œç„¡æ¬²ç„¡æ±‚ï¼Œåœ“å¯‚ä¹‹æ™‚å¤©é™ç•°è±¡ï¼Œå—è¬äººæ•¬ä»°ã€‚";
              specialEnding = true;
            }
            break;
          case "star":
            if (Game.skills.charm >= 150) {
              endingType = "ğŸŒŸ åœ‹éš›å·¨æ˜Ÿ";
              endingIcon = "ğŸ’ƒ";
              endingDesc =
                "ä½ çš„å…‰èŠ’è¶…è¶Šäº†çˆ¶æ¯ï¼Œæˆç‚ºäº†å…¨çƒçŸ¥åçš„è¶…ç´šå·¨æ˜Ÿï¼Œåç•™é’å²ã€‚";
              specialEnding = true;
            }
            break;
          case "politician":
            if (Game.skills.communication >= 150) {
              endingType = "ğŸ›ï¸ åœ‹å®¶é ˜è¢–";
              endingIcon = "ğŸ™ï¸";
              endingDesc =
                "ä½ æ†‘è—‰è‘—è¶…å‡¡çš„å£æ‰èˆ‡æ”¿æ²»æ‰‹è…•ï¼Œç™»ä¸Šäº†æ¬ŠåŠ›çš„é ‚å³°ï¼Œå¼•é ˜åœ‹å®¶èµ°å‘ç¹æ¦®ã€‚";
              specialEnding = true;
            }
            break;
          case "scientistfamily":
          case "genius":
            if (Game.intel >= 180) {
              endingType = "ğŸš€ äººé¡å…ˆé©…";
              endingIcon = "ğŸŒŒ";
              endingDesc =
                "ä½ çš„ç ”ç©¶æ”¹è®Šäº†äººé¡çš„æ­·å²ï¼Œè§£é–‹äº†å®‡å®™çš„çµ‚æ¥µå¥§ç§˜ï¼Œä½ çš„åå­—å°‡èˆ‡æ„›å› æ–¯å¦ä¸¦åˆ—ã€‚";
              specialEnding = true;
            }
            break;
        }

        // å¦‚æœæ²’æœ‰è§¸ç™¼ç‰¹æ®Šçµå±€ï¼Œå‰‡æª¢æŸ¥é€šç”¨çµå±€
        if (!specialEnding) {
          if (Game.money >= 100000000) {
            endingType = "ğŸ’° å„„è¬å¯Œç¿";
            endingIcon = "ğŸ’";
            endingDesc =
              "ä½ å¯Œå¯æ•µåœ‹ï¼Œé”åˆ°äº†è²¡å¯Œçš„å·”å³°ï¼Œå¯ä»¥è²·ä¸‹ä»»ä½•ä½ æƒ³è¦çš„æ±è¥¿ã€‚";
          } else if (Game.money < 0) {
            endingType = "ğŸ’¸ çª®å›°æ½¦å€’";
            endingIcon = "ğŸšï¸";
            endingDesc = "ä½ è² å‚µç´¯ç´¯ï¼Œæ™šæ™¯æ·’æ¶¼ï¼Œåœ¨èº²é¿å‚µä¸»çš„ææ‡¼ä¸­åº¦éé¤˜ç”Ÿ...";
          } else if (Game.age >= 100) {
            endingType = "ğŸ‚ ç™¾æ­²äººç‘";
            endingIcon = "ğŸ¢";
            endingDesc =
              "ä½ è¦‹è­‰äº†ä¸€å€‹ä¸–ç´€çš„è®Šé·ï¼Œé›–ç„¶å¹³æ·¡ï¼Œä½†é•·å£½æœ¬èº«å°±æ˜¯ä¸€ç¨®å‹åˆ©ã€‚";
          } else if (Game.happy < 20) {
            endingType = "â˜ï¸ é¬±é¬±è€Œçµ‚";
            endingIcon = "ğŸ˜¢";
            endingDesc =
              "ä½ çš„ä¸€ç”Ÿå……æ»¿äº†éºæ†¾èˆ‡æ‚²å‚·ï¼Œæœªèƒ½åœ¨é€™å€‹ä¸–ç•Œæ‰¾åˆ°å±¬æ–¼ä½ çš„å¿«æ¨‚ã€‚";
          } else if (Game.age < 30) {
            endingType = "ğŸ•Šï¸ è‹±å¹´æ—©é€";
            endingIcon = "âš°ï¸";
            endingDesc =
              "å‘½é‹é–‹äº†å€‹æ®˜é…·çš„ç©ç¬‘ï¼Œä½ çš„äººç”Ÿæ‰å‰›é–‹å§‹å°±åŒ†åŒ†ç•«ä¸‹å¥é»ã€‚";
          } else if (Game.jobId === "none" && Game.age > 50) {
            endingType = "ğŸ›‹ï¸ å•ƒè€æ—";
            endingIcon = "ğŸ“º";
            endingDesc = "ä½ ä¸€ç”Ÿéƒ½æ²’æœ‰æ­£å¼å·¥ä½œï¼Œä¾è³´è‘—éºç”¢æˆ–å®¶äººçš„è³‡åŠ©åº¦æ—¥ã€‚";
          }
        }

        // é¡¯ç¤ºçµå±€ç•«é¢
        document.getElementById("ending-icon").textContent = endingIcon;
        document.getElementById("ending-title").textContent = endingType;
        document.getElementById("ending-desc").textContent = endingDesc;

        // ç”Ÿæˆæœ€çµ‚çµ±è¨ˆæ•¸æ“š HTML
        const finalStatsHtml = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
            <div>ğŸ‘¤ å§“å: ${Game.name}</div>
            <div>ğŸ‚ äº«å¹´: ${Game.age}æ­²</div>
            <div>ğŸ’° æœ€çµ‚è³‡ç”¢: $${Game.money.toLocaleString()}</div>
            <div>ğŸ§  æ™ºåŠ›: ${Math.floor(Game.intel)}</div>
            <div>ğŸ˜Š å¿«æ¨‚: ${Math.floor(Game.happy)}</div>
            <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
            <div>ğŸ† è§£é–æˆå°±: ${Game.unlockedAchievements.length}</div>
            <div>â¤ï¸ ä¼´ä¾¶: ${Game.partner ? Game.partner.name : "å–®èº«"}</div>
            <div>ğŸ‘¶ å­å¥³: ${Game.children.length}äºº</div>
        </div>
    `;

        document.getElementById("ending-stats").innerHTML = finalStatsHtml;
        document.getElementById("ending-overlay").style.display = "flex";
      }
      function unlockTrait(traitId) {
        if (Game.unlockedTraits.includes(traitId)) {
          return; // å·²ç¶“è§£é–éäº†
        }

        const trait = TRAITS.find((t) => t.id === traitId);
        if (!trait) return;

        Game.unlockedTraits.push(traitId);
        Game.traits.push(trait);
        trait.effect(Game);

        log(`âœ¨ è§£é–æ–°ç‰¹è³ªï¼š${trait.name}`);
        showModal("ğŸ‰ æ–°ç‰¹è³ªè§£é–ï¼", `${trait.name}\n${trait.desc}`, [
          { text: "å¤ªæ£’äº†ï¼", action: () => closeModal() },
        ]);

        updateUI();
      }
      // ===== ğŸ‘¥ NPC ç³»çµ±å‡½æ•¸ =====
      function generateNPC(type) {
        const templates = NPC_TEMPLATES[type];
        if (!templates || templates.length === 0) return null;

        const template =
          templates[Math.floor(Math.random() * templates.length)];
        const npc = {
          id: `npc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          name: template.name,
          type: type,
          personality: template.personality,
          relation: template.baseRelation,
          gender: template.gender || (Math.random() > 0.5 ? "male" : "female"),
          age: Game.age + (Math.floor(Math.random() * 6) - 3), // å¹´é½¡å·®è· -3 åˆ° +3
          metAt: Game.age,
          lastInteraction: Game.age,
        };

        return npc;
      }

      function addNPC(type) {
        const npc = generateNPC(type);
        if (!npc) return null;

        Game.npcs.push(npc);
        Game.metNPCs.push(npc.id);

        log(`ğŸ‘¤ èªè­˜äº†æ–°æœ‹å‹ï¼š${npc.name}`);
        return npc;
      }

      function getNPCsByType(type) {
        return Game.npcs.filter((npc) => npc.type === type);
      }

      function interactWithNPC(npcId, interactionType) {
        const npc = Game.npcs.find((n) => n.id === npcId);
        if (!npc) return;

        const interaction = NPC_INTERACTIONS[interactionType];
        if (!interaction) return;

        // æª¢æŸ¥é—œä¿‚éœ€æ±‚
        if (
          interaction.requireRelation &&
          npc.relation < interaction.requireRelation
        ) {
          alert(
            `âŒ é—œä¿‚ä¸å¤ å¥½ï¼Œéœ€è¦å¥½æ„Ÿåº¦ ${interaction.requireRelation} ä»¥ä¸Š`,
          );
          return;
        }

        // æª¢æŸ¥é«”åŠ›
        if (Game.stamina < interaction.cost) {
          alert("âš¡ é«”åŠ›ä¸è¶³ï¼");
          return;
        }

        // æª¢æŸ¥é‡‘éŒ¢
        if (
          interaction.moneyChange < 0 &&
          Game.money < Math.abs(interaction.moneyChange)
        ) {
          alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
          return;
        }

        // åŸ·è¡Œäº’å‹•
        Game.stamina -= interaction.cost;
        Game.money += interaction.moneyChange;

        // ===== âœ… è¨ˆç®—ç‰¹è³ªå°é—œä¿‚çš„å½±éŸ¿ =====
        let relationChange = interaction.relationChange;
        let bonusMessages = [];

        // ç‰¹è³ªåŠ æˆ1ï¼šå¤–å‘ç‰¹è³ªï¼ˆèŠå¤© +5ï¼‰
        if (
          Game.traits.some((t) => t.id === "extrovert") &&
          interactionType === "chat"
        ) {
          relationChange += 5;
          bonusMessages.push("ğŸ‰ å¤–å‘ç‰¹è³ªï¼šèŠå¤©æ•ˆæœ +5");
        }

        // ç‰¹è³ªåŠ æˆ2ï¼šé­…åŠ›ç‰¹è³ªï¼ˆæ‰€æœ‰äº’å‹• +3ï¼‰
        if (Game.traits.some((t) => t.id === "charismatic")) {
          relationChange += 3;
          bonusMessages.push("âœ¨ é­…åŠ›ç‰¹è³ªï¼šå¥½æ„Ÿåº¦ +3");
        }

        // ç‰¹è³ªåŠ æˆ3ï¼šç¤¾äº¤å¤§å¸«ï¼ˆæ‰€æœ‰æ•ˆæœ x1.5ï¼‰
        if (Game.traits.some((t) => t.id === "socialmaster")) {
          relationChange = Math.floor(relationChange * 1.5);
          bonusMessages.push("ğŸ‘‘ ç¤¾äº¤å¤§å¸«ï¼šæ•ˆæœ +50%");
        }

        // ç‰¹è³ªæ¸›ç›Š1ï¼šå…§å‘ç‰¹è³ªï¼ˆèŠå¤© -2ï¼‰
        if (
          Game.traits.some((t) => t.id === "introvert") &&
          interactionType === "chat"
        ) {
          relationChange -= 2;
          bonusMessages.push("ğŸ˜… å…§å‘ç‰¹è³ªï¼šèŠå¤©æ•ˆæœ -2");
        }

        // ç‰¹è³ªåŠ æˆ4ï¼šæ¨‚è§€ç‰¹è³ªï¼ˆæ‰€æœ‰äº’å‹• +2ï¼‰
        if (Game.traits.some((t) => t.id === "optimistic")) {
          relationChange += 2;
          bonusMessages.push("ğŸŒŸ æ¨‚è§€ç‰¹è³ªï¼šæ­£èƒ½é‡ +2");
        }

        // ç‰¹è³ªæ¸›ç›Š2ï¼šæ‚²è§€ç‰¹è³ªï¼ˆæ‰€æœ‰äº’å‹• -2ï¼‰
        if (Game.traits.some((t) => t.id === "pessimistic")) {
          relationChange -= 2;
          bonusMessages.push("ğŸ˜” æ‚²è§€ç‰¹è³ªï¼šè² èƒ½é‡ -2");
        }

        // ç‰¹è³ªåŠ æˆ5ï¼šå‹‡æ•¢ç‰¹è³ªï¼ˆç´„æœƒ +5ï¼‰
        if (
          Game.traits.some((t) => t.id === "brave") &&
          interactionType === "date"
        ) {
          relationChange += 5;
          bonusMessages.push("ğŸ’ª å‹‡æ•¢ç‰¹è³ªï¼šç´„æœƒæ›´å¤§è†½ +5");
        }

        npc.relation = Math.max(
          0,
          Math.min(100, npc.relation + relationChange),
        );
        npc.lastInteraction = Game.age;

        // æ ¹æ“š NPC æ€§æ ¼èª¿æ•´é—œä¿‚è®ŠåŒ–
        let personalityBonus = 0;
        if (npc.personality === "friendly" && interactionType === "chat")
          personalityBonus = 3;
        if (npc.personality === "kind" && interactionType === "help")
          personalityBonus = 5;
        if (npc.personality === "outgoing" && interactionType === "chat")
          personalityBonus = 2;
        if (npc.personality === "gentle" && interactionType === "date")
          personalityBonus = 4;

        npc.relation += personalityBonus;
        npc.relation = Math.max(0, Math.min(100, npc.relation));

        // ===== âœ… é¡¯ç¤ºè¨Šæ¯ =====
        const changes = [];
        if (interaction.moneyChange !== 0) {
          changes.push(
            `ğŸ’° ${interaction.moneyChange > 0 ? "+" : ""}$${Math.abs(interaction.moneyChange).toLocaleString()}`,
          );
        }
        changes.push(
          `ğŸ’— å¥½æ„Ÿåº¦ ${relationChange + personalityBonus > 0 ? "+" : ""}${relationChange + personalityBonus}`,
        );

        let logMessage = `èˆ‡ ${npc.name} ${interaction.desc}`;
        if (bonusMessages.length > 0) {
          logMessage += "\n" + bonusMessages.join("\n");
        }

        log(logMessage, changes);

        // æª¢æŸ¥é—œä¿‚é‡Œç¨‹ç¢‘
        if (npc.relation >= 80 && npc.type === "romantic") {
          if (Math.random() > 0.7) {
            showConfessionEvent(npc);
          }
        }

        updateUI();
        renderSocial();
      }

      function showConfessionEvent(npc) {
        showModal(
          "ğŸ’• å¿ƒå‹•æ™‚åˆ»",
          `${npc.name} ä¼¼ä¹å°ä½ æœ‰å¥½æ„Ÿ...\nè¦å‘å°æ–¹å‘Šç™½å—ï¼Ÿ`,
          [
            {
              text: "â¤ï¸ å‘Šç™½",
              action: () => {
                if (npc.relation >= 80) {
                  npc.type = "lover";
                  npc.relation = 85;
                  log(`ğŸ’• ${npc.name} æ¥å—äº†ä½ çš„å‘Šç™½ï¼`);
                  showModal(
                    "ğŸ’• æˆ€æ„›é–‹å§‹",
                    `æ­å–œï¼ä½ å’Œ ${npc.name} é–‹å§‹äº¤å¾€äº†ï¼`,
                    [{ text: "å¤ªå¥½äº†ï¼", action: () => closeModal() }],
                  );
                } else {
                  npc.relation -= 10;
                  log(`ğŸ˜¢ ${npc.name} æ‹’çµ•äº†ä½ ...`);
                  alert("ğŸ˜¢ å°æ–¹æ‹’çµ•äº†...");
                }
                closeModal();
                updateUI();
                renderSocial();
              },
            },
            {
              text: "ä¸è¦",
              action: () => closeModal(),
            },
          ],
        );
      }

      function proposeMarriage(npcId) {
        const npc = Game.npcs.find((n) => n.id === npcId);
        if (!npc || npc.type !== "lover") {
          alert("âŒ åªèƒ½å‘æˆ€äººæ±‚å©šï¼");
          return;
        }

        if (npc.relation < 90) {
          alert("âŒ æ„Ÿæƒ…é‚„ä¸å¤ æ·±åšï¼ˆéœ€è¦å¥½æ„Ÿåº¦ 90+ï¼‰");
          return;
        }

        if (Game.money < 100000) {
          alert("ğŸ’¸ çµå©šéœ€è¦è‡³å°‘ $100,000 æº–å‚™å©šç¦®");
          return;
        }

        showModal("ğŸ’ æ±‚å©š", `å‘ ${npc.name} æ±‚å©šï¼Ÿ\nå©šç¦®è²»ç”¨ï¼š$100,000`, [
          {
            text: "ğŸ’ æ±‚å©š",
            action: () => {
              Game.money -= 100000;
              npc.type = "spouse";
              npc.relation = 95;

              // ç§»é™¤æˆ€äººï¼Œæ”¹æˆé…å¶
              const index = Game.relationships.findIndex((r) => r.id === npcId);
              if (index !== -1) {
                Game.relationships[index].type = "spouse";
              }

              Game.happy += 50;
              log(`ğŸ’’ èˆ‡ ${npc.name} çµå©šäº†ï¼`);

              showModal(
                "ğŸ’’ çµå©šå…¸ç¦®",
                `æ­å–œï¼ä½ å’Œ ${npc.name} çµç‚ºå¤«å¦»ï¼\nç²å¾— +50 å¿«æ¨‚`,
                [{ text: "å¤ªå¹¸ç¦äº†ï¼", action: () => closeModal() }],
              );

              closeModal();
              updateUI();
              renderSocial();
            },
          },
          {
            text: "å†æƒ³æƒ³",
            action: () => closeModal(),
          },
        ]);
      }

      function updateNPCRelations() {
        // æ¯å¹´è‡ªå‹•è¡°æ¸›é•·æ™‚é–“æœªäº’å‹•çš„é—œä¿‚
        Game.npcs.forEach((npc) => {
          const yearsSinceInteraction = Game.age - npc.lastInteraction;
          if (yearsSinceInteraction > 3) {
            npc.relation = Math.max(0, npc.relation - 2);
          }
        });
      }

      function checkAchievements() {
        ACHIEVEMENTS.forEach((ach) => {
          if (!Game.unlockedAchievements.includes(ach.id)) {
            if (ach.check(Game)) {
              Game.unlockedAchievements.push(ach.id);

              // âœ… ç«‹å³ä¿å­˜æˆå°±
              saveAchievements();

              // æ˜¾ç¤ºè§£é”æç¤º
              const toast = document.createElement("div");
              toast.style.cssText = `
                    position: fixed;
                    top: 80px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #ffd700, #ffa000);
                    color: black;
                    padding: 15px 25px;
                    border-radius: 12px;
                    font-weight: bold;
                    z-index: 400;
                    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
                    animation: slideIn 0.5s;
                    font-size: 1.1em;
                    border: 3px solid #fff;
                `;
              toast.innerHTML = `ğŸ† æˆå°±è§£é–ï¼š${ach.icon} ${ach.name}`;
              document.body.appendChild(toast);

              setTimeout(() => {
                toast.style.animation = "slideIn 0.5s reverse";
                setTimeout(() => document.body.removeChild(toast), 500);
              }, 3000);

              log(`ğŸ† æˆå°±è§£é–ï¼š${ach.name}`);
            }
          }
        });
      }

      // ===== ğŸ« æ•™è‚²ç³»çµ±å‡½æ•¸ =====
      function canEnterEducation(eduId) {
        const edu = EDUCATION_LEVELS.find((e) => e.id === eduId);
        if (!edu) return false;

        // æª¢æŸ¥å¹´é½¡
        if (Game.age < edu.minAge) return false;

        // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰æ›´é«˜å­¸æ­·
        const currentEduIndex = EDUCATION_LEVELS.findIndex(
          (e) => e.id === Game.education,
        );
        const targetEduIndex = EDUCATION_LEVELS.findIndex(
          (e) => e.id === eduId,
        );
        if (currentEduIndex >= targetEduIndex) return false;

        // æª¢æŸ¥éœ€æ±‚
        if (edu.requirement) {
          if (edu.requirement.intel && Game.intel < edu.requirement.intel) {
            return false;
          }
        }

        // æª¢æŸ¥é‡‘éŒ¢
        if (edu.cost && Game.money < edu.cost) {
          return false;
        }

        return true;
      }

      function enterEducation(eduId, majorId = null) {
        const edu = EDUCATION_LEVELS.find((e) => e.id === eduId);
        if (!edu) return;

        if (!canEnterEducation(eduId)) {
          alert("âš ï¸ ä¸ç¬¦åˆå…¥å­¸æ¢ä»¶ï¼");
          return;
        }

        // æ‰£é™¤å­¸è²»
        if (edu.cost) {
          Game.money -= edu.cost;
        }

        Game.isStudying = true;
        Game.studyProgress = 0;

        let eduName = edu.name;
        if (majorId) {
          const majors = MAJORS[eduId];
          const major = majors?.find((m) => m.id === majorId);
          if (major) {
            Game.major = majorId;
            eduName += ` - ${major.name}`;
          }
        }

        log(`ğŸ“š é–‹å§‹å°±è®€${eduName}`);
        showModal("ğŸ“ å…¥å­¸é€šçŸ¥", `æ­å–œä½ é€²å…¥${eduName}ï¼\nåŠªåŠ›å­¸ç¿’å§ï¼`, [
          { text: "é–‹å§‹å­¸ç¿’", action: () => closeModal() },
        ]);

        updateUI();
      }

      function studyProgress() {
        if (!Game.isStudying) return;

        Game.studyProgress += 10 + Game.learnBonus * 5;

        if (Game.studyProgress >= 100) {
          graduateEducation();
        }
      }

      function graduateEducation() {
        const currentEdu = Game.education;
        const nextEduIndex =
          EDUCATION_LEVELS.findIndex((e) => e.id === currentEdu) + 1;
        const nextEdu = EDUCATION_LEVELS[nextEduIndex];

        if (nextEdu) {
          Game.education = nextEdu.id;
          Game.isStudying = false;
          Game.studyProgress = 0;

          // æ‡‰ç”¨å­¸æ­·åŠ æˆ
          if (nextEdu.bonus) {
            Object.keys(nextEdu.bonus).forEach((key) => {
              if (key.startsWith("skills.")) {
                const skillName = key.split(".")[1];
                Game.skills[skillName] += nextEdu.bonus[key];
              } else {
                Game[key] += nextEdu.bonus[key];
              }
            });
          }

          // æ‡‰ç”¨ä¸»ä¿®åŠ æˆ
          if (Game.major) {
            const majors = MAJORS[nextEdu.id];
            const major = majors?.find((m) => m.id === Game.major);
            if (major) {
              if (major.intel) Game.intel += major.intel;
              if (major.skills) {
                Object.keys(major.skills).forEach((skill) => {
                  Game.skills[skill] += major.skills[skill];
                });
              }
            }
          }

          log(`ğŸ“ æ­å–œç•¢æ¥­ï¼å–å¾—${nextEdu.name}å­¸æ­·`);
          showModal(
            "ğŸ‰ ç•¢æ¥­å…¸ç¦®",
            `æ­å–œä½ å®Œæˆå­¸æ¥­ï¼\nå–å¾—${nextEdu.name}å­¸æ­·`,
            [{ text: "å¤ªå¥½äº†ï¼", action: () => closeModal() }],
          );

          // è§£é–æˆå°±
          if (nextEdu.id === "phd") {
            Game.unlockedAchievements.push("scholar");
          }
        }

        updateUI();
      }

      function showEducationMenu() {
        let html = '<div style="padding: 20px;">';
        html += `<h2 style="color: var(--gold); margin-bottom: 20px;">ğŸ“ æ•™è‚²ç³»çµ±</h2>`;
        html += `<p style="color: var(--text-dim); margin-bottom: 15px;">ç•¶å‰å­¸æ­·ï¼š${EDUCATION_LEVELS.find((e) => e.id === Game.education)?.name || "ç„¡"}</p>`;

        if (Game.isStudying) {
          html += `<div style="margin-bottom: 20px;">`;
          html += `<p style="color: var(--blue);">ğŸ“š å­¸ç¿’ä¸­... ${Math.floor(Game.studyProgress)}%</p>`;
          html += `<div style="background: #333; height: 20px; border-radius: 10px; overflow: hidden; margin-top: 10px;">`;
          html += `<div style="width: ${Game.studyProgress}%; height: 100%; background: linear-gradient(90deg, var(--blue), var(--green)); transition: width 0.3s;"></div>`;
          html += `</div></div>`;
        }

        html +=
          '<div style="display: flex; flex-direction: column; gap: 10px;">';

        EDUCATION_LEVELS.forEach((edu, index) => {
          if (index === 0) return; // è·³é none

          const canEnter = canEnterEducation(edu.id);
          const currentEduIndex = EDUCATION_LEVELS.findIndex(
            (e) => e.id === Game.education,
          );
          const isCompleted = currentEduIndex >= index;

          let statusColor = isCompleted
            ? "var(--green)"
            : canEnter
              ? "var(--blue)"
              : "var(--red)";
          let statusText = isCompleted
            ? "âœ… å·²å®Œæˆ"
            : canEnter
              ? "å¯å…¥å­¸"
              : "âŒ æœªé”æ¨™";

          html += `<div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border-left: 3px solid ${statusColor};">`;
          html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
          html += `<div>`;
          html += `<div style="font-size: 1.1em; font-weight: bold; color: var(--gold);">${edu.name}</div>`;
          html += `<div style="font-size: 0.85em; color: var(--text-dim); margin-top: 5px;">`;
          html += `æœ€ä½å¹´é½¡: ${edu.minAge}æ­²`;
          if (edu.requirement?.intel)
            html += ` | æ™ºåŠ›éœ€æ±‚: ${edu.requirement.intel}`;
          if (edu.cost) html += ` | å­¸è²»: $${edu.cost.toLocaleString()}`;
          html += `</div></div>`;
          html += `<div style="color: ${statusColor}; font-weight: bold;">${statusText}</div>`;
          html += `</div></div>`;
        });

        html += "</div></div>";

        showModal("ğŸ“ æ•™è‚²ç³»çµ±", html, [
          { text: "é—œé–‰", action: () => closeModal() },
        ]);
      }

      function renderAchievements() {
        let html = "";

        ACHIEVEMENTS.forEach((ach) => {
          const unlocked = Game.unlockedAchievements.includes(ach.id);

          html += `
                          <div class="job-card" style="opacity: ${unlocked ? 1 : 0.4}; cursor: default;">
                              <div style="display: flex; align-items: center; gap: 10px;">
                                  <div style="font-size: 2em;">${unlocked ? ach.icon || "ğŸ†" : "ğŸ”’"}</div>
                                  <div>
                                      <div class="job-name">${ach.name}</div>
                                      <div style="font-size: 0.85em; color: var(--text-dim);">${ach.desc}</div>
                                  </div>
                              </div>
                          </div>
                      `;
        });

        document.getElementById("achievement-list").innerHTML = html;
      }

      function showAchievementToast(name) {
        const toast = document.createElement("div");
        toast.className = "achievement-toast";
        toast.innerHTML = `
                      <div class="achievement-icon">ğŸ†</div>
                      <div>
                          <div style="font-size: 0.9em;">è§£é–æˆå°±</div>
                          <div style="font-size: 1.1em;">${name}</div>
                      </div>
                  `;
        toast.style.cssText = `
                      position: fixed;
                      top: 80px;
                      right: 20px;
                      background: linear-gradient(135deg, #ffd700, #ffb300);
                      color: #000;
                      padding: 15px;
                      border-radius: 10px;
                      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
                      z-index: 150;
                      animation: slideIn 0.5s;
                      font-weight: bold;
                      display: flex;
                      gap: 10px;
                      align-items: center;
                  `;

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = "slideIn 0.5s reverse";
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 500);
        }, 3000);
      }

      function renderJobs() {
        // éæ¿¾å¯ç”¨è·æ¥­ï¼ˆæ’é™¤ none å’Œå‡ºèº«é™å®šè·æ¥­ï¼‰
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (availableJobs.length === 0) {
          document.getElementById("job-list").innerHTML =
            '<div style="text-align: center; color: var(--text-dim); padding: 30px;">æš«ç„¡å¯ç”¨è·æ¥­</div>';
          return;
        }

        // ç¢ºä¿ç´¢å¼•ä¸è¶…å‡ºç¯„åœ
        if (currentJobIndex >= availableJobs.length) currentJobIndex = 0;
        if (currentJobIndex < 0) currentJobIndex = availableJobs.length - 1;

        const job = availableJobs[currentJobIndex];

        // æª¢æŸ¥æ˜¯å¦ç¬¦åˆæ¢ä»¶
        let canApply = true;
        let reqText = "";

        if (job.requirement) {
          Object.keys(job.requirement).forEach((key) => {
            const required = job.requirement[key];
            const current =
              key === "intel"
                ? Game.intel
                : key === "health"
                  ? Game.health
                  : Game.skills[key] || 0;

            if (current < required) canApply = false;

            const emoji =
              key === "intel" ? "ğŸ§ " : key === "health" ? "â¤ï¸" : "ğŸ“Š";
            const status = current >= required ? "âœ…" : "âŒ";
            reqText += `<div style="margin: 3px 0;">${status} ${emoji} ${key}: ${current}/${required}</div>`;
          });
        } else {
          reqText = '<div style="color: var(--green);">âœ… ç„¡ç‰¹æ®Šè¦æ±‚</div>';
        }

        const isCurrentJob = Game.jobId === job.id;

        let html = `
              <div style="position: relative; min-height: 350px;">
                  <!-- å·¦å³åˆ‡æ›æŒ‰éˆ• -->
                  <button onclick="prevJob()"
                          style="position: absolute; left: -10px; top: 50%; transform: translateY(-50%);
                                 width: 50px; height: 50px; border-radius: 50%; font-size: 1.5em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 10;">
                      â—€
                  </button>

                  <button onclick="nextJob()"
                          style="position: absolute; right: -10px; top: 50%; transform: translateY(-50%);
                                 width: 50px; height: 50px; border-radius: 50%; font-size: 1.5em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 10;">
                      â–¶
                  </button>

                  <!-- è·æ¥­å¡ç‰‡ -->
                  <div style="padding: 0 60px;">
                      <div class="job-card" style="background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
                           border: 3px solid ${isCurrentJob ? "var(--gold)" : canApply ? "var(--blue)" : "var(--red)"};
                           padding: 25px; cursor: ${canApply && !isCurrentJob ? "pointer" : "default"};"
                           ${canApply && !isCurrentJob ? `onclick="selectJob('${job.id}')"` : ""}>

                          <div style="text-align: center; margin-bottom: 15px;">
                              <div style="font-size: 2em; margin-bottom: 5px;">ğŸ’¼</div>
                              <div class="job-name" style="font-size: 1.5em; color: var(--gold);">
                                  ${job.name} ${isCurrentJob ? "âœ“ ç•¶å‰è·æ¥­" : ""}
                              </div>
                          </div>

                          <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                              <div style="font-size: 1.2em; color: var(--green); margin-bottom: 10px;">
                                  ğŸ’° æœˆè–ª: $${job.salary.toLocaleString()}
                              </div>
                              <div style="color: var(--text-dim); font-size: 0.95em; line-height: 1.5;">
                                  ${job.desc}
                              </div>
                          </div>

                          <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                              <div style="font-weight: bold; margin-bottom: 8px; color: var(--accent);">
                                  ğŸ“‹ ä»»è·æ¢ä»¶ï¼š
                              </div>
                              ${reqText}
                          </div>

                          ${
                            !canApply && !isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--red); border-radius: 8px; font-weight: bold;">âŒ æ¢ä»¶ä¸ç¬¦ï¼Œç„¡æ³•æ‡‰å¾µ</div>'
                              : ""
                          }

                          ${
                            canApply && !isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--green); color: black; border-radius: 8px; font-weight: bold; animation: pulse 2s infinite;">ğŸ‘† é»æ“Šå¡ç‰‡æ‡‰å¾µæ­¤è·æ¥­</div>'
                              : ""
                          }

                          ${
                            isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--gold); color: black; border-radius: 8px; font-weight: bold;">âœ… é€™æ˜¯ä½ ç›®å‰çš„å·¥ä½œ</div>'
                              : ""
                          }
                      </div>

                      <!-- é ç¢¼æŒ‡ç¤ºå™¨ -->
                      <div style="text-align: center; margin-top: 15px; color: var(--text-dim); font-size: 0.9em;">
                          è·æ¥­ ${currentJobIndex + 1} / ${availableJobs.length}
                          <div style="margin-top: 8px; font-size: 0.85em;">
                              ğŸ’¡ å·¦å³åˆ‡æ›æŸ¥çœ‹æ›´å¤šè·æ¥­
                          </div>
                      </div>
                  </div>
              </div>
          `;

        document.getElementById("job-list").innerHTML = html;
      }

      function selectJob(jobId) {
        const job = JOBS.find((j) => j.id === jobId);
        if (!job) return;

        // âœ… æª¢æŸ¥ç‰¹è³ªéœ€æ±‚
        if (job.requiredTrait) {
          const hasTrait = Game.traits.some((t) => t.id === job.requiredTrait);
          if (!hasTrait) {
            const traitName =
              TRAITS.find((t) => t.id === job.requiredTrait)?.name ||
              "ç‰¹å®šç‰¹è³ª";
            alert(`âŒ æ­¤è·æ¥­éœ€è¦ç‰¹è³ªï¼š${traitName}`);
            return;
          }
        }

        // æª¢æŸ¥æŠ€èƒ½éœ€æ±‚
        let canApply = true;
        let missingReqs = [];

        if (job.requirement.intel && Game.intel < job.requirement.intel) {
          canApply = false;
          missingReqs.push(`æ™ºåŠ› ${job.requirement.intel}`);
        }

        Object.keys(job.requirement).forEach((skill) => {
          if (
            skill !== "intel" &&
            Game.skills[skill] < job.requirement[skill]
          ) {
            canApply = false;
            missingReqs.push(`${skill} ${job.requirement[skill]}`);
          }
        });

        if (!canApply) {
          alert("âŒ ä¸ç¬¦åˆæ¢ä»¶ï¼š" + missingReqs.join(", "));
          return;
        }

        // âœ… è¨ˆç®—ç‰¹è³ªåŠ æˆ
        let finalSalary = job.salary;
        let bonusMessages = [];

        if (job.traitBonus) {
          Game.traits.forEach((trait) => {
            if (job.traitBonus[trait.id]) {
              const bonus = job.traitBonus[trait.id];
              finalSalary *= bonus.salary;
              bonusMessages.push(`âœ¨ ${trait.name}ï¼š${bonus.desc}`);
            }
          });
        }

        Game.jobId = jobId;
        Game.jobYears = 0;

        let message = `ğŸ‰ æˆåŠŸæ‡‰å¾µ ${job.name}ï¼\næœˆè–ªï¼š$${Math.floor(finalSalary).toLocaleString()}`;
        if (bonusMessages.length > 0) {
          message += "\n\nç‰¹è³ªåŠ æˆï¼š\n" + bonusMessages.join("\n");
        }

        log(message);
        alert(message);
        updateUI();
      }

      function renderSocial() {
        let html = "";

        // === NPC åˆ—è¡¨ ===
        if (Game.npcs && Game.npcs.length > 0) {
          html += '<div style="margin-bottom: 20px;">';
          html +=
            '<h3 style="color: var(--gold); margin-bottom: 10px;">ğŸ‘¥ äººéš›é—œä¿‚</h3>';

          Game.npcs.forEach((npc) => {
            // è¨ˆç®—é¡è‰²
            const relationColor =
              npc.relation >= 80
                ? "var(--green)"
                : npc.relation >= 50
                  ? "var(--blue)"
                  : npc.relation >= 30
                    ? "var(--orange)"
                    : "var(--red)";

            // è¨­å®šåœ–ç¤º
            let typeIcon = "ğŸ‘¤";
            let typeName = "æœ‹å‹";
            if (npc.type === "romantic") {
              typeIcon = "ğŸ’•";
              typeName = "æ›–æ˜§å°è±¡";
            }
            if (npc.type === "lover") {
              typeIcon = "â¤ï¸";
              typeName = "æˆ€äºº";
            }
            if (npc.type === "spouse") {
              typeIcon = "ğŸ’‘";
              typeName = "é…å¶";
            }
            if (npc.type === "colleague") {
              typeIcon = "ğŸ’¼";
              typeName = "åŒäº‹";
            }
            if (npc.type === "classmate") {
              typeIcon = "ğŸ“š";
              typeName = "åŒå­¸";
            }

            // äº’å‹•æŒ‰éˆ•é‚è¼¯
            let actionButtons = `
        <button class="btn-job" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" onclick="interactWithNPC('${npc.id}', 'chat')">ğŸ’¬ é–’èŠ</button>
        <button class="btn-job" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" onclick="interactWithNPC('${npc.id}', 'gift')">ğŸ é€ç¦®</button>
      `;

            if (npc.type === "romantic" || npc.type === "lover") {
              actionButtons += `<button class="btn-buy" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" onclick="interactWithNPC('${npc.id}', 'date')">ğŸ’• ç´„æœƒ</button>`;
            }
            if (npc.type === "lover" && npc.relation >= 90) {
              actionButtons += `<button class="btn-main" style="flex: 1; min-width: 100px; padding: 8px; font-size: 0.85em;" onclick="proposeMarriage('${npc.id}')">ğŸ’ æ±‚å©š</button>`;
            }

            // ä¿®æ­£ï¼šç›´æ¥ä½¿ç”¨ html è®Šæ•¸ä¸²æ¥ï¼Œä¸è¦ç”¨æœªå®šç¾©çš„ npcHtml
            html += `
        <div class="job-card" style="cursor: default;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 1.1em; font-weight: bold; color: var(--gold);">
                        ${typeIcon} ${npc.name}
                    </div>
                    <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 3px;">
                        ${typeName} | ${npc.age}æ­²
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="color: ${relationColor}; font-weight: bold;">
                        ğŸ’— ${npc.relation}
                    </div>
                </div>
            </div>
            <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                ${actionButtons}
            </div>
        </div>
      `;
          });
          html += "</div>";
        }

        // === å›ºå®šé—œä¿‚ (çˆ¶æ¯ç­‰) ===
        if (Game.relationships.length > 0) {
          // ... (ä½ å¯ä»¥ä¿ç•™åŸæœ¬è™•ç† relationships çš„ä»£ç¢¼ï¼Œæˆ–è€…ç°¡åŒ–é¡¯ç¤º)
          // é€™è£¡ç‚ºäº†é¿å…éŒ¯èª¤ï¼Œç¢ºä¿ä¸»è¦é‚è¼¯æ­£ç¢ºå³å¯
        }

        if (!html && Game.relationships.length === 0) {
          html =
            '<div style="color: var(--text-dim); text-align: center; padding: 20px;">é‚„æ²’æœ‰ä»»ä½•äººéš›é—œä¿‚</div>';
        }

        // äº¤å‹è»Ÿé«”æŒ‰éˆ•å€åŸŸ
        const hasPartner =
          Game.relationships.some(
            (r) => r.type === "partner" || r.type === "spouse",
          ) || Game.npcs.some((n) => n.type === "lover" || n.type === "spouse");
        document.getElementById("find-partner-area").style.display =
          Game.age >= 18 && !hasPartner ? "block" : "none";

        document.getElementById("npc-list").innerHTML = html;
      }
      function prevJob() {
        currentJobIndex--;
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (currentJobIndex < 0) {
          currentJobIndex = availableJobs.length - 1;
        }

        renderJobs();
      }

      function nextJob() {
        currentJobIndex++;
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (currentJobIndex >= availableJobs.length) {
          currentJobIndex = 0;
        }

        renderJobs();
      }

      function findPartner() {
        if (Game.money < 500) return alert("æ²’éŒ¢ä½¿ç”¨äº¤å‹è»Ÿé«”");

        Game.money -= 500;
        const chance = (Game.skills.charm / 150) * 0.8 + 0.2;

        if (Math.random() < chance) {
          const names = [
            "å°ç¾",
            "é˜¿è±ª",
            "é›…å©·",
            "å¿—æ˜",
            "Emily",
            "Jack",
            "å°ç³",
            "å¤§è¡›",
            "å‡±è‰",
            "ä¿Šå‚‘",
          ];
          const name = names[Math.floor(Math.random() * names.length)];

          Game.relationships.push({
            id: "partner_" + Date.now(),
            name: name,
            type: "partner",
            relation: 50,
            role: "ä¼´ä¾¶",
          });

          log(`ğŸ’– é…å°æˆåŠŸï¼å’Œ ${name} é–‹å§‹äº¤å¾€`);
        } else {
          Game.happy -= 10;
          log("ğŸ’” æ²’æœ‰é…å°æˆåŠŸ...");
        }

        updateUI();
        renderSocial();
      }
      // ===== âœ… æ–°å¢ï¼šNPC ç”Ÿè€ç—…æ­»ç³»ç»Ÿ =====
      // ===== âœ… æ–°å¢ï¼šNPC äº’åŠ¨ç³»ç»Ÿ =====
      function interactWithNPC(npcId) {
        if (isProcessing) return;
        isProcessing = true;

        const npc = Game.relationships.find((n) => n.id === npcId);
        if (!npc) {
          isProcessing = false;
          return;
        }

        if (Game.money < 1000) {
          isProcessing = false;
          alert("ğŸ’¸ äº’å‹•éœ€è¦ 1000 å…ƒ");
          return;
        }

        Game.money -= 1000;
        const relationGain = Math.floor(5 * Game.socialBonus);
        npc.relation += relationGain;

        if (npc.relation > 100) npc.relation = 100;

        log(`ğŸ’¬ èˆ‡ ${npc.name} äº’å‹•ï¼Œå¥½å‹åº¦ +${relationGain}`);
        updateUI();

        setTimeout(() => {
          isProcessing = false;
        }, 300);
      }

      function giveGiftToNPC(npcId) {
        if (isProcessing) return;
        isProcessing = true;

        const npc = Game.relationships.find((n) => n.id === npcId);
        if (!npc) {
          isProcessing = false;
          return;
        }

        if (Game.money < 5000) {
          isProcessing = false;
          alert("ğŸ’¸ é€ç¦®éœ€è¦ 5000 å…ƒ");
          return;
        }

        Game.money -= 5000;
        const relationGain = Math.floor(10 * Game.socialBonus);
        npc.relation += relationGain;

        if (npc.relation > 100) npc.relation = 100;

        // ç”Ÿç—…æ—¶é€ç¤¼é¢å¤–åŠ å¥åº·
        if (npc.isSick) {
          npc.health += 10;
          log(`ğŸ é€ç¦®çµ¦ ${npc.name}ï¼Œå¥½å‹åº¦ +${relationGain}ï¼Œå¥åº· +10`);
        } else {
          log(`ğŸ é€ç¦®çµ¦ ${npc.name}ï¼Œå¥½å‹åº¦ +${relationGain}`);
        }

        updateUI();

        setTimeout(() => {
          isProcessing = false;
        }, 300);
      }

      // NPC æ›´æ–°ç”Ÿå‘½å‘¨æœŸ
      function updateNPCLifecycle() {
        const toRemove = [];

        Game.relationships.forEach((npc, index) => {
          // è·³è¿‡ç‰¹æ®Š NPCï¼ˆé…å¶ã€å­å¥³ï¼‰
          if (npc.type === "spouse" || npc.type === "child") {
            // é…å¶å’Œå­å¥³ä¹Ÿä¼šå˜è€
            if (!npc.age) npc.age = npc.type === "spouse" ? Game.age : 0;
            npc.age++;

            // å­å¥³æˆå¹´åå˜æˆæœ‹å‹
            if (npc.type === "child" && npc.age >= 18) {
              npc.type = "friend";
              npc.relation += 10;
              log(`ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ${npc.name} å·²æˆå¹´ï¼Œé—œä¿‚è½‰ç‚ºæœ‹å‹`);
            }
            return;
          }

          // åˆå§‹åŒ– NPC å¹´é¾„ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
          if (!npc.age) {
            npc.age = Math.floor(Math.random() * 20) + Game.age - 10;
            if (npc.age < 0) npc.age = Game.age;
          }

          // NPC å¹´é¾„å¢é•¿
          npc.age++;

          // åˆå§‹åŒ–å¥åº·å€¼
          if (!npc.health) {
            npc.health = 100;
          }

          // ===== NPC å¥åº·è¡°å‡ =====
          let healthDecay = 3;
          if (npc.age > 60) healthDecay = 5;
          if (npc.age > 80) healthDecay = 10;
          npc.health -= healthDecay;

          // ===== NPC ç”Ÿç—…äº‹ä»¶ =====
          if (npc.health < 50 && npc.health > 0 && !npc.isSick) {
            npc.isSick = true;
            log(`ğŸ¥ ${npc.name} ç”Ÿç—…äº†ï¼ˆ${npc.age}æ­²ï¼‰`);

            // 20% æœºç‡è§¦å‘å¸®åŠ©äº‹ä»¶
            if (Math.random() < 0.2) {
              showNPCSickEvent(npc);
            }
          } else if (npc.health >= 50 && npc.isSick) {
            npc.isSick = false;
            log(`â¤ï¸ ${npc.name} åº·å¾©äº†`);
          }

          // ===== NPC æ­»äº¡ =====
          if (npc.health <= 0 || (npc.age > 85 && Math.random() < 0.15)) {
            toRemove.push(index);
            log(`ğŸ’€ ${npc.name} å»ä¸–äº†ï¼Œäº«å¹´ ${npc.age} æ­²`);
            Game.happy -= 15;

            // å¥½å‹å»ä¸–ç‰¹æ®Šæç¤º
            if (npc.relation > 80) {
              Game.happy -= 10;
              showDeathModal(npc);
            }
          }

          // ===== NPC ç»“å©šç”Ÿå­ï¼ˆæœ‹å‹ç±»å‹ï¼‰=====
          if (
            npc.type === "friend" &&
            npc.age >= 25 &&
            npc.age <= 40 &&
            !npc.hasFamily
          ) {
            if (Math.random() < 0.1) {
              npc.hasFamily = true;
              log(`ğŸ’‘ ${npc.name} çµå©šäº†`);
            }
          }

          if (
            npc.hasFamily &&
            !npc.hasChild &&
            npc.age >= 28 &&
            npc.age <= 45
          ) {
            if (Math.random() < 0.08) {
              npc.hasChild = true;
              log(`ğŸ‘¶ ${npc.name} æœ‰äº†å­©å­`);
            }
          }

          // ===== å…³ç³»è‡ªç„¶è¡°å‡ =====
          if (npc.relation > 0) {
            npc.relation -= 2;
            if (npc.relation < 0) npc.relation = 0;
          }

          // å…³ç³»å¤ªä½è‡ªåŠ¨æ–­è”
          if (npc.relation < 20 && npc.type === "friend") {
            toRemove.push(index);
            log(`ğŸ’” èˆ‡ ${npc.name} å¤±å»è¯çµ¡`);
          }
        });

        // ç§»é™¤æ­»äº¡æˆ–æ–­è”çš„ NPCï¼ˆä»åå¾€å‰åˆ é™¤é¿å…ç´¢å¼•é”™ä¹±ï¼‰
        toRemove
          .sort((a, b) => b - a)
          .forEach((index) => {
            Game.relationships.splice(index, 1);
          });
      }

      // NPC ç”Ÿç—…äº‹ä»¶
      function showNPCSickEvent(npc) {
        const modal = document.getElementById("event-modal");
        const title = document.getElementById("ev-title");
        const desc = document.getElementById("ev-desc");
        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        title.textContent = "ğŸ¥ æœ‹å‹ç”Ÿç—…";
        desc.textContent = `ä½ çš„æœ‹å‹ ${npc.name}ï¼ˆ${npc.age}æ­²ï¼‰ç”Ÿç—…äº†ï¼Œéœ€è¦é†«ç™‚è²»ç”¨ 20,000 å…ƒã€‚ä½ é¡˜æ„å¹«åŠ©å—ï¼Ÿ`;

        btnA.textContent = "ğŸ’° å¹«åŠ©ï¼ˆ-20,000ï¼‰";
        btnA.onclick = () => {
          if (Game.money >= 20000) {
            Game.money -= 20000;
            npc.health += 30;
            npc.relation += 20;
            log(`â¤ï¸ å¹«åŠ©äº† ${npc.name}ï¼Œé—œä¿‚å¤§å¹…æå‡`);
          } else {
            alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
          }
          modal.style.display = "none";
          updateUI();
        };

        btnB.textContent = "ğŸ˜” ç„¡èƒ½ç‚ºåŠ›";
        btnB.onclick = () => {
          npc.relation -= 10;
          log(`ğŸ’” ${npc.name} æ„Ÿåˆ°å¤±æœ›`);
          modal.style.display = "none";
          updateUI();
        };

        btnB.style.display = "block";
        modal.style.display = "flex";
      }

      // NPC æ­»äº¡æç¤º
      function showDeathModal(npc) {
        const modal = document.getElementById("event-modal");
        const title = document.getElementById("ev-title");
        const desc = document.getElementById("ev-desc");
        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        title.textContent = "ğŸ’€ æ‚²å‚·çš„æ¶ˆæ¯";
        desc.innerHTML = `
        <div style="text-align: center; line-height: 1.8;">
            <div style="font-size: 1.5em; margin-bottom: 15px;">ğŸ•¯ï¸</div>
            <div style="font-weight: bold; font-size: 1.2em; margin-bottom: 10px;">${npc.name}</div>
            <div style="color: var(--text-dim);">äº«å¹´ ${npc.age} æ­²</div>
            <div style="margin-top: 15px; color: var(--text-dim);">å¥½å‹åº¦ï¼š${npc.relation}</div>
            <div style="margin-top: 10px; font-style: italic;">
                "è¬è¬ä½ é™ªä¼´æˆ‘çš„äººç”Ÿæ—…ç¨‹"
            </div>
        </div>
    `;

        btnA.textContent = "ğŸ˜¢ å“€æ‚¼";
        btnA.onclick = () => {
          modal.style.display = "none";
        };

        btnB.style.display = "none";
        modal.style.display = "flex";
      }
      function addFriend() {
        // ===== âœ… ä½¿ç”¨çœŸå®çš„å°æ¹¾å§“å =====
        const names = [
          // ç”·ç”Ÿåå­—
          "é™³å† å®‡",
          "æ—å­ç¿”",
          "å¼µå®¶è±ª",
          "æå®—ç¿°",
          "ç‹å»ºæ°‘",
          "é»ƒä¿Šå‚‘",
          "å³æ‰¿æ©",
          "åŠ‰æŸå»·",
          "è¨±å¿—è±ª",
          "é„­å®‡è»’",
          "è¬æ‰¿ç¿°",
          "æ¥Šæ‰¿ç¿°",
          "è”¡æ”¿éœ–",
          "è³´å½¥å»·",
          "å¾æµ©å®‡",
          "å‘¨æŸè¾°",
          "è•­å®‡æ©",
          "ç¾…ç«£å®‡",
          "ç°¡ç´¹å®‡",
          "æ›¾æŸç¿°",
          "å½­æ˜±ç¿”",
          "æ´ªå­è»’",
          "æ±Ÿæ‰¿æ©",
          "ä½•å† éœ–",
          "å‘‚æŸå‹³",
          "è˜‡å»ºæ–‡",
          "ä¸ç´¹æ©",
          "æ–½å®—ç¿°",
          "é«˜å®‡è¾°",
          "é­æ‰¿ä½‘",
          "èŒƒå®—ä½‘",
          "å­«æµ©å®‡",
          "æ½˜æŸç¿°",
          "è‘‰ä¿Šå®",
          "èŠå®‡ç¿”",
          "æ¸¸æ‰¿ç¿°",
          "è©¹æŸå‹³",
          "é‚±å»ºå®‰",
          "æ–¹å®—ä½‘",
          "ä¾¯å®‡æ©",
          "æˆ´æ‰¿ç¿°",
          "ç”°æŸå®‡",

          // å¥³ç”Ÿåå­—
          "é™³æ€å¦¤",
          "æ—é›¨æ¶µ",
          "å¼µå®¶ç‘œ",
          "æèŠ·ç‘„",
          "ç‹é–é›¯",
          "é»ƒè©©æ¶µ",
          "å³æ¬£æ€¡",
          "åŠ‰æ€¡è±",
          "è¨±èŠ·å¯§",
          "é„­é›¨å½¤",
          "è¬å®œåº­",
          "æ¥Šè©©æ¶µ",
          "è”¡å®œè“",
          "è³´å®œè±",
          "å¾èŠ·è‹¥",
          "å‘¨æ¬£å¦¤",
          "è•­é›¨æ™´",
          "ç¾…é›…å©·",
          "ç°¡å¿ƒå¦¤",
          "æ›¾è©©æ¶µ",
          "å½­è©©å©·",
          "æ´ªèŠ·ç‘„",
          "æ±Ÿæ¬£å¦®",
          "ä½•é›¨è±",
          "å‘‚èŠ·å¯§",
          "è˜‡é›…æ–‡",
          "ä¸æ¬£å¦¤",
          "æ–½å®œåº­",
          "é«˜å®‡æ™´",
          "é­è©©æ¶µ",
          "èŒƒèŠ·ç‘„",
          "å­«é›¨å½¤",
          "æ½˜æ¬£æ€¡",
          "è‘‰èŠ·å¦¤",
          "èŠè©©å©·",
          "æ¸¸å®œè±",
          "è©¹èŠ·æ¶µ",
          "é‚±é›¨æ¶µ",
          "æ–¹èŠ·ç‘„",
          "ä¾¯æ¬£å¦¤",
          "æˆ´è©©æ¶µ",
          "ç”°å®œè±",
        ];

        const name = names[Math.floor(Math.random() * names.length)];
        const id = `friend_${Date.now()}_${Math.random()}`;

        // åˆå§‹åŒ–å¹´é¾„å’Œå¥åº·
        const age = Math.floor(Math.random() * 20) + Game.age - 10;
        const finalAge = age > 0 ? age : Game.age;

        Game.relationships.push({
          id,
          name,
          type: "friend",
          relation: 50,
          age: finalAge,
          health: 100,
          isSick: false,
          hasFamily: false,
          hasChild: false,
        });

        log(`ğŸ¤ èªè­˜äº†æ–°æœ‹å‹ï¼š${name}ï¼ˆ${finalAge}æ­²ï¼‰`);
      }

      function renderShop() {
        // è»Šåº«
        let carHtml = "";
        CARS.forEach((car) => {
          const owned = Game.inventory.includes(car.id);
          carHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${car.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">âœ¨ é­…åŠ› +${car.charm}</div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${car.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${car.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(car.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        // æˆ¿ç”¢
        let houseHtml = "";
        HOUSES.forEach((house) => {
          const owned = Game.inventory.includes(house.id);
          houseHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${house.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">
                                  ğŸ˜Š å¿«æ¨‚ +${house.happy} | ğŸ’° è¢«å‹•æ”¶å…¥ $${house.passive.toLocaleString()}/æœˆ
                              </div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${house.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${house.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(house.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        // å¥¢ä¾ˆå“
        let luxHtml = "";
        LUXURIES.forEach((lux) => {
          const owned = Game.inventory.includes(lux.id);
          luxHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${lux.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">
                                  ${lux.charm ? `âœ¨ é­…åŠ› +${lux.charm}` : ""}
                                  ${lux.happy ? `ğŸ˜Š å¿«æ¨‚ +${lux.happy}` : ""}
                              </div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${lux.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${lux.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(lux.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        document.getElementById("car-shop").innerHTML = carHtml;
        document.getElementById("house-shop").innerHTML = houseHtml;
        document.getElementById("luxury-shop").innerHTML = luxHtml;
      }

      function buyItem(id) {
        const car = CARS.find((c) => c.id === id);
        const house = HOUSES.find((h) => h.id === id);
        const lux = LUXURIES.find((l) => l.id === id);
        const item = car || house || lux;

        if (!item) return;
        if (Game.inventory.includes(id)) return alert("å·²æ“æœ‰");
        if (Game.money < item.price) return alert("éŒ¢ä¸å¤ ");

        Game.money -= item.price;
        Game.inventory.push(id);

        if (car) {
          Game.skills.charm += car.charm;
          log(`ğŸï¸ è³¼è²·äº† ${car.name}`);
        } else if (house) {
          Game.happy += house.happy;
          log(`ğŸ˜ï¸ è³¼è²·äº† ${house.name}`);
        } else {
          if (lux.charm) Game.skills.charm += lux.charm;
          if (lux.happy) Game.happy += lux.happy;
          log(`ğŸ’ è³¼è²·äº† ${lux.name}`);
        }

        checkAchievements();
        updateUI();
        renderShop();
      }

      function renderStats() {
        const highestSkill = Object.keys(Game.skills).reduce((a, b) =>
          Game.skills[a] > Game.skills[b] ? a : b,
        );

        const totalWealth =
          Game.money +
          Game.inventory.reduce((sum, id) => {
            const item = [...CARS, ...HOUSES, ...LUXURIES].find(
              (i) => i.id === id,
            );
            return sum + (item ? item.price : 0);
          }, 0);

        const html = `
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em;">
                          <div>ğŸ‚ ç•¶å‰å¹´é½¡: ${Game.age}æ­²</div>
                          <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
                          <div>ğŸ’° ç¸½è³‡ç”¢: $${totalWealth.toLocaleString()}</div>
                          <div>ğŸ’¼ å·¥ä½œå¹´è³‡: ${Game.jobYears}å¹´</div>
                          <div>ğŸ‘¥ äººéš›é—œä¿‚: ${Game.relationships.length}äºº</div>
                          <div>ğŸ† æˆå°±æ•¸: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                          <div>ğŸ¯ åŸ·è¡Œè¡Œå‹•: ${Game.totalActions}æ¬¡</div>
                          <div>ğŸ“¢ è§¸ç™¼äº‹ä»¶: ${Game.totalEvents}æ¬¡</div>
                          <div>ğŸ˜Š å¿«æ¨‚å¹´æ•¸: ${Game.happyYears}å¹´</div>
                          <div>ğŸŒŸ æœ€å¼·æŠ€èƒ½: ${highestSkill}</div>
                      </div>
                  `;

        document.getElementById("stats-panel").innerHTML = html;
      }

      function nav(page, event) {
        event.preventDefault();
        event.stopPropagation();

        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        document.getElementById("page-" + page).classList.add("active");

        document
          .querySelectorAll(".nav-item")
          .forEach((n) => n.classList.remove("active"));
        event.currentTarget.classList.add("active");

        // æ›´æ–°ç‰¹å®šé é¢çš„è³‡æ–™
        if (page === "profile") {
          // âœ… æˆå°±ç»Ÿè®¡
          const stats = getAchievementStats();
          let achievementHtml = `
            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 160, 0, 0.2));
                        padding: 15px;
                        border-radius: 12px;
                        margin-bottom: 15px;
                        border: 2px solid var(--gold);
                        text-align: center;">
                <div style="font-size: 1.3em; font-weight: bold; color: var(--gold); margin-bottom: 10px;">
                    ğŸ† æˆå°±æ”¶é›†é€²åº¦
                </div>
                <div style="font-size: 2em; font-weight: bold; color: var(--gold); margin: 10px 0;">
                    ${stats.unlocked} / ${stats.total}
                </div>
                <div style="background: rgba(0,0,0,0.3); height: 20px; border-radius: 10px; overflow: hidden; margin: 10px 0;">
                    <div style="width: ${stats.percentage}%; height: 100%; background: linear-gradient(90deg, var(--gold), var(--green)); transition: width 0.5s;"></div>
                </div>
                <div style="color: var(--text-dim); font-size: 0.9em;">
                    å®Œæˆåº¦ï¼š${stats.percentage}%
                </div>
            </div>
        `;

          // æ˜¾ç¤ºæ‰€æœ‰æˆå°±ï¼ˆåŒ…æ‹¬æœªè§£é”çš„ï¼‰
          ACHIEVEMENTS.forEach((ach) => {
            const isUnlocked = Game.unlockedAchievements.includes(ach.id);
            achievementHtml += `
                <div style="background: ${isUnlocked ? "linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 160, 0, 0.15))" : "rgba(0,0,0,0.3)"};
                            padding: 12px;
                            border-radius: 10px;
                            margin-bottom: 10px;
                            border: 2px solid ${isUnlocked ? "var(--gold)" : "rgba(255,255,255,0.1)"};
                            ${isUnlocked ? "box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);" : "opacity: 0.6; filter: grayscale(0.8);"}">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 2em;">${isUnlocked ? ach.icon : "ğŸ”’"}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: ${isUnlocked ? "var(--gold)" : "var(--text-dim)"}; font-size: 1em;">
                                ${ach.name}
                            </div>
                            <div style="color: var(--text-dim); font-size: 0.85em; margin-top: 3px;">
                                ${isUnlocked ? ach.desc : "???"}
                            </div>
                        </div>
                        ${isUnlocked ? '<div style="color: var(--green); font-weight: bold; font-size: 1.2em;">âœ“</div>' : ""}
                    </div>
                </div>
            `;
          });

          // âœ… åŠ å…¥é‡ç½®æŒ‰é’®
          achievementHtml += `
            <button class="btn-main" onclick="resetAchievements()" 
                    style="background: linear-gradient(135deg, var(--red), #c62828); margin-top: 15px;">
                ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰æˆå°±
            </button>
        `;
          achievementHtml += `
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <button class="btn-main" onclick="exportAchievements()" 
                style="background: linear-gradient(135deg, var(--blue), #1976d2); font-size: 0.9em; padding: 10px;">
            ğŸ“¤ å°å‡ºæˆå°±
        </button>
        <button class="btn-main" onclick="importAchievements()" 
                style="background: linear-gradient(135deg, var(--green), #00897b); color: black; font-size: 0.9em; padding: 10px;">
            ğŸ“¥ å°å…¥æˆå°±
        </button>
    </div>
`;
          document.getElementById("achievement-list").innerHTML =
            achievementHtml;
        }
        renderStats();
      }

      function closeModal() {
        document.getElementById("event-modal").style.display = "none";
      }

      function restartGame() {
        if (
          confirm(
            "ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿ\n\nâš ï¸ ç•¶å‰é€²åº¦å°‡æœƒæ¸…é™¤\nâœ… å·²è§£é–çš„æˆå°±æœƒä¿ç•™",
          )
        ) {
          location.reload();
        }
      }
      // ==========================================
      // ğŸ”´ å‡ºèº«å°ˆå±¬äº‹ä»¶ç³»çµ±
      // ==========================================

      function triggerOriginEvent() {
        const originEvents = {
          rich: [
            {
              title: "ğŸ¢ å®¶æ—ä¼æ¥­å±æ©Ÿ",
              desc: "çˆ¶è¦ªå…¬å¸é­æƒ¡æ„æ”¶è³¼ï¼Œéœ€è¦ç·Šæ€¥è³‡é‡‘æ´åŠ©",
              choices: [
                {
                  txt: "æŠ•è³‡500è¬æ•‘å…¬å¸",
                  effect: (g) => {
                    if (g.money >= 5000000) {
                      g.money -= 5000000;
                      g.money += 10000000;
                      return "æˆåŠŸæ‹¯æ•‘ä¼æ¥­ï¼Œå…¬å¸åƒ¹å€¼ç¿»å€ï¼è³ºå›1000è¬";
                    }
                    return "è³‡é‡‘ä¸è¶³ï¼Œç„¡æ³•æŠ•è³‡";
                  },
                },
                {
                  txt: "è¢–æ‰‹æ—è§€",
                  effect: (g) => {
                    g.yearlyMoney = 0;
                    g.happy -= 20;
                    return "å®¶æ—ä¼æ¥­å€’é–‰ï¼Œå¤±å»é›¶ç”¨éŒ¢ä¾†æº";
                  },
                },
              ],
            },
            {
              title: "ğŸ’ ç¹¼æ‰¿éºç”¢",
              desc: "é æˆ¿è¦ªæˆšçªç„¶éä¸–ï¼Œç•™ä¸‹ä¸€ç­†éºç”¢çµ¦ä½ ",
              effect: (g) => {
                g.money += 3000000;
                g.happy += 10;
                return "ç²å¾—300è¬éºç”¢";
              },
            },
          ],
          genius: [
            {
              title: "ğŸ“ çå­¸é‡‘æ©Ÿæœƒ",
              desc: "é ‚å°–å¤§å­¸å› ä½ å„ªç•°æˆç¸¾æä¾›å…¨é¡çå­¸é‡‘",
              effect: (g) => {
                g.intel += 20;
                g.money += 500000;
                return "æ™ºåŠ›+20ï¼Œç²å¾—50è¬çå­¸é‡‘";
              },
            },
            {
              title: "ğŸ”¬ ç ”ç©¶çªç ´",
              desc: "ä½ çš„ç ”ç©¶ç²å¾—é‡å¤§çªç ´",
              effect: (g) => {
                g.intel += 15;
                g.money += 200000;
                g.happy += 15;
                return "å­¸è¡“è²è­½å¤§å¢";
              },
            },
          ],
          mafia: [
            {
              title: "ğŸ—¡ï¸ å¹«æ´¾é¬¥çˆ­",
              desc: "æ•µå°å¹«æ´¾æ‰¾ä¸Šé–€ä¾†å°‹ä»‡",
              choices: [
                {
                  txt: "æ­£é¢å°æ±º",
                  effect: (g) => {
                    if (Math.random() > 0.5) {
                      g.money += 1000000;
                      g.health -= 20;
                      g.skills.charm += 10;
                      return "æ‰“è´äº†ï¼æ¶åˆ°100è¬ï¼Œå¨åé æ’­";
                    } else {
                      g.health -= 40;
                      g.money -= 500000;
                      return "é‡å‚·ä½é™¢ï¼Œæå¤±æ…˜é‡";
                    }
                  },
                },
                {
                  txt: "è«‡åˆ¤å’Œè§£",
                  effect: (g) => {
                    g.money -= 300000;
                    g.skills.communication += 10;
                    return "èŠ±30è¬æ“ºå¹³ï¼Œå­¸æœƒè«‡åˆ¤æŠ€å·§";
                  },
                },
              ],
            },
            {
              title: "ğŸ’° åœ°ç›¤æ“´å¼µ",
              desc: "æœ‰æ©Ÿæœƒæ“´å¼µå®¶æ—å‹¢åŠ›ç¯„åœ",
              effect: (g) => {
                if (g.money >= 500000) {
                  g.money -= 500000;
                  g.yearlyMoney += 10000;
                  return "æŠ•è³‡50è¬æ“´å¼µåœ°ç›¤ï¼Œå¹´æ”¶å…¥+1è¬";
                }
                return "è³‡é‡‘ä¸è¶³";
              },
            },
          ],
          hacker: [
            {
              title: "ğŸ’» æš—ç¶²å§”è¨—",
              desc: "æ”¶åˆ°é«˜é¡é§­å®¢ä»»å‹™å§”è¨—ï¼Œä½†å¯èƒ½é•æ³•",
              choices: [
                {
                  txt: "æ¥å—ä»»å‹™",
                  effect: (g) => {
                    if (g.skills.programming > 80) {
                      g.money += 2000000;
                      g.skills.programming += 10;
                      return "ä»»å‹™æˆåŠŸï¼è³º200è¬ï¼ŒæŠ€è¡“å¤§å¢";
                    } else {
                      g.happy -= 15;
                      g.money -= 100000;
                      return "æŠ€è¡“ä¸è¶³å°è‡´å¤±æ•—ï¼Œæå¤±10è¬";
                    }
                  },
                },
                {
                  txt: "æ‹’çµ•ä»»å‹™",
                  effect: (g) => {
                    g.happy += 5;
                    g.intel += 3;
                    return "ä¿æŒé“å¾·åº•ç·šï¼Œå¿ƒå®‰ç†å¾—";
                  },
                },
              ],
            },
            {
              title: "ğŸ›¡ï¸ è³‡å®‰æ¼æ´ç™¼ç¾",
              desc: "ç™¼ç¾é‡å¤§è³‡å®‰æ¼æ´",
              effect: (g) => {
                g.skills.programming += 15;
                g.money += 500000;
                return "ç²å¾—æ¼æ´çé‡‘50è¬";
              },
            },
          ],
          royal: [
            {
              title: "ğŸ‘‘ çš‡å®¤å¬è¦‹",
              desc: "é æˆ¿çš‡å®¤è¦ªæˆšé‚€è«‹åƒåŠ è²´æ—å®´æœƒ",
              effect: (g) => {
                g.skills.charm += 15;
                g.skills.communication += 10;
                g.money += 500000;
                return "ç¤¾äº¤åœˆå¤§å¹…æå‡ï¼Œé­…åŠ›+15";
              },
            },
            {
              title: "ğŸ’ è¯å§»æè­°",
              desc: "å…¶ä»–è²´æ—å®¶æ—æå‡ºè¯å§»",
              choices: [
                {
                  txt: "æ¥å—è¯å§»",
                  effect: (g) => {
                    g.money += 5000000;
                    g.happy -= 20;
                    return "ç²å¾—500è¬å«å¦ä½†å¤±å»è‡ªç”±";
                  },
                },
                {
                  txt: "æ‹’çµ•è¯å§»",
                  effect: (g) => {
                    g.happy += 15;
                    return "è¿½æ±‚çœŸæ„›ï¼Œå¿ƒéˆè‡ªç”±";
                  },
                },
              ],
            },
          ],
          monk: [
            {
              title: "ğŸ™ é “æ‚Ÿæ™‚åˆ»",
              desc: "ä¿®è¡Œæ™‚çªç„¶é–‹æ‚Ÿï¼Œèº«å¿ƒéˆå¾—åˆ°æ˜‡è¯",
              effect: (g) => {
                g.happy += 30;
                g.intel += 10;
                g.health += 15;
                return "èº«å¿ƒéˆå…¨é¢æå‡";
              },
            },
            {
              title: "ğŸ“¿ é›²éŠå››æ–¹",
              desc: "å¸«çˆ¶å»ºè­°ä½ é›²éŠåƒå­¸",
              effect: (g) => {
                g.intel += 15;
                g.skills.communication += 10;
                g.happy += 20;
                return "è¦‹è­˜å¤§å¢ï¼Œå¿ƒèƒ¸é–‹é—Š";
              },
            },
          ],
          esports: [
            {
              title: "ğŸ® æˆ°éšŠé‚€è«‹",
              desc: "é ‚ç´šè·æ¥­æˆ°éšŠæƒ³é«˜è–ªç°½ç´„ä½ ",
              choices: [
                {
                  txt: "ç°½ç´„ç•¶é¸æ‰‹",
                  effect: (g) => {
                    g.jobId = "esports_player";
                    g.money += 800000;
                    g.happy += 20;
                    return "æˆç‚ºè·æ¥­é¸æ‰‹ï¼Œç°½ç´„é‡‘80è¬";
                  },
                },
                {
                  txt: "æ‹’çµ•ç°½ç´„",
                  effect: (g) => {
                    g.intel += 5;
                    return "å°ˆæ³¨æœ¬æ¥­ç™¼å±•";
                  },
                },
              ],
            },
            {
              title: "ğŸ† æ¯”è³½é‚€è«‹",
              desc: "å—é‚€åƒåŠ é›»ç«¶æ¯”è³½",
              effect: (g) => {
                if (Math.random() > 0.6) {
                  g.money += 500000;
                  g.happy += 20;
                  return "å¥ªå† ï¼ç²å¾—çé‡‘50è¬";
                } else {
                  g.happy += 5;
                  return "é›–æ•—çŒ¶æ¦®ï¼Œç²å¾—ç¶“é©—";
                }
              },
            },
          ],
          spy: [
            {
              title: "ğŸ•µï¸ æ©Ÿå¯†ä»»å‹™",
              desc: "çˆ¶è¦ªå¸Œæœ›ä½ å”åŠ©åŸ·è¡Œæƒ…å ±å·¥ä½œ",
              choices: [
                {
                  txt: "æ¥å—ä»»å‹™",
                  effect: (g) => {
                    if (g.intel > 90) {
                      g.money += 1500000;
                      g.health -= 10;
                      g.intel += 10;
                      return "ä»»å‹™æˆåŠŸï¼è³º150è¬ä½†æœ‰ä¸€å®šé¢¨éšª";
                    } else {
                      g.happy -= 10;
                      g.health -= 15;
                      return "èƒ½åŠ›ä¸è¶³ï¼Œä»»å‹™å¤±æ•—";
                    }
                  },
                },
                {
                  txt: "æ‹’çµ•ä»»å‹™",
                  effect: (g) => {
                    g.happy += 5;
                    return "é¸æ“‡å¹³å‡¡ç”Ÿæ´»";
                  },
                },
              ],
            },
            {
              title: "ğŸ” ç ´è­¯å¯†ç¢¼",
              desc: "ç™¼ç¾ç¥ç§˜åŠ å¯†è¨Šæ¯",
              effect: (g) => {
                if (g.intel > 100) {
                  g.money += 800000;
                  g.intel += 15;
                  return "æˆåŠŸç ´è­¯ï¼Œç²å¾—80è¬çå‹µ";
                }
                return "é›£åº¦å¤ªé«˜ï¼Œç„¡æ³•ç ´è­¯";
              },
            },
          ],
          chef_family: [
            {
              title: "ğŸ³ ç¾é£Ÿå¤§è³½",
              desc: "å—é‚€åƒåŠ åœ‹éš›çƒ¹é£ªå¤§è³½",
              effect: (g) => {
                if (g.skills.cooking > 80) {
                  g.money += 1000000;
                  g.skills.cooking += 20;
                  g.happy += 25;
                  return "å¥ªå† ï¼ç²å¾—100è¬çé‡‘";
                } else {
                  g.skills.cooking += 10;
                  g.happy += 10;
                  return "é›–æœªå¾—çä½†æŠ€è¡“ç²¾é€²";
                }
              },
            },
            {
              title: "â­ ç±³å…¶æ—è©•é‘‘",
              desc: "ç±³å…¶æ—è©•å¯©ä¾†è¨ªé¤å»³",
              effect: (g) => {
                g.skills.cooking += 15;
                g.money += 500000;
                g.happy += 20;
                return "ç²å¾—æ˜Ÿç´šèªè­‰ï¼Œåè²å¤§å™ª";
              },
            },
          ],
          fashion: [
            {
              title: "ğŸ‘— æ™‚è£é€±é‚€è«‹",
              desc: "å·´é»æ™‚è£é€±é‚€è«‹ä½ èµ°ç§€",
              effect: (g) => {
                g.skills.charm += 20;
                g.money += 800000;
                g.happy += 15;
                return "å¤§æ”¾ç•°å½©ï¼Œé­…åŠ›+20";
              },
            },
            {
              title: "ğŸ“¸ æ™‚å°šé›œèªŒå°é¢",
              desc: "åœ‹éš›æ™‚å°šé›œèªŒæƒ³é‚€ä½ ç•¶å°é¢",
              effect: (g) => {
                g.skills.charm += 15;
                g.money += 500000;
                return "ç™»ä¸Šå°é¢ï¼ŒçŸ¥ååº¦å¤§å¢";
              },
            },
          ],
          scientist_family: [
            {
              title: "ğŸ”¬ è«–æ–‡ç™¼è¡¨",
              desc: "ä½ çš„ç ”ç©¶è«–æ–‡å—åˆ°å­¸ç•Œé—œæ³¨",
              effect: (g) => {
                g.intel += 20;
                g.money += 1000000;
                g.happy += 15;
                return "å­¸è¡“åœ°ä½æå‡ï¼Œç²å¾—ç ”ç©¶ç¶“è²»";
              },
            },
            {
              title: "ğŸ… ç§‘å­¸çé …",
              desc: "ç²å¾—é‡è¦ç§‘å­¸çé …æå",
              effect: (g) => {
                if (g.intel > 120) {
                  g.money += 5000000;
                  g.intel += 25;
                  g.happy += 30;
                  return "ç²çï¼å¾—åˆ°500è¬çé‡‘";
                } else {
                  g.intel += 10;
                  return "é›–æœªç²çä½†å‚™å—è‚¯å®š";
                }
              },
            },
          ],
        };

        const originId = Game.originId;
        const events = originEvents[originId];

        if (events && events.length > 0) {
          const event = events[Math.floor(Math.random() * events.length)];

          if (event.choices) {
            showOriginEventModal(event);
          } else if (event.effect) {
            const result = event.effect(Game);
            log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}ï¼š${result}`);
            Game.totalEvents++;
          }
        }
      }

      function showOriginEventModal(event) {
        document.getElementById("ev-title").textContent =
          `ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`;
        document.getElementById("ev-desc").textContent = event.desc;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        btnA.textContent = event.choices[0].txt;
        btnB.textContent = event.choices[1].txt;

        btnA.onclick = () => {
          const result = event.choices[0].effect(Game);
          log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[0].txt} â†’ ${result}`);
          closeModal();
          updateUI();
          checkAchievements();
        };

        btnB.onclick = () => {
          const result = event.choices[1].effect(Game);
          log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[1].txt} â†’ ${result}`);
          closeModal();
          updateUI();
          checkAchievements();
        };

        document.getElementById("event-modal").style.display = "flex";
      }
      // âœ… è£œä¸Šç¼ºå¤±çš„ showModal å‡½æ•¸
      function showModal(title, description, actions) {
        const modal = document.getElementById("event-modal");
        document.getElementById("ev-title").textContent = title;
        document.getElementById("ev-desc").textContent = description;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        // å…ˆéš±è—æ‰€æœ‰æŒ‰éˆ•
        btnA.style.display = "none";
        btnB.style.display = "none";

        // è¨­å®šæŒ‰éˆ• A
        if (actions && actions[0]) {
          btnA.textContent = actions[0].text;
          btnA.style.display = "block";
          btnA.onclick = actions[0].action;
        }

        // è¨­å®šæŒ‰éˆ• B
        if (actions && actions[1]) {
          btnB.textContent = actions[1].text;
          btnB.style.display = "block";
          btnB.onclick = actions[1].action;
        }

        modal.style.display = "flex";
      }
      // åˆå§‹åŒ–
      initCreation();
    </script>
  </body>
</html>
